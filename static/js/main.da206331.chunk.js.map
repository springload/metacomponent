{"version":3,"sources":["Repl/peacock.png","Repl/Flash.tsx","Repl/Utils.tsx","Repl/ComponentMode.tsx","Repl/UsageMode.tsx","Repl/Modals/Modal.Util.tsx","Repl/Modals/Diagram.tsx","Repl/Modals/WhyModal.tsx","Repl/Modals/WhatModal.tsx","Repl/Header.tsx","Repl/storage.tsx","lib/metaComponent/parseMetaHTML.ts","lib/metaComponent/parseMetaHTMLAttribute.ts","lib/cssSniff/cssSniff.ts","lib/metaComponent/parseMetaHTMLIf.ts","lib/metaComponent/getProps.ts","lib/makeTemplates/utils.ts","lib/metaComponent/metaComponent.ts","lib/metaComponent/parseMetaVariable.ts","lib/makeTemplates/Template.ts","lib/makeTemplates/CSS/CSS.ts","lib/makeTemplates/HTML/HTML.ts","lib/makeTemplates/React/React.util.ts","lib/makeTemplates/React/React.ts","lib/makeTemplates/ReactStyledComponents/ReactStyledComponents.ts","lib/makeTemplates/Mustache/Mustache.ts","lib/makeTemplates/Vue/Vue.ts","lib/makeTemplates/Vue-JSX/Vue-JSX.ts","lib/makeTemplates/Angular/Angular.ts","lib/makeTemplates/Django/Django.ts","lib/makeTemplates/Ember/Ember.ts","lib/makeTemplates/makeTemplates.ts","lib/log.ts","Repl/useReplState.tsx","lib/index.ts","App.tsx","Repl/Modals/useModalState.tsx","index.tsx"],"names":["module","exports","Flash","text","children","timer","useRef","useState","animate","setAnimate","onKeyPress","e","key","trim","current","setTimeout","clearTimeout","className","pathType","file","substring","indexOf","formatName","ComponentMode","isWhatOpen","theme","setMetaHTML","metaHTML","css","setCSS","showEverything","resultIndex","outputValue","outputMode","setResultIndex","moveResultIndex","metaComponents","openWhatModal","onClick","aria-label","aria-expanded","aria-controls","mode","onChange","name","value","width","height","showGutter","showPrintMargin","role","aria-selected","undefined","id","tabIndex","onKeyUp","Object","keys","files","map","fileIndex","isSelected","title","dirname","startCase","replace","formatBriefName","readOnly","UsageMode","Modal","setAppElement","modalStyles","overlay","backgroundColor","zIndex","border","content","background","inset","top","bottom","right","left","Diagram","WhyModal","isOpen","closeModal","onRequestClose","style","contentLabel","shouldCloseOnOverlayClick","stopPropagation","aria-hidden","dangerouslySetInnerHTML","__html","content1","marked","WhatModal","openWhyModal","whatIsMetaHTML","Header","isWhyOpen","setMode","href","target","rel","src","peacock","alt","aria-current","STORAGE_TYPE","localStorageWrapper","setItem","window","localStorage","sessionStorage","console","log","getItem","removeItem","parseHTMLWithoutInsertionMode","domDocument","metaHTMLString","cssString","documentString","html","match","closingTag","tagName","isClosingTag","response","parsingModeTags","includes","META_ALIAS_ATTR","wrapBodyHtml","documentElement","innerHTML","doc","Array","from","querySelectorAll","forEach","alias","getAttribute","childNodes","unaliased","createElement","parentNode","insertBefore","childNode","appendChild","getAttributeNames","filter","toLowerCase","attr","previousAttributeValue","setAttribute","removeChild","restoreParsingModeElements","childlessElementName","childlessElement","lastChild","nextElementSibling","moveChildlessElements","parseMetaAttributeVariable","dk","optionalRegexp","RegExp","separatorIndex","keySegment","isOptional","endsWith","type","required","options","length","split","reduce","option","parts","cssSniff","matchedCSS","matched","child","nodeType","ELEMENT_NODE","el","sniffRoot","sheets","ownerDocument","styleSheets","Error","sheetsArray","i","sheet","cssRulesArray","cssRules","sheetIsAllowed","cssSniffStyleSheet","_filterCSSRulesByElement","getCSSMatchesByElement","ignoreChildren","rules","rule","selectorText","cssStyleRule","sanitisedSelector","ruleString","whitelisted","blacklisted","whitelistRules","whitelist","ruleMatches","isArray","some","ruleMatch","blacklistRules","blacklist","ruleIsAllowed","selectors","selector","splitted","parens","angulars","soFar","len","char","push","splitSelectors","normalizedSelector","unique","matches","existingCSSSniffStyleRule","cssSniffStyleRule","properties","cssText","lastIndexOf","error","trimmedSelector","media","cssMediaRule","conditionText","mediaString","whitelistMedia","mediaMatches","mediaMatch","blacklistMedia","mediaIsAllowed","existingMediaRule","childrenRules","before","ownerNode","checkStylesheet","sheetMatch","nodeName","nodeAttrs","attributes","attrs","JSON","stringify","whitelistStylesheets","stylesheet","blacklistStylesheets","serializeCSSMatchesAsProperties","values","childRule","join","parseMetaHTMLIf","htmlElement","optional","hasAttribute","test","testAsJavaScriptExpression","testAsPythonExpression","testAsPHPExpression","ids","AST","parseExpression","node","identifierName","findIdentifiers","generate","code","toPython","to2CharOperator","operator","toPHP","parseError","toString","astNode","stringToDjangoVar","str","getProps","nodes","props","walk","attributeName","attributeValuePart","validJavaScriptIdentifer","assertUnreachable","x","parseMetaComponentString","body","nodeToMetaNode","TEXT_NODE","textContent","COMMENT_NODE","names","outerHTML","parseMetaVariable","attributeValue","metaHTMLAttributeValueString","remaining","startIndex","endIndex","dkString","metaVariable","parseAttributeValue","cssProperties","element","attributesThatCanBeSet","attribute","metaAttribute","resetElementAttributes","resetMatchedCSS","cssPropertiesStringConstants","cssPropertiesString","resetValue","conditionalNode","condition","entries","optionName","optionValue","a","b","diff","bSheetIndex","bSheet","bRuleIndex","bRule","diffStyleSheet","diffRule","aRule","diffChildren","bRuleChildIndex","cssRootDiff","getAllMatchingCSSProperties","getAllMatchingCSSRulesRecursively","internalToPublic","walkAttributes","internalAttributes","newAttributeValues","newValue","getAllMatchingCSSRules","sheetIndex","ruleIndex","childRuleIndex","serializeCSSMatches","Template","args","templateId","hasMultipleRootNodes","this","onElement","onText","onComment","onVariable","onCloseVariable","onIf","onCloseIf","onFinalise","CSSTemplate","variable","closeVariable","prettier","format","parser","printWidth","plugins","parserPostCSS","HTMLTemplate","attributeValues","optionKeys","firstKey","onCloseElement","openingElement","prop","parserHTML","transform","class","for","autocomplete","readonly","autofocus","srcset","crossorigin","spellcheck","tabindex","maxlength","attributeNameTransform","startsWith","toUpperCase","getTypeScriptElementName","capitalize","ReactTemplate","imports","renderPrefix","render","renderSuffix","typeScript","constants","fileData","fragmentStrings","reactNameReplacement","start","end","setTypeScript","bind","renderPropType","setImports","renderRenderFunction","propId","propString","propIds","containsInvalidIdentifiers","destructure","renderAttribute","reactAttributeName","containsExpression","containsConstant","isTemplateString","renderAttributeValue","inString","identifier","onSerialize","renderFunction","parserTypeScript","ReactStyledComponentsTemplate","styledConstants","counter","styledName","pickedProps","renderCSSPropertyProps","styledProps","cssProperty","renderCSSProperty","styledAttributes","cssPropertiesNode","isValidIdentifier","conditional","propUnion","uniq","val","MustacheTemplate","data","unescapedVariables","isOmittedIfEmpty","attributeVariable","renderIf","expression","unescaped","VueTemplate","template","script","extendPropsString","propsString","computed","finalData","setPropsString","getNewComputedName","containsOnlyConstants","every","computedName","computedProp","identifiers","responseType","propExpression","computedString","propName","spreadProps","computeFunction","componentVarName","parserAngular","VueJSXTemplate","vueJSXNameReplacement","vue","isFunctionReference","result","spreadConstProps","renderString","AngularTemplate","firstValue","valueAsString","DjangoTemplate","index","arr","exp","EmberTemplate","usesTruthHelpers","containsSingleVariable","makeTemplates","metaComponent","obj","assign","mergeTemplateFiles","makeTemplate","instance","serialize","logFactory","haltOnErrors","arg","document","location","search","hashState","hash","parseInt","Number","isNaN","resultIndexString","resultIndexNumber","NaN","defaultValues","useReplState","setMetaComponents","iframeRef","debounceTime","reprocessTimer","reprocessMetaComponent","iframeEl","reprocessMetaComponentSoon","contentWindow","startTime","Date","now","generateTemplates","newDebounceTime","info","iframeRefCallback","useCallback","useEffect","filePaths","aceMode","htmlTimer","cssTimer","resultIndexTimer","publicSetResultIndex","tabButton","getElementById","focus","_","which","keyCode","App","setIsWhatOpen","setIsWhyOpen","root","querySelector","classList","add","remove","closeWhatModal","closeWhyModal","useModalState","ref","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.da206331.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/peacock.03b69fcf.png\";","import React, { useState, useRef } from \"react\";\n\ntype FlashProps = {\n  text: React.ReactNode;\n  children: React.ReactNode;\n};\n\nexport function Flash({ text, children }: FlashProps) {\n  const timer = useRef<NodeJS.Timeout>();\n  const [animate, setAnimate] = useState(\"off\");\n  const handleKey = (e: React.KeyboardEvent<HTMLDivElement>) => {\n    if (e.key.trim() === \"\") return;\n    setAnimate(\"on\");\n    timer.current = setTimeout(() => {\n      if (timer.current) clearTimeout(timer.current);\n      setAnimate(\"off\");\n    }, 1000);\n  };\n\n  return (\n    <div onKeyPress={handleKey} className=\"flash-container\">\n      <div className={`flash flash--${animate}`}>\n        <span className=\"flash__text\">{text}</span>\n      </div>\n      {children}\n    </div>\n  );\n}\n","import startCase from \"lodash/startCase\";\n\nexport function pathType(file: string) {\n  return file.substring(0, file.indexOf(\"/\"));\n}\n\nexport function formatName(file: string): string | undefined {\n  const dirname = pathType(file);\n  if (dirname === \"react-styled-components\") {\n    return \"React with Styled Components \";\n  }\n  return undefined;\n}\n\nexport function formatBriefName(file: string): string {\n  const dirname = pathType(file);\n\n  switch (dirname) {\n    case \"html\":\n      return \"HTML\";\n    case \"css\":\n      return \"CSS\";\n    case \"react-styled-components\":\n      return \"React \";\n    case \"vue-jsx\":\n      return \"Vue JSX\";\n    default:\n      return startCase(dirname).replace(/-/g, \" \");\n  }\n}\n","import React, { Fragment } from \"react\";\nimport { Flash } from \"./Flash\";\nimport AceEditor from \"react-ace\";\nimport \"ace-builds/src-noconflict/mode-json\";\nimport \"ace-builds/src-noconflict/mode-html\";\nimport \"ace-builds/src-noconflict/mode-css\";\nimport \"ace-builds/src-noconflict/theme-monokai\";\nimport { MetaComponents } from \"../lib\";\nimport { formatName, formatBriefName } from \"./Utils\";\n\ntype Props = {\n  isWhatOpen: boolean;\n  theme: string;\n  metaHTML: string;\n  setMetaHTML: (metaHTML: string) => void;\n  css: string;\n  setCSS: (css: string) => void;\n  showEverything: boolean;\n  resultIndex: number;\n  setResultIndex: (resultIndex: number) => void;\n  outputValue: string;\n  outputMode: string;\n  moveResultIndex: (\n    e: React.KeyboardEvent<HTMLButtonElement>,\n    resultIndex: number\n  ) => void;\n  metaComponents: MetaComponents | undefined;\n  openWhatModal: () => void;\n};\n\nexport function ComponentMode({\n  isWhatOpen,\n  theme,\n  setMetaHTML,\n  metaHTML,\n  css,\n  setCSS,\n  showEverything,\n  resultIndex,\n  outputValue,\n  outputMode,\n  setResultIndex,\n  moveResultIndex,\n  metaComponents,\n\n  openWhatModal,\n}: Props) {\n  return (\n    <Fragment>\n      <fieldset className=\"html_container field_textarea\">\n        <legend>\n          Input: MetaHTML\n          <button\n            onClick={openWhatModal}\n            className=\"what-button\"\n            aria-label=\"Why MetaHTML?\"\n            aria-expanded={isWhatOpen}\n            aria-controls=\"what-modal\"\n          >\n            ?\n          </button>\n        </legend>\n        <AceEditor\n          mode=\"html\"\n          theme={theme}\n          onChange={setMetaHTML}\n          name=\"html\"\n          value={metaHTML}\n          width=\"100%\"\n          height=\"100%\"\n          showGutter={true}\n          showPrintMargin={false}\n        />\n      </fieldset>\n\n      <fieldset className=\"css_container field_textarea\">\n        <legend>Input: Standard CSS</legend>\n        <AceEditor\n          mode=\"css\"\n          theme={theme}\n          onChange={setCSS}\n          name=\"css\"\n          value={css}\n          width=\"100%\"\n          height=\"100%\"\n          showGutter={true}\n          showPrintMargin={false}\n        />\n      </fieldset>\n\n      <fieldset className=\"output_container field_textarea\">\n        <legend>\n          <span className=\"output_container--label\">Outputs:</span>\n          {showEverything && (\n            <button\n              role=\"tab\"\n              aria-selected={resultIndex === 0}\n              className={`tab ${\n                resultIndex === 0 ? \"tab--selected\" : undefined\n              }`}\n              aria-controls=\"output\"\n              id=\"tab-0\"\n              tabIndex={resultIndex === 0 ? 0 : -1}\n              onClick={() => setResultIndex(0)}\n              onKeyUp={(e) => moveResultIndex(e, 0)}\n            >\n              Everything\n            </button>\n          )}\n          {metaComponents\n            ? Object.keys(metaComponents.files).map((file, fileIndex) => {\n                const isSelected = resultIndex === fileIndex + 1;\n                const tabIndex = fileIndex + 1;\n                return (\n                  <button\n                    key={file}\n                    role=\"tab\"\n                    aria-selected={isSelected}\n                    className={`tab ${isSelected ? \"tab--selected\" : \"\"}`}\n                    aria-controls=\"output\"\n                    id={`tab-${tabIndex}`}\n                    onClick={() => setResultIndex(tabIndex)}\n                    title={formatName(file)}\n                    tabIndex={isSelected ? 0 : -1}\n                    onKeyUp={(e) => moveResultIndex(e, tabIndex)}\n                  >\n                    {formatBriefName(file)}\n                  </button>\n                );\n              })\n            : null}\n        </legend>\n        <Flash\n          text={\n            <>\n              this is uneditable. <br />\n              it's the output from MetaComponent <br />\n              click tabs above to see formats\n            </>\n          }\n        >\n          <AceEditor\n            mode={outputMode}\n            theme={theme}\n            name=\"output\"\n            value={outputValue}\n            readOnly\n            width=\"100%\"\n            height=\"100%\"\n            showPrintMargin={false}\n            showGutter={true}\n            // markers={markers}\n          />\n        </Flash>\n      </fieldset>\n    </Fragment>\n  );\n}\n","import React from \"react\";\nimport \"./UsageMode.css\";\n\ntype Props = {};\n\nexport function UsageMode({}: Props) {\n  return <div className=\"under-development\">(under development)</div>;\n}\n","import Modal from \"react-modal\";\nimport \"./Modals.css\";\n\nModal.setAppElement(\"#root\");\n\nexport const modalStyles = {\n  overlay: {\n    backgroundColor: \"rgba(0,0,0,0.5)\",\n    zIndex: 10,\n    border: \"none\",\n  },\n  content: {\n    background: \"none\",\n    inset: \"0px\",\n    border: \"none\",\n    top: \"0px\",\n    bottom: \"0px\",\n    right: \"0px\",\n    left: \"0px\",\n  },\n} as const;\n","import React from \"react\";\nimport \"./Diagram.css\";\n\nexport function Diagram() {\n  return (\n    <div className=\"diagram\">\n      <div className=\"box diagram-metahtml\">\n        MetaHTML <br /> (input)\n      </div>\n      <div className=\"diagram-plus\">+</div>\n      <div className=\"box diagram-css\">\n        Standard CSS <br /> (input)\n      </div>\n      <div className=\"diagram-equals\">=</div>\n      <div className=\"box diagram-output\">Components (output)</div>\n    </div>\n  );\n}\n","import React from \"react\";\nimport Modal from \"react-modal\";\nimport marked from \"marked\";\nimport { modalStyles } from \"./Modal.Util\";\nimport { Diagram } from \"./Diagram\";\n\ntype Props = {\n  isOpen: boolean;\n  closeModal: () => void;\n};\n\nexport function WhyModal({ isOpen, closeModal }: Props) {\n  return (\n    <Modal\n      isOpen={isOpen}\n      onRequestClose={closeModal}\n      style={modalStyles}\n      contentLabel=\"Why is MetaComponent?\"\n      shouldCloseOnOverlayClick={true}\n    >\n      <div className=\"modal-content\" onClick={closeModal} id=\"why-modal\">\n        <div\n          className=\"modal-content__body\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          <button onClick={closeModal} className=\"close_button\">\n            close <span aria-hidden> </span>\n          </button>\n          <h2>\n            MetaComponent <abbr title=\"Read-eval-print loop\">REPL</abbr>\n          </h2>\n          <div dangerouslySetInnerHTML={{ __html: content1 }}></div>\n          <h3>\n            <abbr title=\"Read-eval-print loop\">REPL</abbr> User Interface\n          </h3>\n          <Diagram />\n\n          <button onClick={closeModal} className=\"close_button\">\n            close <span aria-hidden> </span>\n          </button>\n        </div>\n      </div>\n    </Modal>\n  );\n}\n\nconst content1 = marked(`\nMetaComponent can generate components in plain HTML and CSS, but also React, Django, Vue, Angular, and many more.\n\nSome of its use-cases are:\n* progressive enhancement of webapps, keeping server-side templates in sync with client-side templates.\n* providing components in multiple formats as an ongoing feature of a Design System or Pattern Library.\n* migrating to another format (eg using legacy CSS to migrate to \\`styled-components\\`).\n* learning about similarities and differences in component languages.\n`);\n","import React from \"react\";\nimport Modal from \"react-modal\";\nimport marked from \"marked\";\nimport { modalStyles } from \"./Modal.Util\";\n\ntype Props = {\n  isOpen: boolean;\n  closeModal: () => void;\n  openWhyModal: () => void;\n};\n\nexport function WhatModal({ isOpen, closeModal, openWhyModal }: Props) {\n  return (\n    <Modal\n      isOpen={isOpen}\n      onRequestClose={closeModal}\n      style={modalStyles}\n      contentLabel=\"What is MetaHTML?\"\n      shouldCloseOnOverlayClick={true}\n    >\n      <div className=\"modal-content\" onClick={closeModal} id=\"what-modal\">\n        <div\n          className=\"modal-content__body\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          <button onClick={closeModal} className=\"close_button\">\n            close <span aria-hidden> </span>\n          </button>\n          <div>\n            <h2>MetaHTML?</h2>\n\n            <button\n              onClick={openWhyModal}\n              className=\"modal__link\"\n              aria-label=\"Open modal explaining MetaComponent\"\n              aria-expanded={false}\n              aria-controls=\"why-modal\"\n            >\n              <span className=\"modal__link--peripheral\">(see also:</span> Why\n              MetaComponent?<span className=\"modal__link--peripheral\">)</span>\n            </button>\n            <div dangerouslySetInnerHTML={{ __html: whatIsMetaHTML }}></div>\n          </div>\n\n          <button\n            onClick={openWhyModal}\n            className=\"modal__link\"\n            aria-label=\"Open modal explaining MetaComponent\"\n            aria-expanded={false}\n            aria-controls=\"why-modal\"\n          >\n            <span className=\"modal__link--peripheral\">(see also:</span> Why\n            MetaComponent?<span className=\"modal__link--peripheral\">)</span>\n          </button>\n\n          <button onClick={closeModal} className=\"close_button\">\n            close <span aria-hidden> </span>\n          </button>\n        </div>\n      </div>\n    </Modal>\n  );\n}\n\nconst whatIsMetaHTML = marked(`\n\nMetaComponent uses **MetaHTML** and **standard CSS** as inputs to generate components in a variety of formats.\n\nMetaHTML is HTML with markers for the parts that should be configurable, as variables.\n\nThere are two types of variables, for attributes and elements:\n\n### Attributes\n- \\`<span class=\"{{ someVariable }}\">\\`\n  - \\`?\\` makes it optional \\`{{ someVariable? }}\\`.\n  - multiple variables \\`<span class=\"{{ class }}{{ otherClass }}\">\\`\n- enumerations like \\`{{ variableName: option1 | option2 }}\\` eg \\`<span class=\"{{ color: class-red | class-blue }}\">\\` and MetaComponent will generate typings to those valid choices. Enumerations may only be strings.\n- label enumerations with friendly names with \\`as FriendlyName\\` eg  \\`class=\"{{ variableName: box--color-red as Red | box--color-blue as Blue }}\"\\`.\n\n### Elements\n- \\`<m-variable id=\"variableName\"></m-variable>\\`\n  - The attribute \\`optional\\` makes it optional eg \\`<m-variable id=\"variableName\" optional></m-variable>\\`\n  - provide a default value with child nodes eg \\`<m-variable id=\"variableName\">default value</m-variable>\\`\n- Conditional logic \\`<m-if test=\"isShown\">shown if true</m-if>\\`, or \\`<m-if test=\"someVariable === 'frogs' \">shown if true</m-if>\\`.\n\nMetaHTML is for generating stateless components. Logic should be in a higher-order components (HOC).\n\nThere is no support for loops. Use composition instead.\n\n\n`);\n","import React, { Fragment } from \"react\";\nimport { Mode } from \"./useReplState\";\nimport peacock from \"./peacock.png\";\n\ntype Props = {\n  openWhyModal: () => void;\n  isWhyOpen: boolean;\n  mode: Mode;\n  setMode: React.Dispatch<React.SetStateAction<Mode>>;\n};\n\nexport function Header({ isWhyOpen, openWhyModal, mode, setMode }: Props) {\n  return (\n    <Fragment>\n      <div id=\"button_tray_container\" className=\"button-tray\">\n        <button\n          onClick={openWhyModal}\n          className=\"button-tray__link\"\n          aria-label=\"Open modal explaining MetaComponent\"\n          aria-expanded={isWhyOpen}\n          aria-controls=\"why-modal\"\n        >\n          Why MetaComponent?\n        </button>\n        <a\n          href=\"https://twitter.com/hollowaynz\"\n          target=\"_blank\"\n          rel=\"noreferrer noopener\"\n          className=\"button-tray__link\"\n          aria-label=\"Twitter @hollowaynz\"\n        >\n          Twitter\n        </a>\n        <a\n          href=\"https://github.com/springload/metacomponent\"\n          target=\"_blank\"\n          rel=\"noreferrer noopener\"\n          className=\"button-tray__link\"\n          aria-label=\"GitHub Repo\"\n        >\n          Repo\n        </a>\n      </div>\n      <h1 className=\"title_container\">\n        MetaComponent <abbr title=\"Read-eval-print loop\">REPL</abbr>\n        <img\n          src={peacock}\n          alt=\"(Peacock Logo)\"\n          title=\"Peacock\"\n          className=\"title_container__peacock\"\n        />\n      </h1>\n      <fieldset className=\"app_modes\">\n        <legend>\n          <button\n            className={`tab2 ${mode === \"Component\" ? \" tab2--selected\" : \"\"}`}\n            aria-current={mode === \"Component\" && \"page\"}\n            aria-label=\"Switch to Component mode\"\n            onClick={() => setMode(\"Component\")}\n          >\n            Component\n          </button>\n          <button\n            className={`tab2 ${mode === \"Usage\" ? \" tab2--selected\" : \"\"}`}\n            aria-current={mode === \"Usage\" && \"page\"}\n            aria-label=\"Switch to Usage mode\"\n            onClick={() => setMode(\"Usage\")}\n          >\n            Usage\n          </button>\n        </legend>\n      </fieldset>\n    </Fragment>\n  );\n}\n","const LOCAL_STORAGE = \"LOCAL_STORAGE\" as const;\ntype LOCAL_STORAGE_TYPE = typeof LOCAL_STORAGE;\n\n/*\n *  DEVELOPER NOTE\n *\n *  Some browsers can block storage (localStorage, sessionStorage)\n *  access for privacy reasons, and all browsers can have storage\n *  that's full, and so they'll throw exceptions.\n *\n *  These exceptions can happen even with `if (window.localStorage)`!\n *\n *  Also sometimes localStorage/sessionStorage are enabled\n *  AFTER page load on mobiles. This is a browser bug we need to\n *  handle it gracefully.\n *\n *  So,\n *\n *****************************************************************\n *           we need to wrap all usage in try/catch\n *****************************************************************\n *\n *  and,\n *\n ****************************************************************\n *     we need to defer actual usage of these until necessary,\n *    hence using CONSTANTS to indirectly refer to these storages\n *     rather than window.localStorage/window.sessionStorage\n *                         directly\n ****************************************************************\n */\n\nconst storage = (STORAGE_TYPE: LOCAL_STORAGE_TYPE) => ({\n  setItem: (key: string, value: string) => {\n    if (typeof window === \"undefined\") return; // exit early for SSR\n    try {\n      STORAGE_TYPE === LOCAL_STORAGE\n        ? window.localStorage.setItem(key, value)\n        : window.sessionStorage.setItem(key, value);\n    } catch (e) {\n      console.log(e);\n    }\n  },\n  getItem: (key: string) => {\n    if (typeof window === \"undefined\") return; // exit early for SSR\n    try {\n      return STORAGE_TYPE === LOCAL_STORAGE\n        ? window.localStorage.getItem(key)\n        : window.sessionStorage.getItem(key);\n    } catch (e) {\n      console.log(e);\n    }\n  },\n  removeItem: (key: string) => {\n    try {\n      STORAGE_TYPE === LOCAL_STORAGE\n        ? window.localStorage.removeItem(key)\n        : window.sessionStorage.removeItem(key);\n    } catch (e) {\n      console.log(e);\n    }\n  },\n});\n\nexport const localStorageWrapper = storage(LOCAL_STORAGE);\n","import { Log } from \"../log\";\n// Combine metaHTML and CSS in an HTML document string, and restore parsing mode\n// problems.\n//\n// Some tags like <select> and <tbody> etc., invoke HTML5 parsing modes\n// that only allow certain tags within them, or they rearrange the tree\n// based on those tags, so we need to alias them. See\n// https://www.w3.org/TR/2011/WD-html5-20110113/parsing.html#the-insertion-mode\n// So that would mean we couldn't have tags like,\n//\n// <select>\n//   <m-variable key=\"children\">placeholder</m-variable>\n// </select>\n//\n// So instead we'll turn that into,\n//\n// <m-alias-select>\n//   <m-variable key=\"children\">placeholder</m-variable>\n// </m-alias-select>\n//\n// and then rename the element after parsing\n\ntype Props = {\n  domDocument: Document;\n  metaHTMLString: string;\n  cssString: string;\n  log: Log;\n};\n\nexport function parseHTMLWithoutInsertionMode({\n  domDocument,\n  metaHTMLString,\n  cssString,\n  log,\n}: Props): void {\n  const documentString = wrapBodyHtml(metaHTMLString, cssString);\n  domDocument.documentElement.innerHTML = documentString;\n\n  restoreParsingModeElements(domDocument, log);\n  moveChildlessElements(domDocument);\n}\n\nfunction wrapBodyHtml(metaHTMLString: string, cssString: string): string {\n  return `<head><style>${cssString}</style></head><body>${aliasParsingModeElements(\n    metaHTMLString\n  )}</body>`;\n}\n\nconst META_ALIAS_TAG = \"m-alias\";\nconst META_ALIAS_ATTR = \"data-original-element-name\";\nexport const parsingModeTags = [\n  \"table\",\n  \"thead\",\n  \"tbody\",\n  \"tfoot\",\n  \"tr\",\n  \"caption\",\n  \"select\",\n  \"option\",\n];\n\nexport function aliasParsingModeElements(html: string): string {\n  return html.replace(/<([/]?)([^\\n >]+)/gi, (match, closingTag, tagName) => {\n    const isClosingTag = !!closingTag;\n    let response = `<${isClosingTag ? \"/\" : \"\"}`;\n    if (parsingModeTags.includes(tagName)) {\n      response += META_ALIAS_TAG;\n      if (!isClosingTag) {\n        response += ` ${META_ALIAS_ATTR}=\"${tagName}\" `;\n      }\n    } else {\n      response += tagName;\n    }\n    return response;\n  });\n}\n\nfunction restoreParsingModeElements(domDocument: Document, log: Log): void {\n  const doc = domDocument;\n  const aliases = Array.from(doc.querySelectorAll(META_ALIAS_TAG));\n  aliases.forEach((alias: Element) => {\n    if (!alias) return;\n    const tagName = alias.getAttribute(META_ALIAS_ATTR);\n    if (!tagName) {\n      log(\n        `MetaComponent: ${META_ALIAS_TAG} missing ${META_ALIAS_ATTR} attribute.`\n      );\n      return;\n    }\n    const childNodes = Array.from(alias.childNodes);\n    const unaliased = doc.createElement(tagName);\n    if (!alias.parentNode) {\n      log(\"MetaComponent parsing mode element must not be top-level.\");\n      return;\n    }\n    alias.parentNode.insertBefore(unaliased, alias);\n    childNodes.forEach((childNode) => {\n      unaliased.appendChild(childNode);\n    });\n    const attrs = alias.getAttributeNames().filter(\n      (name) => name.toLowerCase() !== META_ALIAS_ATTR.toLowerCase() // because DOMs can lowercase attributes so we need a case-insensitive string comparison\n    );\n    attrs.forEach((attr) => {\n      const previousAttributeValue = alias.getAttribute(attr);\n      if (!previousAttributeValue) {\n        log(\"MetaComponent: must have a previous attribute value\");\n        return;\n      }\n      unaliased.setAttribute(attr, previousAttributeValue);\n    });\n    alias.parentNode.removeChild(alias);\n  });\n}\n\nfunction moveChildlessElements(domDocument: Document) {\n  const childlessElementNames: string[] = [];\n  childlessElementNames.forEach((childlessElementName: string): void => {\n    Array.from(domDocument.querySelectorAll(childlessElementName)).forEach(\n      (childlessElement: Element) => {\n        while (childlessElement.lastChild) {\n          childlessElement.parentNode?.insertBefore(\n            childlessElement.lastChild,\n            childlessElement.nextElementSibling\n          );\n        }\n      }\n    );\n  });\n}\n","import { Log } from \"../log\";\n\nexport const parseAttributeValue = (\n  metaHTMLAttributeValueString: string,\n  log: Log\n): MetaAttributeValuesInternal => {\n  const response: MetaAttributeValuesInternal = [];\n  let remaining: string = metaHTMLAttributeValueString;\n  const start = \"{{\" as const;\n  const end = \"}}\" as const;\n\n  while (remaining.length) {\n    const startIndex = remaining.indexOf(start);\n\n    if (startIndex === -1) {\n      // no MetaAttributeVariable, just string remainings\n      response.push({\n        type: \"MetaAttributeConstant\",\n        value: remaining,\n      });\n      remaining = \"\";\n    } else if (startIndex === 0) {\n      // a MetaAttributeVariable\n      const endIndex = remaining.indexOf(end, startIndex);\n      if (endIndex === -1) {\n        log(`Attribute with ${start} but no ${end}.`);\n        return response;\n      }\n      const dkString = remaining.substring(start.length, endIndex);\n      const metaVariable = parseMetaAttributeVariable(dkString);\n      response.push(metaVariable);\n      remaining = remaining.substring(endIndex + end.length);\n    } else {\n      // string before another MetaVariable\n      response.push({\n        type: \"MetaAttributeConstant\",\n        value: remaining.substring(0, startIndex),\n      });\n      remaining = remaining.substring(startIndex);\n    }\n  }\n  return response;\n};\n\nexport const parseMetaAttributeVariable = (\n  dk: string\n): MetaAttributeVariableInternal | MetaAttributeVariableOptionsInternal => {\n  const SEPARATOR = \":\";\n  const ENUM_SEPARATOR = \"|\";\n  const OPTIONAL = \"?\";\n\n  const escapeTextForRegex = (text: string) => {\n    return text.replace(/([()[{*+.$^\\\\|?])/g, \"\\\\$1\");\n  };\n\n  const optionalRegexp = new RegExp(`${escapeTextForRegex(OPTIONAL)}$`); // regex anchored to end of string\n\n  const separatorIndex = dk.indexOf(SEPARATOR);\n  let keySegment = separatorIndex === -1 ? dk : dk.substring(0, separatorIndex);\n  keySegment = keySegment.trim();\n  const isOptional = keySegment.endsWith(OPTIONAL);\n  if (isOptional) {\n    keySegment = keySegment.replace(optionalRegexp, \"\");\n  }\n\n  if (separatorIndex === -1) {\n    // chance to exit early\n    return {\n      type: \"MetaAttributeVariable\",\n      id: keySegment,\n      required: !isOptional,\n    };\n  }\n\n  const options: Record<string, string> = dk\n    .substring(separatorIndex + SEPARATOR.length)\n    .split(ENUM_SEPARATOR)\n    .reduce((options: Record<string, string>, option: string): Record<\n      string,\n      string\n    > => {\n      // An option is a string that looks like either,\n      //    \" valueThatIsAlsoName \"\n      //    \" value as friendlyName \"\n      // so when split by \" as \" it will have either\n      // 1 or 2 array items.\n      const parts: string[] = option.split(\" as \");\n      const name = parts.length === 2 ? parts[1].trim() : parts[0].trim();\n      if (name.length > 0) {\n        options[name] = parts[0].trim();\n      }\n      return options;\n    }, {});\n\n  return {\n    type: \"MetaAttributeVariableOptions\",\n    id: keySegment,\n    required: !isOptional,\n    options,\n  };\n};\n\nexport type MetaAttributeVariable = {\n  type: \"MetaAttributeVariable\";\n  id: string;\n};\n\nexport type MetaAttributeVariableOptions = {\n  type: \"MetaAttributeVariableOptions\";\n  id: string;\n  options: Record<string, string>;\n};\n\nexport type MetaAttributeConstant = {\n  type: \"MetaAttributeConstant\";\n  value: string;\n};\n\ntype MetaAttributeVariableInternal = MetaAttributeVariable & {\n  required: boolean;\n};\ntype MetaAttributeVariableOptionsInternal = MetaAttributeVariableOptions & {\n  required: boolean;\n};\n\nexport type MetaAttributeValueInternal =\n  | MetaAttributeConstant\n  | MetaAttributeVariableInternal\n  | MetaAttributeVariableOptionsInternal;\n\nexport type MetaAttributeValuesInternal = MetaAttributeValueInternal[];\n\nexport type MetaAttributeValue =\n  | MetaAttributeConstant\n  | MetaAttributeVariable\n  | MetaAttributeVariableOptions;\n\nexport type MetaAttributeValues = MetaAttributeValue[];\n","type Options = {\n  ignoreChildren?: boolean;\n  whitelist?: { stylesheet?: string; media?: string; rule?: string };\n  blacklist?: { stylesheet?: string; media?: string; rule?: string };\n};\n\nexport type CSSSniffRoot = {\n  [sheetIndex: string]: CSSSniffStyleSheet;\n};\n\nexport type CSSSniffStyleSheet = {\n  [ruleIndex: string]: CSSSniffStyleRule | CSSSniffMediaRule;\n};\n\nexport type CSSSniffStyleRule = {\n  type: \"CSSSniffStyleRule\";\n  selectors: string[];\n  properties: string;\n};\n\nexport type CSSSniffMediaRule = {\n  type: \"CSSSniffMediaRule\";\n  before: string;\n  children: CSSSniffStyleSheet;\n};\n\nexport function cssSniff(\n  children: ChildNode[],\n  options: Options,\n  matchedCSS?: CSSSniffRoot\n): CSSSniffRoot {\n  const matched: CSSSniffRoot = matchedCSS || {};\n\n  children.forEach((child) => {\n    if (child.nodeType !== child.ELEMENT_NODE) {\n      // only Elements can have CSS (ie, text nodes can't have CSS)\n      return;\n    }\n    // @ts-ignore\n    const el: HTMLElement = child;\n    getCSSMatchesByElement(el, options, matched);\n    if (!options.ignoreChildren && el.childNodes) {\n      cssSniff(Array.from(el.childNodes), options, matched);\n    }\n  });\n\n  return matched;\n}\n\nfunction getCSSMatchesByElement(\n  el: HTMLElement,\n  options: Options,\n  sniffRoot: CSSSniffRoot\n): void {\n  if (el.nodeType !== el.ELEMENT_NODE) {\n    return;\n  }\n\n  const sheets = el.ownerDocument?.styleSheets;\n  if (!sheets) {\n    throw Error(`Expected to find stylesheets of Node.`);\n  }\n  // @ts-ignore\n  const sheetsArray: CSSStyleSheet[] = Array.from(sheets);\n\n  for (let i in sheetsArray) {\n    const sheet = sheetsArray[i];\n\n    const cssRulesArray = Array.from(sheet.cssRules);\n\n    if (sheetIsAllowed(sheet, options)) {\n      const cssSniffStyleSheet: CSSSniffStyleSheet = sniffRoot[i] || {};\n      sniffRoot[i] = cssSniffStyleSheet;\n      _filterCSSRulesByElement(el, cssRulesArray, options, cssSniffStyleSheet);\n    }\n  }\n}\n\nfunction _filterCSSRulesByElement(\n  el: HTMLElement,\n  rules: CSSRule[],\n  options: Options,\n  cssSniffStyleSheet: CSSSniffStyleSheet // is mutated\n): void {\n  for (let i in rules) {\n    const rule = rules[i];\n\n    // @ts-ignore\n    if (rule.selectorText) {\n      // @ts-ignore\n      const cssStyleRule: CSSStyleRule = rule;\n      const sanitisedSelector = cssStyleRule.selectorText.replace(\n        /@charset.*?;/g,\n        \"\"\n      );\n\n      if (ruleIsAllowed(sanitisedSelector, options)) {\n        const selectors = splitSelectors(sanitisedSelector);\n\n        selectors.forEach((selector) => {\n          let trimmedSelector;\n          let normalizedSelector;\n\n          try {\n            // Exceptions may be thrown about browser-specific\n            // selectors such as\n            //\n            //   input::-moz-something\n            //   input::-webkit-something\n            //   input::-ms-something\n            //   input:-moz-something\n            //   input:-webkit-something\n            //   input:-ms-something\n            //\n            // or potentially selectors without anything before\n            // the \":\",\n            //\n            //   ::-moz-something\n            //   :not(input)\n            //\n            // and there are also escaped selectors like,\n            //\n            //   .link.\\:link\n            //\n            //  (used like <input class=\"link :link\">)\n            //\n            // and pseudo-elements like,\n            //\n            //   span::before\n            //\n            // where the \"::before\" is irrelevant to whether the\n            // selector matches the element so we should remove it.\n            //\n            // and\n            //\n            //   input:first-child\n            //   p > :first-child\n            //\n            // where we should change to\n            //   input\n            //   p > *\n            // respectively because we can't know HTML structure.\n            //\n            // So given all those scenarios we have the following logic,\n            //\n            // 1) If it starts with \":\" without anything preceding we'll\n            //    consider it a match because it could be.\n            //    (maybe this should be configurable?)\n            //\n            // 2) If it has a \":\" in it that's not preceded by \"\\\" then\n            //    we remove to the end of the selector. ie,\n            //    input:-moz-something -> input\n            //    input\\:-moz-something -> input\\:-moz-something\n            //    input::before -> input::before\n            //    input\\:\\:moz-something -> input\\:\\:moz-something\n\n            // PRE-NORMALISATON\n            // Temporarily replace \"\\:\" (escaped colon) to simplify\n            // removing \":something\" (real colon) which we restore later.\n            normalizedSelector = selector.replace(/\\\\:/g, unique).trim();\n\n            // START OF NORMALIZATION\n            // The goal here is to anticipate any possible node states that\n            // might match this node (ie, \"\":checked\" or adjacent sibling/hierarchical\n            // selectors)\n\n            normalizedSelector = normalizedSelector\n              .replace(/^.*[\\s]/, \"\") // regex 'greedy' selector anchored to string start, searching for whitespace to convert (eg) \".a + .b + .c\" to \".c\". Delete any conditions on hierarchical (adjacent sibling / descendent etc.) selectors because they could match and that's close enough to warrant including it.\n              .replace(/:+.*$/gi, \"\") // regex 'greedy' selector anchored to string end, searching for \":\" and deleting everything after\n              .trim();\n\n            // END OF NORMALISATION\n\n            // Restore escaped colons back to \"\\:\".\n            // See above comment about escaped colons.\n            normalizedSelector = normalizedSelector.replace(\n              new RegExp(unique, \"g\"),\n              \"\\\\:\"\n            );\n\n            const isMatch = el.matches(normalizedSelector);\n\n            if (isMatch) {\n              const existingCSSSniffStyleRule = cssSniffStyleSheet[i];\n              if (\n                existingCSSSniffStyleRule &&\n                existingCSSSniffStyleRule.type !== \"CSSSniffStyleRule\"\n              ) {\n                throw Error(\"Rule can't change type\");\n              }\n              const cssSniffStyleRule: CSSSniffStyleRule = {\n                type: \"CSSSniffStyleRule\",\n                selectors: existingCSSSniffStyleRule\n                  ? existingCSSSniffStyleRule.selectors\n                  : [],\n                properties: cssStyleRule.cssText.substring(\n                  cssStyleRule.cssText.indexOf(\"{\") + 1,\n                  cssStyleRule.cssText.lastIndexOf(\"}\")\n                ),\n              };\n              if (!cssSniffStyleRule.selectors.includes(selector)) {\n                cssSniffStyleRule.selectors.push(selector);\n              }\n              cssSniffStyleSheet[i] = cssSniffStyleRule;\n            }\n          } catch (e) {\n            const isCharsetError =\n              \"@charset\".indexOf(cssStyleRule.selectorText) !== -1;\n            if (!isCharsetError) {\n              console.error(\n                \"ERROR\",\n                cssStyleRule.type,\n                `[${trimmedSelector}]`,\n                `[[${normalizedSelector}]]`,\n                `(((${cssStyleRule.selectorText})))`,\n                e\n              );\n            }\n          }\n        });\n      }\n    } else if (\n      // @ts-ignore\n      rule.media\n    ) {\n      // @ts-ignore\n      const cssMediaRule: CSSMediaRule = rule;\n      const conditionText = cssMediaRule.conditionText || cssMediaRule.media[0];\n      if (mediaIsAllowed(conditionText, options)) {\n        // a nested rule like @media { rule { ... } }\n        // so we filter the rules inside individually\n        const cssRulesArray = Array.from(cssMediaRule.cssRules);\n\n        const existingMediaRule = cssSniffStyleSheet[i];\n        if (\n          existingMediaRule &&\n          existingMediaRule.type !== \"CSSSniffMediaRule\"\n        ) {\n          throw Error(`Can't change type`);\n        }\n\n        const childrenRules: CSSSniffStyleSheet = existingMediaRule\n          ? existingMediaRule.children\n          : {};\n\n        _filterCSSRulesByElement(el, cssRulesArray, options, childrenRules);\n\n        if (Object.keys(childrenRules).length > 0) {\n          cssSniffStyleSheet[i] = {\n            type: \"CSSSniffMediaRule\",\n            before: \"@media \" + conditionText,\n            children: childrenRules,\n          };\n        }\n      }\n    }\n  }\n}\n\nfunction sheetIsAllowed(sheet: StyleSheet, options: Options) {\n  // Returns boolean of whether the sheet is allowed\n  // due to whitelist/blacklist\n  if (!sheet) return false;\n  if (!sheet.ownerNode) return true;\n\n  const checkStylesheet = (sheet: StyleSheet, sheetMatch: string) => {\n    switch (sheet.ownerNode.nodeName.toLowerCase()) {\n      case \"style\":\n      case \"link\":\n        // @ts-ignore\n        const el: HTMLElement = sheet.ownerNode;\n        // matching on JSON.stringify(node.attrs)\n        const nodeAttrs = el.attributes;\n        const attrs: Record<string, string> = {};\n        for (let i = 0; i < nodeAttrs.length; i++) {\n          const name = nodeAttrs[i].name;\n          attrs[name] = nodeAttrs[i].value;\n        }\n        const attributesJSON = JSON.stringify(attrs);\n        return attributesJSON.indexOf(sheetMatch) !== -1;\n    }\n    throw new Error(\n      `CSS Sniff: Unknown sheet nodeName of ${\n        sheet.ownerNode && sheet.ownerNode.nodeName\n      } `\n    );\n  };\n\n  let whitelisted = true;\n  let blacklisted = false;\n\n  const whitelistStylesheets =\n    options.whitelist && options.whitelist.stylesheet;\n  if (whitelistStylesheets) {\n    const sheetMatches = Array.isArray(whitelistStylesheets)\n      ? Array.from(whitelistStylesheets)\n      : [whitelistStylesheets];\n    whitelisted = sheetMatches.some((sheetMatch) =>\n      checkStylesheet(sheet, sheetMatch)\n    );\n  }\n\n  const blacklistStylesheets =\n    options.blacklist && options.blacklist.stylesheet;\n  if (blacklistStylesheets) {\n    const sheetMatches = Array.isArray(blacklistStylesheets)\n      ? blacklistStylesheets\n      : [blacklistStylesheets];\n    blacklisted = sheetMatches.some((sheetMatch) =>\n      checkStylesheet(sheet, sheetMatch)\n    );\n  }\n\n  return whitelisted !== false && blacklisted !== true;\n}\n\nfunction mediaIsAllowed(mediaString: string, options: Options) {\n  if (!options || !mediaString) return false;\n\n  let whitelisted = true;\n  let blacklisted = false;\n\n  const whitelistMedia = options.whitelist && options.whitelist.media;\n  if (whitelistMedia) {\n    const mediaMatches = Array.isArray(whitelistMedia)\n      ? whitelistMedia\n      : [whitelistMedia];\n    whitelisted = mediaMatches.some(\n      (mediaMatch) => mediaString.indexOf(mediaMatch) !== -1\n    );\n  }\n\n  const blacklistMedia = options.blacklist && options.blacklist.media;\n  if (blacklistMedia) {\n    const mediaMatches = Array.isArray(blacklistMedia)\n      ? blacklistMedia\n      : [blacklistMedia];\n    blacklisted = mediaMatches.some(\n      (mediaMatch) => mediaString.indexOf(mediaMatch) !== -1\n    );\n  }\n\n  return whitelisted !== false && blacklisted !== true;\n}\n\nfunction ruleIsAllowed(ruleString: string, options: Options) {\n  if (!options || !ruleString) return false;\n\n  let whitelisted = true;\n  let blacklisted = false;\n\n  const whitelistRules = options.whitelist && options.whitelist?.rule;\n  if (whitelistRules) {\n    const ruleMatches = Array.isArray(whitelistRules)\n      ? whitelistRules\n      : [whitelistRules];\n    whitelisted = ruleMatches.some(\n      (ruleMatch) => ruleString.indexOf(ruleMatch) !== -1\n    );\n  }\n\n  const blacklistRules = options.blacklist && options.blacklist.rule;\n  if (blacklistRules) {\n    const ruleMatches = Array.isArray(blacklistRules)\n      ? blacklistRules\n      : [blacklistRules];\n    blacklisted = ruleMatches.some(\n      (ruleMatch) => ruleString.indexOf(ruleMatch) !== -1\n    );\n  }\n\n  return whitelisted !== false && blacklisted !== true;\n}\n\nexport function mergeMatches(matchedCSSArray: CSSSniffRoot[]): CSSSniffRoot {\n  // Via https://stackoverflow.com/a/34749873\n  const isObject = (item: any): boolean => {\n    return item && typeof item === \"object\" && !Array.isArray(item);\n  };\n\n  // @ts-ignore\n  type NestedObject = Record<string, NestedObject>;\n\n  const mergeDeep = (\n    target: NestedObject,\n    ...sources: NestedObject[]\n  ): NestedObject => {\n    if (!sources.length) return target;\n    const source = sources.shift();\n\n    if (isObject(target) && isObject(source)) {\n      for (const key in source) {\n        if (isObject(source[key])) {\n          if (!target[key]) {\n            target[key] = {};\n          }\n          const matchedCSS = target[key];\n          if (!matchedCSS) {\n            throw Error(\"Expected to be able to create key\");\n          }\n          mergeDeep(matchedCSS, source[key]);\n        } else {\n          Object.assign(target, { [key]: source[key] });\n        }\n      }\n    }\n    return mergeDeep(target, ...sources);\n  };\n  return mergeDeep({}, ...matchedCSSArray);\n}\n\nexport function serializeCSSMatches(matchedCSS: CSSSniffRoot): string {\n  let css = \"\";\n\n  Object.keys(matchedCSS).forEach((sheetIndex: string) => {\n    const sheet = matchedCSS[sheetIndex];\n\n    Object.keys(sheet).forEach((ruleIndex: string) => {\n      const rule = sheet[ruleIndex];\n      if (rule.type === \"CSSSniffStyleRule\") {\n        css += rule.selectors.join(\",\");\n        css += \"{\";\n        css += rule.properties;\n        css += \"}\";\n      } else if (rule.type === \"CSSSniffMediaRule\") {\n        css += rule.before;\n        css += \"{\";\n        Object.keys(rule.children).forEach((childRuleIndex: string) => {\n          const childRule = rule.children[childRuleIndex];\n          if (childRule.type === \"CSSSniffStyleRule\") {\n            css += childRule.selectors.join(\",\");\n            css += \"{\";\n            css += childRule.properties;\n            css += \"}\";\n          } else {\n            throw Error(\"Can't serialize invalid CSS structure\");\n          }\n        });\n        css += \"}\";\n      }\n    });\n  });\n\n  return css;\n}\n\nexport function serializeCSSMatchesAsProperties(\n  matchedCSS: CSSSniffRoot\n): string {\n  return Object.values(matchedCSS)\n    .map((sheet): string => {\n      return Object.values(sheet)\n        .map((rule): string => {\n          if (rule.type === \"CSSSniffStyleRule\") {\n            return rule.properties;\n          } else if (rule.type === \"CSSSniffMediaRule\") {\n            return `${rule.before}{${Object.values(rule.children)\n              .map((childRule): string => {\n                if (childRule.type === \"CSSSniffStyleRule\") {\n                  return childRule.properties;\n                }\n                throw Error(\"Invalid structure\");\n              })\n              .join(\"\")}}`;\n          }\n          throw Error(`Unknown type.`);\n        })\n        .join(\"\");\n    })\n    .join(\";\")\n    .trim();\n}\n\nexport function cssRootDiff(a: CSSSniffRoot, b: CSSSniffRoot): CSSSniffRoot {\n  const diff: CSSSniffRoot = {};\n\n  Object.keys(b).forEach((bSheetIndex) => {\n    const bSheet = b[bSheetIndex];\n    Object.keys(bSheet).forEach((bRuleIndex) => {\n      const bRule = bSheet[bRuleIndex];\n      let diffStyleSheet: CSSSniffStyleSheet = diff[bSheetIndex] || {};\n      if (bRule.type === \"CSSSniffStyleRule\") {\n        if (!a[bSheetIndex] || !a[bSheetIndex][bRuleIndex]) {\n          diffStyleSheet[bRuleIndex] = bRule;\n          diff[bSheetIndex] = diffStyleSheet;\n        }\n      } else if (bRule.type === \"CSSSniffMediaRule\") {\n        const diffRule = diff[bSheetIndex] && diff[bSheetIndex][bRuleIndex];\n        if (diffRule && diffRule.type !== \"CSSSniffMediaRule\") {\n          throw Error(`Cannot change type of diff`);\n        }\n        const aRule = a[bSheetIndex] && a[bSheetIndex][bRuleIndex];\n        if (aRule && aRule.type !== \"CSSSniffMediaRule\") {\n          throw Error(`Cannot change type of (a)`);\n        }\n        const diffChildren = diffRule.children || {};\n        Object.keys(bRule.children).forEach((bRuleChildIndex) => {\n          if (!aRule || !aRule.children[bRuleChildIndex]) {\n            diffChildren[bRuleChildIndex] = bRule.children[bRuleChildIndex];\n          }\n        });\n        if (Object.keys(diffChildren).length > 0) {\n          diffStyleSheet[bRuleIndex] = {\n            ...bRule,\n            children: diffChildren,\n          };\n          diff[bSheetIndex] = diffStyleSheet;\n        }\n      }\n    });\n  });\n\n  return diff;\n}\n\nexport function splitSelectors(selectors: string): string[] {\n  /*\n    split-css-selector by Joakim Carlstein (C) 2015 for\n    function 'splitSelectors'. Licenced under MIT\n  */\n  function isAtRule(selector: string): boolean {\n    return selector.indexOf(\"@\") === 0;\n  }\n\n  if (isAtRule(selectors)) {\n    return [selectors];\n  }\n\n  var splitted = [];\n  var parens = 0;\n  var angulars = 0;\n  var soFar = \"\";\n  for (var i = 0, len = selectors.length; i < len; i++) {\n    var char = selectors[i];\n    if (char === \"(\") {\n      parens += 1;\n    } else if (char === \")\") {\n      parens -= 1;\n    } else if (char === \"[\") {\n      angulars += 1;\n    } else if (char === \"]\") {\n      angulars -= 1;\n    } else if (char === \",\") {\n      if (!parens && !angulars) {\n        splitted.push(soFar.trim());\n        soFar = \"\";\n        continue;\n      }\n    }\n    soFar += char;\n  }\n  splitted.push(soFar.trim());\n  return splitted;\n}\n\nconst unique = `css-sniff-placeholder`;\n","import { Log } from \"../log\";\nimport {\n  MetaHTMLIfSuccessInternal,\n  MetaHTMLIfFailureInternal,\n} from \"./metaComponent\";\nimport { parseExpression } from \"@babel/parser\";\nimport generate from \"@babel/generator\";\n\ntype Props = {\n  htmlElement: HTMLElement;\n  log: Log;\n};\n\nexport const parseMetaHTMLIf = ({\n  htmlElement,\n  log,\n}: Props):\n  | Omit<MetaHTMLIfSuccessInternal, \"children\">\n  | Omit<MetaHTMLIfFailureInternal, \"children\"> => {\n  const optional = !!htmlElement.hasAttribute(\"optional\");\n  const test =\n    htmlElement.getAttribute(\"test\") || htmlElement.getAttribute(\"key\"); // 'key' is legacy from MetaComponent v1\n  if (!test) {\n    log(\n      `Expected to find 'test' (or 'key' for legacy support) attribute on m-if`\n    );\n  }\n\n  try {\n    let testAsJavaScriptExpression = \"\";\n    let testAsPythonExpression = \"\";\n    let testAsPHPExpression = \"\";\n    let ids: string[] = [];\n    if (test) {\n      const AST = parseExpression(test);\n      if (![\"BinaryExpression\", \"Identifier\"].includes(AST.type)) {\n        throw Error(\n          `<m-if test=\"${test}\"> expression must only include JavaScript expressions that are either (1) a variable, or (2) a variable comparison to a string \" myVar === 'value' \" or \" myVar !== 'value' \".`\n        );\n      }\n      ids = findIdentifiers(AST);\n      switch (AST.type) {\n        case \"BinaryExpression\": {\n          testAsJavaScriptExpression = generate(AST).code;\n          testAsPythonExpression = `${toPython(AST.left)} ${to2CharOperator(\n            AST.operator\n          )} ${toPython(AST.right)}`;\n          testAsPHPExpression = `${toPHP(AST.left)} ${to2CharOperator(\n            AST.operator\n          )} ${toPHP(AST.right)}`;\n          break;\n        }\n        case \"Identifier\": {\n          testAsJavaScriptExpression = generate(AST).code;\n          testAsPythonExpression = AST.name;\n          testAsPHPExpression = `$${AST.name}`;\n          break;\n        }\n      }\n    }\n\n    return {\n      type: \"If\",\n      ids,\n      testAsJavaScriptExpression,\n      testAsPythonExpression,\n      testAsPHPExpression,\n      optional,\n      parseError: false,\n    };\n  } catch (e) {\n    log(`JS Expression:\\n\\t${test}\\n`, e);\n    return { type: \"If\", optional, parseError: true, error: e.toString() };\n  }\n};\n\nfunction findIdentifiers(AST: ReturnType<typeof parseExpression>): string[] {\n  const ids: string[] = [];\n\n  const walk = (node: any) => {\n    if (node.type === \"Identifier\" && node.name) {\n      ids.push(node.name);\n    } else if (node.identifierName) {\n      ids.push(node.identifierName);\n    }\n    // Object.keys(node).forEach((name) => walk(node[name]));\n  };\n  // @ts-ignore\n  Object.keys(AST).forEach((name) => walk(AST[name]));\n\n  return ids;\n}\n\nfunction toPHP(astNode: ReturnType<typeof parseExpression>): string {\n  switch (astNode.type) {\n    case \"Identifier\":\n      return `$${astNode.name.toString()}`;\n    case \"StringLiteral\": {\n      return JSON.stringify(astNode.value.toString()); // handles escaping similarly to PHP\n    }\n  }\n  throw Error(`Unsupported AST type \"${astNode.type}\"`);\n}\n\nfunction toPython(astNode: ReturnType<typeof parseExpression>): string {\n  switch (astNode.type) {\n    case \"Identifier\":\n      return stringToDjangoVar(astNode.name.toString());\n    case \"StringLiteral\": {\n      return JSON.stringify(astNode.value.toString()); // handles escaping similarly to PHP\n    }\n  }\n  throw Error(`Unsupported AST type \"${astNode.type}\"`);\n}\n\nfunction to2CharOperator(operator: string): string {\n  return operator.replace(/===/gi, \"==\").replace(/!==/gi, \"!=\");\n}\n\nexport function stringToDjangoVar(str: string): string {\n  return str.replace(/[^a-zA-Z_0-9]/g, \"_\");\n}\n","import { MetaNodeInternal } from \"./metaComponent\";\nimport { Log } from \"../log\";\nimport { MetaAttributeVariableOptions } from \"./parseMetaHTMLAttribute\";\n\ntype PropTypeAttributeValue = {\n  type: \"PropTypeAttributeValue\";\n  required: boolean;\n  nodeName: string;\n  attributeName: string;\n};\n\ntype PropTypeAttributeValueOptions = {\n  type: \"PropTypeAttributeValueOptions\";\n  required: boolean;\n  nodeName: string;\n  attributeName: string;\n  options: MetaAttributeVariableOptions[\"options\"];\n};\n\ntype PropTypeVariable = {\n  type: \"PropTypeVariable\";\n  required: boolean;\n};\n\n// These are return props not the props given to this function\nexport type Props = Record<\n  string,\n  PropTypeAttributeValue | PropTypeAttributeValueOptions | PropTypeVariable\n>;\n\nexport function getProps(nodes: MetaNodeInternal[], log: Log): Props {\n  const props: Props = {};\n\n  const walk = (node: MetaNodeInternal) => {\n    switch (node.type) {\n      case \"Element\":\n        {\n          const attributeNames = Object.keys(node.attributes);\n          attributeNames.forEach((attributeName) => {\n            const attributeValueParts = node.attributes[attributeName];\n            attributeValueParts.forEach((attributeValuePart) => {\n              if (attributeValuePart.type === \"MetaAttributeVariable\") {\n                if (!attributeValuePart.id) {\n                  log(\n                    `Ignoring empty prop id. ${JSON.stringify(\n                      attributeValuePart\n                    )} from ${JSON.stringify(node)}`\n                  );\n                  return;\n                }\n                if (\n                  props[attributeValuePart.id] &&\n                  props[attributeValuePart.id].type ===\n                    \"PropTypeAttributeValueOptions\"\n                ) {\n                  return; // don't clobber with a less-specific typing than options\n                }\n                props[attributeValuePart.id] = {\n                  type: \"PropTypeAttributeValue\",\n                  required: attributeValuePart.required,\n                  nodeName: node.nodeName,\n                  attributeName,\n                };\n              } else if (\n                attributeValuePart.type === \"MetaAttributeVariableOptions\"\n              ) {\n                if (!attributeValuePart.id) {\n                  log(\n                    `Ignoring empty prop id. ${JSON.stringify(\n                      attributeValuePart\n                    )} from ${JSON.stringify(node)}`\n                  );\n                  return;\n                }\n                props[attributeValuePart.id] = {\n                  type: \"PropTypeAttributeValueOptions\",\n                  required: attributeValuePart.required,\n                  nodeName: node.nodeName,\n                  attributeName,\n                  options: attributeValuePart.options,\n                };\n              }\n            });\n          });\n          node.children.forEach(walk);\n        }\n        break;\n      case \"If\":\n        if (node.parseError === false) {\n          node.ids.forEach((id) => {\n            if (!id) {\n              log(`Ignoring empty prop id from ${JSON.stringify(node)}`);\n              return;\n            }\n            if (props[id]) return; // don't clobber a more specific typing\n\n            props[id] = {\n              type: \"PropTypeVariable\",\n              required: !node.optional,\n            };\n          });\n        }\n        node.children.forEach(walk);\n        break;\n      case \"Variable\": {\n        if (!node.id) {\n          log(`Ignoring empty prop id from ${JSON.stringify(node)}`);\n          break;\n        }\n        if (props[node.id]) {\n          // don't clobber a more specific typing\n          // but making it optional is ok\n          if (node.optional) {\n            props[node.id].required = false;\n          }\n          return;\n        }\n        props[node.id] = {\n          type: \"PropTypeVariable\",\n          required: !node.optional,\n        };\n        node.children.forEach(walk);\n        break;\n      }\n    }\n  };\n\n  nodes.forEach(walk);\n\n  return props;\n}\n","// All credit to https://stackoverflow.com/a/9337047\nexport const validJavaScriptIdentifer = /^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z_a-z\\xaa\\xb5\\xba\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\u02c1\\u02c6-\\u02d1\\u02e0-\\u02e4\\u02ec\\u02ee\\u0370-\\u0374\\u0376\\u0377\\u037a-\\u037d\\u0386\\u0388-\\u038a\\u038c\\u038e-\\u03a1\\u03a3-\\u03f5\\u03f7-\\u0481\\u048a-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05d0-\\u05ea\\u05f0-\\u05f2\\u0620-\\u064a\\u066e\\u066f\\u0671-\\u06d3\\u06d5\\u06e5\\u06e6\\u06ee\\u06ef\\u06fa-\\u06fc\\u06ff\\u0710\\u0712-\\u072f\\u074d-\\u07a5\\u07b1\\u07ca-\\u07ea\\u07f4\\u07f5\\u07fa\\u0800-\\u0815\\u081a\\u0824\\u0828\\u0840-\\u0858\\u08a0\\u08a2-\\u08ac\\u0904-\\u0939\\u093d\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097f\\u0985-\\u098c\\u098f\\u0990\\u0993-\\u09a8\\u09aa-\\u09b0\\u09b2\\u09b6-\\u09b9\\u09bd\\u09ce\\u09dc\\u09dd\\u09df-\\u09e1\\u09f0\\u09f1\\u0a05-\\u0a0a\\u0a0f\\u0a10\\u0a13-\\u0a28\\u0a2a-\\u0a30\\u0a32\\u0a33\\u0a35\\u0a36\\u0a38\\u0a39\\u0a59-\\u0a5c\\u0a5e\\u0a72-\\u0a74\\u0a85-\\u0a8d\\u0a8f-\\u0a91\\u0a93-\\u0aa8\\u0aaa-\\u0ab0\\u0ab2\\u0ab3\\u0ab5-\\u0ab9\\u0abd\\u0ad0\\u0ae0\\u0ae1\\u0b05-\\u0b0c\\u0b0f\\u0b10\\u0b13-\\u0b28\\u0b2a-\\u0b30\\u0b32\\u0b33\\u0b35-\\u0b39\\u0b3d\\u0b5c\\u0b5d\\u0b5f-\\u0b61\\u0b71\\u0b83\\u0b85-\\u0b8a\\u0b8e-\\u0b90\\u0b92-\\u0b95\\u0b99\\u0b9a\\u0b9c\\u0b9e\\u0b9f\\u0ba3\\u0ba4\\u0ba8-\\u0baa\\u0bae-\\u0bb9\\u0bd0\\u0c05-\\u0c0c\\u0c0e-\\u0c10\\u0c12-\\u0c28\\u0c2a-\\u0c33\\u0c35-\\u0c39\\u0c3d\\u0c58\\u0c59\\u0c60\\u0c61\\u0c85-\\u0c8c\\u0c8e-\\u0c90\\u0c92-\\u0ca8\\u0caa-\\u0cb3\\u0cb5-\\u0cb9\\u0cbd\\u0cde\\u0ce0\\u0ce1\\u0cf1\\u0cf2\\u0d05-\\u0d0c\\u0d0e-\\u0d10\\u0d12-\\u0d3a\\u0d3d\\u0d4e\\u0d60\\u0d61\\u0d7a-\\u0d7f\\u0d85-\\u0d96\\u0d9a-\\u0db1\\u0db3-\\u0dbb\\u0dbd\\u0dc0-\\u0dc6\\u0e01-\\u0e30\\u0e32\\u0e33\\u0e40-\\u0e46\\u0e81\\u0e82\\u0e84\\u0e87\\u0e88\\u0e8a\\u0e8d\\u0e94-\\u0e97\\u0e99-\\u0e9f\\u0ea1-\\u0ea3\\u0ea5\\u0ea7\\u0eaa\\u0eab\\u0ead-\\u0eb0\\u0eb2\\u0eb3\\u0ebd\\u0ec0-\\u0ec4\\u0ec6\\u0edc-\\u0edf\\u0f00\\u0f40-\\u0f47\\u0f49-\\u0f6c\\u0f88-\\u0f8c\\u1000-\\u102a\\u103f\\u1050-\\u1055\\u105a-\\u105d\\u1061\\u1065\\u1066\\u106e-\\u1070\\u1075-\\u1081\\u108e\\u10a0-\\u10c5\\u10c7\\u10cd\\u10d0-\\u10fa\\u10fc-\\u1248\\u124a-\\u124d\\u1250-\\u1256\\u1258\\u125a-\\u125d\\u1260-\\u1288\\u128a-\\u128d\\u1290-\\u12b0\\u12b2-\\u12b5\\u12b8-\\u12be\\u12c0\\u12c2-\\u12c5\\u12c8-\\u12d6\\u12d8-\\u1310\\u1312-\\u1315\\u1318-\\u135a\\u1380-\\u138f\\u13a0-\\u13f4\\u1401-\\u166c\\u166f-\\u167f\\u1681-\\u169a\\u16a0-\\u16ea\\u16ee-\\u16f0\\u1700-\\u170c\\u170e-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176c\\u176e-\\u1770\\u1780-\\u17b3\\u17d7\\u17dc\\u1820-\\u1877\\u1880-\\u18a8\\u18aa\\u18b0-\\u18f5\\u1900-\\u191c\\u1950-\\u196d\\u1970-\\u1974\\u1980-\\u19ab\\u19c1-\\u19c7\\u1a00-\\u1a16\\u1a20-\\u1a54\\u1aa7\\u1b05-\\u1b33\\u1b45-\\u1b4b\\u1b83-\\u1ba0\\u1bae\\u1baf\\u1bba-\\u1be5\\u1c00-\\u1c23\\u1c4d-\\u1c4f\\u1c5a-\\u1c7d\\u1ce9-\\u1cec\\u1cee-\\u1cf1\\u1cf5\\u1cf6\\u1d00-\\u1dbf\\u1e00-\\u1f15\\u1f18-\\u1f1d\\u1f20-\\u1f45\\u1f48-\\u1f4d\\u1f50-\\u1f57\\u1f59\\u1f5b\\u1f5d\\u1f5f-\\u1f7d\\u1f80-\\u1fb4\\u1fb6-\\u1fbc\\u1fbe\\u1fc2-\\u1fc4\\u1fc6-\\u1fcc\\u1fd0-\\u1fd3\\u1fd6-\\u1fdb\\u1fe0-\\u1fec\\u1ff2-\\u1ff4\\u1ff6-\\u1ffc\\u2071\\u207f\\u2090-\\u209c\\u2102\\u2107\\u210a-\\u2113\\u2115\\u2119-\\u211d\\u2124\\u2126\\u2128\\u212a-\\u212d\\u212f-\\u2139\\u213c-\\u213f\\u2145-\\u2149\\u214e\\u2160-\\u2188\\u2c00-\\u2c2e\\u2c30-\\u2c5e\\u2c60-\\u2ce4\\u2ceb-\\u2cee\\u2cf2\\u2cf3\\u2d00-\\u2d25\\u2d27\\u2d2d\\u2d30-\\u2d67\\u2d6f\\u2d80-\\u2d96\\u2da0-\\u2da6\\u2da8-\\u2dae\\u2db0-\\u2db6\\u2db8-\\u2dbe\\u2dc0-\\u2dc6\\u2dc8-\\u2dce\\u2dd0-\\u2dd6\\u2dd8-\\u2dde\\u2e2f\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303c\\u3041-\\u3096\\u309d-\\u309f\\u30a1-\\u30fa\\u30fc-\\u30ff\\u3105-\\u312d\\u3131-\\u318e\\u31a0-\\u31ba\\u31f0-\\u31ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\ua000-\\ua48c\\ua4d0-\\ua4fd\\ua500-\\ua60c\\ua610-\\ua61f\\ua62a\\ua62b\\ua640-\\ua66e\\ua67f-\\ua697\\ua6a0-\\ua6ef\\ua717-\\ua71f\\ua722-\\ua788\\ua78b-\\ua78e\\ua790-\\ua793\\ua7a0-\\ua7aa\\ua7f8-\\ua801\\ua803-\\ua805\\ua807-\\ua80a\\ua80c-\\ua822\\ua840-\\ua873\\ua882-\\ua8b3\\ua8f2-\\ua8f7\\ua8fb\\ua90a-\\ua925\\ua930-\\ua946\\ua960-\\ua97c\\ua984-\\ua9b2\\ua9cf\\uaa00-\\uaa28\\uaa40-\\uaa42\\uaa44-\\uaa4b\\uaa60-\\uaa76\\uaa7a\\uaa80-\\uaaaf\\uaab1\\uaab5\\uaab6\\uaab9-\\uaabd\\uaac0\\uaac2\\uaadb-\\uaadd\\uaae0-\\uaaea\\uaaf2-\\uaaf4\\uab01-\\uab06\\uab09-\\uab0e\\uab11-\\uab16\\uab20-\\uab26\\uab28-\\uab2e\\uabc0-\\uabe2\\uac00-\\ud7a3\\ud7b0-\\ud7c6\\ud7cb-\\ud7fb\\uf900-\\ufa6d\\ufa70-\\ufad9\\ufb00-\\ufb06\\ufb13-\\ufb17\\ufb1d\\ufb1f-\\ufb28\\ufb2a-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40\\ufb41\\ufb43\\ufb44\\ufb46-\\ufbb1\\ufbd3-\\ufd3d\\ufd50-\\ufd8f\\ufd92-\\ufdc7\\ufdf0-\\ufdfb\\ufe70-\\ufe74\\ufe76-\\ufefc\\uff21-\\uff3a\\uff41-\\uff5a\\uff66-\\uffbe\\uffc2-\\uffc7\\uffca-\\uffcf\\uffd2-\\uffd7\\uffda-\\uffdc][$A-Z_a-z\\xaa\\xb5\\xba\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\u02c1\\u02c6-\\u02d1\\u02e0-\\u02e4\\u02ec\\u02ee\\u0370-\\u0374\\u0376\\u0377\\u037a-\\u037d\\u0386\\u0388-\\u038a\\u038c\\u038e-\\u03a1\\u03a3-\\u03f5\\u03f7-\\u0481\\u048a-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05d0-\\u05ea\\u05f0-\\u05f2\\u0620-\\u064a\\u066e\\u066f\\u0671-\\u06d3\\u06d5\\u06e5\\u06e6\\u06ee\\u06ef\\u06fa-\\u06fc\\u06ff\\u0710\\u0712-\\u072f\\u074d-\\u07a5\\u07b1\\u07ca-\\u07ea\\u07f4\\u07f5\\u07fa\\u0800-\\u0815\\u081a\\u0824\\u0828\\u0840-\\u0858\\u08a0\\u08a2-\\u08ac\\u0904-\\u0939\\u093d\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097f\\u0985-\\u098c\\u098f\\u0990\\u0993-\\u09a8\\u09aa-\\u09b0\\u09b2\\u09b6-\\u09b9\\u09bd\\u09ce\\u09dc\\u09dd\\u09df-\\u09e1\\u09f0\\u09f1\\u0a05-\\u0a0a\\u0a0f\\u0a10\\u0a13-\\u0a28\\u0a2a-\\u0a30\\u0a32\\u0a33\\u0a35\\u0a36\\u0a38\\u0a39\\u0a59-\\u0a5c\\u0a5e\\u0a72-\\u0a74\\u0a85-\\u0a8d\\u0a8f-\\u0a91\\u0a93-\\u0aa8\\u0aaa-\\u0ab0\\u0ab2\\u0ab3\\u0ab5-\\u0ab9\\u0abd\\u0ad0\\u0ae0\\u0ae1\\u0b05-\\u0b0c\\u0b0f\\u0b10\\u0b13-\\u0b28\\u0b2a-\\u0b30\\u0b32\\u0b33\\u0b35-\\u0b39\\u0b3d\\u0b5c\\u0b5d\\u0b5f-\\u0b61\\u0b71\\u0b83\\u0b85-\\u0b8a\\u0b8e-\\u0b90\\u0b92-\\u0b95\\u0b99\\u0b9a\\u0b9c\\u0b9e\\u0b9f\\u0ba3\\u0ba4\\u0ba8-\\u0baa\\u0bae-\\u0bb9\\u0bd0\\u0c05-\\u0c0c\\u0c0e-\\u0c10\\u0c12-\\u0c28\\u0c2a-\\u0c33\\u0c35-\\u0c39\\u0c3d\\u0c58\\u0c59\\u0c60\\u0c61\\u0c85-\\u0c8c\\u0c8e-\\u0c90\\u0c92-\\u0ca8\\u0caa-\\u0cb3\\u0cb5-\\u0cb9\\u0cbd\\u0cde\\u0ce0\\u0ce1\\u0cf1\\u0cf2\\u0d05-\\u0d0c\\u0d0e-\\u0d10\\u0d12-\\u0d3a\\u0d3d\\u0d4e\\u0d60\\u0d61\\u0d7a-\\u0d7f\\u0d85-\\u0d96\\u0d9a-\\u0db1\\u0db3-\\u0dbb\\u0dbd\\u0dc0-\\u0dc6\\u0e01-\\u0e30\\u0e32\\u0e33\\u0e40-\\u0e46\\u0e81\\u0e82\\u0e84\\u0e87\\u0e88\\u0e8a\\u0e8d\\u0e94-\\u0e97\\u0e99-\\u0e9f\\u0ea1-\\u0ea3\\u0ea5\\u0ea7\\u0eaa\\u0eab\\u0ead-\\u0eb0\\u0eb2\\u0eb3\\u0ebd\\u0ec0-\\u0ec4\\u0ec6\\u0edc-\\u0edf\\u0f00\\u0f40-\\u0f47\\u0f49-\\u0f6c\\u0f88-\\u0f8c\\u1000-\\u102a\\u103f\\u1050-\\u1055\\u105a-\\u105d\\u1061\\u1065\\u1066\\u106e-\\u1070\\u1075-\\u1081\\u108e\\u10a0-\\u10c5\\u10c7\\u10cd\\u10d0-\\u10fa\\u10fc-\\u1248\\u124a-\\u124d\\u1250-\\u1256\\u1258\\u125a-\\u125d\\u1260-\\u1288\\u128a-\\u128d\\u1290-\\u12b0\\u12b2-\\u12b5\\u12b8-\\u12be\\u12c0\\u12c2-\\u12c5\\u12c8-\\u12d6\\u12d8-\\u1310\\u1312-\\u1315\\u1318-\\u135a\\u1380-\\u138f\\u13a0-\\u13f4\\u1401-\\u166c\\u166f-\\u167f\\u1681-\\u169a\\u16a0-\\u16ea\\u16ee-\\u16f0\\u1700-\\u170c\\u170e-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176c\\u176e-\\u1770\\u1780-\\u17b3\\u17d7\\u17dc\\u1820-\\u1877\\u1880-\\u18a8\\u18aa\\u18b0-\\u18f5\\u1900-\\u191c\\u1950-\\u196d\\u1970-\\u1974\\u1980-\\u19ab\\u19c1-\\u19c7\\u1a00-\\u1a16\\u1a20-\\u1a54\\u1aa7\\u1b05-\\u1b33\\u1b45-\\u1b4b\\u1b83-\\u1ba0\\u1bae\\u1baf\\u1bba-\\u1be5\\u1c00-\\u1c23\\u1c4d-\\u1c4f\\u1c5a-\\u1c7d\\u1ce9-\\u1cec\\u1cee-\\u1cf1\\u1cf5\\u1cf6\\u1d00-\\u1dbf\\u1e00-\\u1f15\\u1f18-\\u1f1d\\u1f20-\\u1f45\\u1f48-\\u1f4d\\u1f50-\\u1f57\\u1f59\\u1f5b\\u1f5d\\u1f5f-\\u1f7d\\u1f80-\\u1fb4\\u1fb6-\\u1fbc\\u1fbe\\u1fc2-\\u1fc4\\u1fc6-\\u1fcc\\u1fd0-\\u1fd3\\u1fd6-\\u1fdb\\u1fe0-\\u1fec\\u1ff2-\\u1ff4\\u1ff6-\\u1ffc\\u2071\\u207f\\u2090-\\u209c\\u2102\\u2107\\u210a-\\u2113\\u2115\\u2119-\\u211d\\u2124\\u2126\\u2128\\u212a-\\u212d\\u212f-\\u2139\\u213c-\\u213f\\u2145-\\u2149\\u214e\\u2160-\\u2188\\u2c00-\\u2c2e\\u2c30-\\u2c5e\\u2c60-\\u2ce4\\u2ceb-\\u2cee\\u2cf2\\u2cf3\\u2d00-\\u2d25\\u2d27\\u2d2d\\u2d30-\\u2d67\\u2d6f\\u2d80-\\u2d96\\u2da0-\\u2da6\\u2da8-\\u2dae\\u2db0-\\u2db6\\u2db8-\\u2dbe\\u2dc0-\\u2dc6\\u2dc8-\\u2dce\\u2dd0-\\u2dd6\\u2dd8-\\u2dde\\u2e2f\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303c\\u3041-\\u3096\\u309d-\\u309f\\u30a1-\\u30fa\\u30fc-\\u30ff\\u3105-\\u312d\\u3131-\\u318e\\u31a0-\\u31ba\\u31f0-\\u31ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\ua000-\\ua48c\\ua4d0-\\ua4fd\\ua500-\\ua60c\\ua610-\\ua61f\\ua62a\\ua62b\\ua640-\\ua66e\\ua67f-\\ua697\\ua6a0-\\ua6ef\\ua717-\\ua71f\\ua722-\\ua788\\ua78b-\\ua78e\\ua790-\\ua793\\ua7a0-\\ua7aa\\ua7f8-\\ua801\\ua803-\\ua805\\ua807-\\ua80a\\ua80c-\\ua822\\ua840-\\ua873\\ua882-\\ua8b3\\ua8f2-\\ua8f7\\ua8fb\\ua90a-\\ua925\\ua930-\\ua946\\ua960-\\ua97c\\ua984-\\ua9b2\\ua9cf\\uaa00-\\uaa28\\uaa40-\\uaa42\\uaa44-\\uaa4b\\uaa60-\\uaa76\\uaa7a\\uaa80-\\uaaaf\\uaab1\\uaab5\\uaab6\\uaab9-\\uaabd\\uaac0\\uaac2\\uaadb-\\uaadd\\uaae0-\\uaaea\\uaaf2-\\uaaf4\\uab01-\\uab06\\uab09-\\uab0e\\uab11-\\uab16\\uab20-\\uab26\\uab28-\\uab2e\\uabc0-\\uabe2\\uac00-\\ud7a3\\ud7b0-\\ud7c6\\ud7cb-\\ud7fb\\uf900-\\ufa6d\\ufa70-\\ufad9\\ufb00-\\ufb06\\ufb13-\\ufb17\\ufb1d\\ufb1f-\\ufb28\\ufb2a-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40\\ufb41\\ufb43\\ufb44\\ufb46-\\ufbb1\\ufbd3-\\ufd3d\\ufd50-\\ufd8f\\ufd92-\\ufdc7\\ufdf0-\\ufdfb\\ufe70-\\ufe74\\ufe76-\\ufefc\\uff21-\\uff3a\\uff41-\\uff5a\\uff66-\\uffbe\\uffc2-\\uffc7\\uffca-\\uffcf\\uffd2-\\uffd7\\uffda-\\uffdc0-9\\u0300-\\u036f\\u0483-\\u0487\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u064b-\\u0669\\u0670\\u06d6-\\u06dc\\u06df-\\u06e4\\u06e7\\u06e8\\u06ea-\\u06ed\\u06f0-\\u06f9\\u0711\\u0730-\\u074a\\u07a6-\\u07b0\\u07c0-\\u07c9\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0859-\\u085b\\u08e4-\\u08fe\\u0900-\\u0903\\u093a-\\u093c\\u093e-\\u094f\\u0951-\\u0957\\u0962\\u0963\\u0966-\\u096f\\u0981-\\u0983\\u09bc\\u09be-\\u09c4\\u09c7\\u09c8\\u09cb-\\u09cd\\u09d7\\u09e2\\u09e3\\u09e6-\\u09ef\\u0a01-\\u0a03\\u0a3c\\u0a3e-\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a66-\\u0a71\\u0a75\\u0a81-\\u0a83\\u0abc\\u0abe-\\u0ac5\\u0ac7-\\u0ac9\\u0acb-\\u0acd\\u0ae2\\u0ae3\\u0ae6-\\u0aef\\u0b01-\\u0b03\\u0b3c\\u0b3e-\\u0b44\\u0b47\\u0b48\\u0b4b-\\u0b4d\\u0b56\\u0b57\\u0b62\\u0b63\\u0b66-\\u0b6f\\u0b82\\u0bbe-\\u0bc2\\u0bc6-\\u0bc8\\u0bca-\\u0bcd\\u0bd7\\u0be6-\\u0bef\\u0c01-\\u0c03\\u0c3e-\\u0c44\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62\\u0c63\\u0c66-\\u0c6f\\u0c82\\u0c83\\u0cbc\\u0cbe-\\u0cc4\\u0cc6-\\u0cc8\\u0cca-\\u0ccd\\u0cd5\\u0cd6\\u0ce2\\u0ce3\\u0ce6-\\u0cef\\u0d02\\u0d03\\u0d3e-\\u0d44\\u0d46-\\u0d48\\u0d4a-\\u0d4d\\u0d57\\u0d62\\u0d63\\u0d66-\\u0d6f\\u0d82\\u0d83\\u0dca\\u0dcf-\\u0dd4\\u0dd6\\u0dd8-\\u0ddf\\u0df2\\u0df3\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0e50-\\u0e59\\u0eb1\\u0eb4-\\u0eb9\\u0ebb\\u0ebc\\u0ec8-\\u0ecd\\u0ed0-\\u0ed9\\u0f18\\u0f19\\u0f20-\\u0f29\\u0f35\\u0f37\\u0f39\\u0f3e\\u0f3f\\u0f71-\\u0f84\\u0f86\\u0f87\\u0f8d-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u102b-\\u103e\\u1040-\\u1049\\u1056-\\u1059\\u105e-\\u1060\\u1062-\\u1064\\u1067-\\u106d\\u1071-\\u1074\\u1082-\\u108d\\u108f-\\u109d\\u135d-\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17b4-\\u17d3\\u17dd\\u17e0-\\u17e9\\u180b-\\u180d\\u1810-\\u1819\\u18a9\\u1920-\\u192b\\u1930-\\u193b\\u1946-\\u194f\\u19b0-\\u19c0\\u19c8\\u19c9\\u19d0-\\u19d9\\u1a17-\\u1a1b\\u1a55-\\u1a5e\\u1a60-\\u1a7c\\u1a7f-\\u1a89\\u1a90-\\u1a99\\u1b00-\\u1b04\\u1b34-\\u1b44\\u1b50-\\u1b59\\u1b6b-\\u1b73\\u1b80-\\u1b82\\u1ba1-\\u1bad\\u1bb0-\\u1bb9\\u1be6-\\u1bf3\\u1c24-\\u1c37\\u1c40-\\u1c49\\u1c50-\\u1c59\\u1cd0-\\u1cd2\\u1cd4-\\u1ce8\\u1ced\\u1cf2-\\u1cf4\\u1dc0-\\u1de6\\u1dfc-\\u1dff\\u200c\\u200d\\u203f\\u2040\\u2054\\u20d0-\\u20dc\\u20e1\\u20e5-\\u20f0\\u2cef-\\u2cf1\\u2d7f\\u2de0-\\u2dff\\u302a-\\u302f\\u3099\\u309a\\ua620-\\ua629\\ua66f\\ua674-\\ua67d\\ua69f\\ua6f0\\ua6f1\\ua802\\ua806\\ua80b\\ua823-\\ua827\\ua880\\ua881\\ua8b4-\\ua8c4\\ua8d0-\\ua8d9\\ua8e0-\\ua8f1\\ua900-\\ua909\\ua926-\\ua92d\\ua947-\\ua953\\ua980-\\ua983\\ua9b3-\\ua9c0\\ua9d0-\\ua9d9\\uaa29-\\uaa36\\uaa43\\uaa4c\\uaa4d\\uaa50-\\uaa59\\uaa7b\\uaab0\\uaab2-\\uaab4\\uaab7\\uaab8\\uaabe\\uaabf\\uaac1\\uaaeb-\\uaaef\\uaaf5\\uaaf6\\uabe3-\\uabea\\uabec\\uabed\\uabf0-\\uabf9\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe26\\ufe33\\ufe34\\ufe4d-\\ufe4f\\uff10-\\uff19\\uff3f]*$/;\n\nexport function assertUnreachable(x?: never): never {\n  throw new Error(\"Didn't expect to get here\");\n}\n","import { parseHTMLWithoutInsertionMode } from \"./parseMetaHTML\";\nimport {\n  parseAttributeValue,\n  MetaAttributeValue,\n  MetaAttributeValues,\n  MetaAttributeValuesInternal,\n} from \"./parseMetaHTMLAttribute\";\nimport { parseMetaVariable } from \"./parseMetaVariable\";\nimport {\n  cssSniff,\n  serializeCSSMatches,\n  serializeCSSMatchesAsProperties,\n  cssRootDiff,\n  CSSSniffRoot,\n} from \"../cssSniff/cssSniff\";\nimport { parseMetaHTMLIf } from \"./parseMetaHTMLIf\";\nimport { getProps, Props } from \"./getProps\";\nimport { Log } from \"../log\";\nimport { assertUnreachable } from \"../makeTemplates/utils\";\n\ntype ParseMetaComponentStringProps = {\n  domDocument: Document;\n  metaHTMLString: string;\n  cssString: string;\n  log: Log;\n};\n\nexport function parseMetaComponentString({\n  domDocument,\n  metaHTMLString,\n  cssString,\n  log,\n}: ParseMetaComponentStringProps): MetaComponent {\n  parseHTMLWithoutInsertionMode({\n    domDocument,\n    metaHTMLString,\n    cssString,\n    log,\n  });\n  // now we have a DOM representing the original MetaHTMLString, so we need to build a MetaHTML\n  const bodyNodes = Array.from(domDocument.body.childNodes);\n  const nodes = bodyNodes.map((node) => nodeToMetaNode({ node, log }));\n  const metaComponent = {\n    cssString: getAllMatchingCSSRulesRecursively(nodes),\n    props: getProps(nodes, log),\n    nodes: internalToPublic(nodes),\n  };\n  return metaComponent;\n}\n\nexport type MetaComponent = {\n  cssString: string;\n  nodes: MetaNode[];\n  props: Props;\n};\n\nexport type MetaNode =\n  | MetaHTMLElement\n  | MetaHTMLText\n  | MetaHTMLComment\n  | MetaHTMLVariable\n  | MetaHTMLIf;\n\nexport type MetaNodeInternal =\n  | MetaHTMLElementInternal\n  | MetaHTMLText\n  | MetaHTMLComment\n  | MetaHTMLVariableInternal\n  | MetaHTMLIfInternal;\n\nexport type MetaHTMLElement = {\n  type: \"Element\";\n  nodeName: string;\n  attributes: Record<string, MetaAttributeValues>;\n  children: MetaNode[];\n  cssProperties: MetaCSSPropertiesNode[];\n};\n\nexport type MetaHTMLElementInternal = Omit<\n  MetaHTMLElement,\n  \"children\" | \"attributes\"\n> & {\n  children: MetaNodeInternal[];\n  attributes: Record<string, MetaAttributeValuesInternal>;\n  node: HTMLElement;\n};\n\nexport type MetaCSSPropertiesNode =\n  | MetaCSSPropertiesConditionalNode\n  | MetaCSSPropertiesConstantNode;\n\nexport type MetaCSSPropertiesConstantNode = {\n  type: \"MetaCSSPropertiesConstantNode\";\n  cssPropertiesString: string;\n};\n\nexport type MetaCSSPropertiesConditionalNode = {\n  type: \"MetaCSSPropertiesConditionalNode\";\n  id: string;\n  condition: {\n    [equalsString: string]: string; // cssProperties as string\n  };\n};\n\nexport type MetaHTMLText = { type: \"Text\"; value: string };\n\nexport type MetaHTMLComment = { type: \"Comment\"; value: string };\n\nexport type MetaHTMLVariable = {\n  type: \"Variable\";\n  id: string;\n  children: MetaNode[];\n};\n\nexport type MetaHTMLVariableInternal = {\n  type: \"Variable\";\n  id: string;\n  optional: boolean;\n  children: MetaNodeInternal[];\n};\n\ntype MetaHTMLIfBase = {\n  type: \"If\";\n  children: MetaNode[];\n};\n\nexport type MetaHTMLIfSuccess = MetaHTMLIfBase & {\n  parseError: false;\n  ids: string[];\n  testAsJavaScriptExpression: string; // a string of codegen'd JS that can be used directly.\n  testAsPythonExpression: string; // a string of codegen'd JS that can be used directly.\n  testAsPHPExpression: string; // a string of codegen'd JS that can be used directly.\n  // Other languages should be added. PRs welcome.\n};\n\nexport type MetaHTMLIfFailure = MetaHTMLIfBase & {\n  parseError: true;\n  error: string;\n};\n\nexport type MetaHTMLIf = MetaHTMLIfSuccess | MetaHTMLIfFailure;\n\nexport type MetaHTMLIfSuccessInternal = Omit<MetaHTMLIfSuccess, \"children\"> & {\n  children: MetaNodeInternal[];\n  optional: boolean;\n};\n\nexport type MetaHTMLIfFailureInternal = Omit<MetaHTMLIfFailure, \"children\"> & {\n  children: MetaNodeInternal[];\n  optional: boolean;\n};\n\nexport type MetaHTMLIfInternal =\n  | MetaHTMLIfSuccessInternal\n  | MetaHTMLIfFailureInternal;\n\ntype NodeToMetaNodeProps = {\n  node: ChildNode;\n  log: Log;\n};\n\nfunction nodeToMetaNode({ node, log }: NodeToMetaNodeProps): MetaNodeInternal {\n  if (node.nodeType === node.TEXT_NODE) {\n    return { type: \"Text\", value: node.textContent || \"\" };\n  } else if (node.nodeType === node.COMMENT_NODE) {\n    return { type: \"Comment\", value: node.textContent || \"\" };\n  } else if (node.nodeType !== node.ELEMENT_NODE) {\n    throw Error(`Unhandled nodeType ${node.nodeType}`);\n  }\n\n  // @ts-ignore\n  const htmlElement: HTMLElement = node;\n  const names = Array.from(htmlElement.getAttributeNames());\n  const nodeName = htmlElement.nodeName.toLowerCase();\n\n  if (nodeName === \"m-variable\") {\n    return {\n      ...parseMetaVariable({\n        htmlElement,\n        log,\n      }),\n      children: Array.from(node.childNodes).map((childNode) =>\n        nodeToMetaNode({ node: childNode, log })\n      ),\n    };\n  } else if (nodeName === \"m-if\") {\n    return {\n      ...parseMetaHTMLIf({ htmlElement, log }),\n      children: Array.from(node.childNodes).map((childNode) =>\n        nodeToMetaNode({ node: childNode, log })\n      ),\n    };\n  }\n\n  const attributes = names.reduce(\n    (attributes: MetaHTMLElementInternal[\"attributes\"], name: string) => {\n      const attributeValue = htmlElement.getAttribute(name);\n      if (attributeValue === null) throw Error(`Expected attribute value.`);\n      attributes[name] = parseAttributeValue(attributeValue, log);\n      return attributes;\n    },\n    {} as MetaHTMLElementInternal[\"attributes\"]\n  );\n\n  const cssProperties = getAllMatchingCSSProperties(htmlElement, attributes);\n\n  return {\n    type: \"Element\",\n    nodeName,\n    attributes: attributes,\n    node: htmlElement,\n    children: Array.from(node.childNodes).map((node) =>\n      nodeToMetaNode({ node, log })\n    ),\n    cssProperties,\n  };\n}\n\nfunction getAllMatchingCSSProperties(\n  element: HTMLElement,\n  attributes: MetaHTMLElement[\"attributes\"]\n): MetaCSSPropertiesNode[] {\n  const cssProperties: MetaCSSPropertiesNode[] = [];\n\n  resetElementAttributes(element, attributes);\n\n  const resetMatchedCSS = cssSniff([element], { ignoreChildren: true });\n\n  const cssPropertiesStringConstants = serializeCSSMatchesAsProperties(\n    resetMatchedCSS\n  );\n\n  if (cssPropertiesStringConstants) {\n    cssProperties.push({\n      type: \"MetaCSSPropertiesConstantNode\",\n      cssPropertiesString: cssPropertiesStringConstants,\n    });\n  }\n\n  Object.keys(attributes)\n    .filter(attributesThatCanBeSet)\n    .forEach((attributeName: string) => {\n      const resetValue = element.getAttribute(attributeName);\n      const attributeValues = attributes[attributeName];\n      attributeValues.forEach((attributeValue) => {\n        if (attributeValue.type === \"MetaAttributeVariableOptions\") {\n          const conditionalNode: MetaCSSPropertiesConditionalNode = {\n            type: \"MetaCSSPropertiesConditionalNode\",\n            id: attributeValue.id,\n            condition: {},\n          };\n          Object.entries(attributeValue.options).forEach(\n            ([optionName, optionValue]) => {\n              element.setAttribute(\n                attributeName,\n                `${resetValue ? `${resetValue} ` : \"\"}${optionValue}`\n              );\n              const matchedCSS = cssSniff([element], { ignoreChildren: true });\n              const cssRoot = cssRootDiff(resetMatchedCSS, matchedCSS);\n              const cssPropertiesString = serializeCSSMatchesAsProperties(\n                cssRoot\n              );\n              if (cssPropertiesString) {\n                conditionalNode.condition[optionName] = cssPropertiesString;\n              }\n              if (resetValue) {\n                element.setAttribute(attributeName, resetValue);\n              }\n            }\n          );\n          if (Object.keys(conditionalNode.condition).length > 0) {\n            cssProperties.push(conditionalNode);\n          }\n        }\n      });\n    });\n\n  return cssProperties;\n}\n\nfunction resetElementAttributes(\n  element: HTMLElement,\n  attributes: MetaHTMLElement[\"attributes\"]\n): void {\n  Object.keys(attributes)\n    .filter(attributesThatCanBeSet)\n    .forEach((name: string) => {\n      const attribute = attributes[name];\n      element.setAttribute(\n        name,\n        attribute\n          .map((metaAttribute) => {\n            if (metaAttribute.type === \"MetaAttributeConstant\") {\n              return ` ${metaAttribute.value}`;\n            }\n            // We can't predict what MetaAttributeVariable might be\n            return \"\";\n          })\n          .join(\" \")\n      );\n    });\n}\n\nfunction internalToPublic(nodes: MetaNodeInternal[]): MetaNode[] {\n  // discards the Node variable which shouldn't be exposed to consumers\n  function walk(node: MetaNodeInternal): MetaNode {\n    switch (node.type) {\n      case \"Comment\":\n      case \"Text\":\n        return node;\n      case \"Variable\":\n        return {\n          type: node.type,\n          id: node.id,\n          children: node.children.map(walk),\n        };\n      case \"If\":\n        if (node.parseError) {\n          return {\n            type: node.type,\n            parseError: node.parseError,\n            children: node.children,\n            error: node.error,\n          };\n        } else {\n          return {\n            type: node.type,\n            parseError: node.parseError,\n            ids: node.ids,\n            children: node.children,\n            testAsJavaScriptExpression: node.testAsJavaScriptExpression,\n            testAsPythonExpression: node.testAsPythonExpression,\n            testAsPHPExpression: node.testAsPHPExpression,\n          };\n        }\n      case \"Element\":\n        return {\n          type: node.type,\n          nodeName: node.nodeName,\n          attributes: walkAttributes(node.attributes),\n          cssProperties: node.cssProperties,\n          children: node.children.map(walk),\n        };\n      default:\n        throw Error(`Unrecognised node ${node}. ${JSON.stringify(node)}`);\n    }\n  }\n\n  const walkAttributes = (\n    internalAttributes: MetaHTMLElementInternal[\"attributes\"]\n  ): MetaHTMLElement[\"attributes\"] => {\n    const keys = Object.keys(internalAttributes);\n    return keys.reduce(\n      (\n        attributes: MetaHTMLElement[\"attributes\"],\n        key: string\n      ): MetaHTMLElement[\"attributes\"] => {\n        const values = internalAttributes[key];\n        const newAttributeValues = values.map(\n          (value): MetaAttributeValue => {\n            switch (value.type) {\n              case \"MetaAttributeConstant\": {\n                return value;\n              }\n              case \"MetaAttributeVariable\": {\n                return {\n                  type: value.type,\n                  id: value.id,\n                };\n              }\n              case \"MetaAttributeVariableOptions\": {\n                return {\n                  type: value.type,\n                  id: value.id,\n                  options: value.options,\n                };\n              }\n            }\n            return assertUnreachable(value);\n          }\n        );\n        attributes[key] = newAttributeValues;\n        return attributes;\n      },\n      {} as MetaHTMLElement[\"attributes\"]\n    );\n  };\n\n  return nodes.map(walk);\n}\n\nfunction getAllMatchingCSSRulesRecursively(nodes: MetaNodeInternal[]): string {\n  const matchedCSS: CSSSniffRoot = {};\n\n  function getAllMatchingCSSRules(\n    element: HTMLElement,\n    attributes: MetaHTMLElement[\"attributes\"],\n    matchedCSS: CSSSniffRoot\n  ) {\n    // Set ALL classes on element so we can find matching CSS rules.\n    //\n    // The htmlElement.className value looks like a string of,\n    //   \"thing {{ someId: class1 | class2 }} {{ someId: class3 as name1 | class4 as name2 }} \"\n    // so we want to turn that into a string of,\n    //   \"thing class1 class2 class3 class4\"\n    //\n    // In CSS the :not() could mean that adding other classes invalidates rules but MetaComponent\n    // doesn't support that.\n\n    Object.keys(attributes)\n      .filter(attributesThatCanBeSet)\n      .forEach((name: string) => {\n        const newValue = attributes[name]\n          .map((metaAttribute) => {\n            if (metaAttribute.type === \"MetaAttributeConstant\") {\n              return ` ${metaAttribute.value}`;\n            } else if (metaAttribute.type === \"MetaAttributeVariableOptions\") {\n              return ` ${Object.values(metaAttribute.options).join(\" \")}`;\n            }\n            // Else, it's a MetaAttributeVariable.\n            // We can't predict what value MetaAttributeVariable would have so we can't\n            // support detecting CSS based on that\n            return \"\";\n          })\n          .join(\" \");\n\n        element.setAttribute(name, newValue);\n      });\n\n    cssSniff([element], { ignoreChildren: true }, matchedCSS);\n  }\n\n  function walk(node: MetaNodeInternal): void {\n    switch (node.type) {\n      case \"Element\":\n        getAllMatchingCSSRules(node.node, node.attributes, matchedCSS);\n        node.children.forEach(walk);\n        break;\n      case \"If\":\n      case \"Variable\":\n        node.children.forEach(walk);\n        break;\n    }\n  }\n\n  nodes.forEach(walk);\n\n  return serializeCSSMatches(matchedCSS);\n}\n\nfunction attributesThatCanBeSet(attr: string): boolean {\n  // used to filter setting attributes on the real DOM\n  // we don't really care about any other attributes\n  return [\"class\"].includes(attr);\n}\n","import { MetaHTMLVariableInternal } from \"./metaComponent\";\nimport { Log } from \"../log\";\n\ntype Props = {\n  htmlElement: HTMLElement;\n  log: Log;\n};\n\nexport const parseMetaVariable = ({\n  htmlElement,\n  log,\n}: Props): MetaHTMLVariableInternal => {\n  let id = htmlElement.getAttribute(\"id\") || htmlElement.getAttribute(\"key\"); // 'key' is legacy from MetaComponent v1\n  if (!id) {\n    log(\n      `Expected to find 'id' (or 'key' for legacy support) attribute on m-variable ${htmlElement.outerHTML}`\n    );\n    return { type: \"Variable\", id: \"\", optional: false, children: [] };\n  }\n  const optional = htmlElement.hasAttribute(\"optional\") || id.includes(\"?\"); // inline '?' is legacy from MetaComponent v1;\n  id = id.replace(/\\?/, \"\").trim();\n  if (id.length === 0) {\n    log(\n      `Expected to find id with value on variable but it was an empty string. ${htmlElement.outerHTML}`\n    );\n  }\n  return { type: \"Variable\", id, optional, children: [] };\n};\n","import {\n  MetaHTMLElement,\n  MetaHTMLText,\n  MetaHTMLComment,\n  MetaHTMLIf,\n  MetaHTMLVariable,\n  MetaNode,\n} from \"../metaComponent/metaComponent\";\nimport { TemplateFiles } from \"../types\";\nimport { Props } from \"../metaComponent/getProps\";\n\nexport interface TemplateFormat {\n  dirname: string;\n  templateId: string;\n\n  onElement: (element: MetaHTMLElement) => string;\n  onText: (text: MetaHTMLText) => void;\n  onComment: (text: MetaHTMLComment) => void;\n  onCloseElement: (closeElement: OnCloseElement) => void;\n  onVariable: (onVariable: MetaHTMLVariable) => OnVariableResponse;\n  onCloseVariable: (closeVariable: MetaHTMLVariable) => void;\n  onIf: (onIf: MetaHTMLIf) => void;\n  onCloseIf: (onCloseIf: MetaHTMLIf) => void;\n  onFinalise: (args: OnFinalise) => void;\n  serialize: () => TemplateFiles;\n}\n\nexport type OnConstructor = {\n  templateId: string;\n  dirname?: string;\n  props: Props;\n  hasMultipleRootNodes: boolean;\n};\n\ntype OnCloseElement = {\n  children: MetaNode[];\n  openingElement: string;\n};\n\ntype OnFinalise = {\n  css: string;\n};\n\ntype ShouldNotRenderChildren = true;\n\ntype OnVariableResponse = ShouldNotRenderChildren | void;\n\nexport class Template {\n  dirname: string;\n  templateId: string;\n  props: Props;\n  hasMultipleRootNodes: boolean;\n\n  constructor(args: OnConstructor) {\n    const { templateId, dirname, props, hasMultipleRootNodes } = args;\n    this.dirname = dirname || \"\";\n    this.templateId = templateId;\n    this.props = props;\n    this.hasMultipleRootNodes = hasMultipleRootNodes;\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    throw Error(\"Not implemented\");\n  }\n\n  onCloseElement(args: Parameters<TemplateFormat[\"onCloseElement\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onVariable(\n    onVariable: Parameters<TemplateFormat[\"onVariable\"]>[0]\n  ): ReturnType<TemplateFormat[\"onVariable\"]> {\n    throw Error(\"Not implemented\");\n  }\n\n  onCloseVariable(\n    onCloseVariable: Parameters<TemplateFormat[\"onCloseVariable\"]>[0]\n  ): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onCloseIf(onCloseIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onFinalise(onFinalise: Parameters<TemplateFormat[\"onFinalise\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  serialize(): TemplateFiles {\n    throw Error(\"Not implemented\");\n  }\n}\n","import prettier from \"prettier/standalone\";\nimport parserPostCSS from \"prettier/parser-postcss\";\nimport { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\n\nexport class CSSTemplate extends Template {\n  css: string;\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: \"css\" });\n\n    this.css = \"\";\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    return onElement.nodeName;\n  }\n\n  onCloseElement(args: Parameters<TemplateFormat[\"onCloseElement\"]>[0]): void {\n    // pass\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    // pass\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    // pass\n  }\n\n  onVariable(\n    variable: Parameters<TemplateFormat[\"onVariable\"]>[0]\n  ): ReturnType<TemplateFormat[\"onVariable\"]> {\n    // pass\n  }\n\n  onCloseVariable(closeVariable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    // pass\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    // pass\n  }\n\n  onCloseIf() {\n    // pass\n  }\n\n  onFinalise(onFinalise: Parameters<TemplateFormat[\"onFinalise\"]>[0]) {\n    const { css } = onFinalise;\n\n    this.css = css;\n    try {\n      this.css = prettier.format(this.css, {\n        parser: \"scss\",\n        printWidth: 80,\n        plugins: [parserPostCSS],\n      });\n    } catch (e) {\n      // pass\n    }\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.css`]: this.css,\n    };\n  }\n}\n","import prettier from \"prettier/standalone\";\nimport parserHTML from \"prettier/parser-html\";\nimport { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\n\nexport class HTMLTemplate extends Template {\n  html: string;\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: \"html\" });\n    this.html = \"\";\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    const { nodeName, attributes } = onElement;\n\n    this.html += `<${nodeName}`;\n    Object.keys(attributes).forEach((name) => {\n      const attributeValues = attributes[name];\n      this.html += ` ${name}=\"${attributeValues\n        .map((attributeValue) => {\n          if (attributeValue.type === \"MetaAttributeConstant\") {\n            return attributeValue.value;\n          } else if (attributeValue.type === \"MetaAttributeVariableOptions\") {\n            const optionKeys = Object.keys(attributeValue.options);\n            if (optionKeys.length > 0) {\n              const firstKey = optionKeys[0];\n              const firstValue = attributeValue.options[firstKey];\n              return firstValue;\n            }\n            return \"\";\n          }\n          return \"\";\n        })\n        .filter((value) => value.length > 0)\n        .join(\"\")}\"`;\n    });\n    this.html += \">\";\n    return nodeName;\n  }\n\n  onCloseElement(\n    onCloseElement: Parameters<TemplateFormat[\"onCloseElement\"]>[0]\n  ) {\n    const { openingElement } = onCloseElement;\n    this.html += `</${openingElement}>`;\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    const { value } = onText;\n    this.html += value;\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    const { value } = onComment;\n    this.html += `<!--${value}-->`;\n  }\n\n  onVariable(\n    variable: Parameters<TemplateFormat[\"onVariable\"]>[0]\n  ): ReturnType<TemplateFormat[\"onVariable\"]> {\n    const prop = this.props[variable.id];\n    this.html += `<!-- variable '${variable.id}' goes here -->`;\n    if (prop && prop.required) return true;\n  }\n\n  onCloseVariable(closeVariable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    // pass\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    // pass\n  }\n\n  onCloseIf(onIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]) {\n    // pass\n  }\n\n  onFinalise(onFinalise: Parameters<TemplateFormat[\"onFinalise\"]>[0]) {\n    try {\n      this.html = prettier.format(this.html, {\n        parser: \"html\",\n        printWidth: 80,\n        plugins: [parserHTML],\n      });\n    } catch (e) {\n      // pass\n    }\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.html`]: this.html,\n    };\n  }\n}\n\n// Via http://xahlee.info/js/html5_non-closing_tag.html\nexport const SELF_CLOSING_HTML_ELEMENTS = [\n  \"area\",\n  \"base\",\n  \"br\",\n  \"col\",\n  \"embed\",\n  \"hr\",\n  \"img\",\n  \"input\",\n  \"link\",\n  \"meta\",\n  \"param\",\n  \"source\",\n  \"track\",\n  \"wbr\",\n];\n","import capitalize from \"lodash/capitalize\";\n\nconst transform: Record<string, string> = {\n  class: \"className\",\n  for: \"htmlFor\",\n  autocomplete: \"autoComplete\",\n  \"fill-rule\": \"fillRule\",\n  readonly: \"readOnly\",\n  autofocus: \"autoFocus\",\n  srcset: \"srcSet\",\n  crossorigin: \"crossOrigin\",\n  spellcheck: \"spellCheck\",\n  tabindex: \"tabIndex\",\n  maxlength: \"maxLength\",\n  // TODO: expand this list... presumably there's an NPM package with these mappings?\n};\n\nexport function attributeNameTransform(attributeName: string): string {\n  // React uses JavaScript names not HTML names which can be different\n  // such as className=\"\" vs class=\"\" and htmlFor=\"\" vs for=\"\" and so on\n  // so we need to convert them...\n  if (transform[attributeName]) {\n    return transform[attributeName];\n  }\n\n  if (attributeName.startsWith(\"on\")) {\n    return `on${attributeName\n      .substring(2, 3)\n      .toUpperCase()}${attributeName.substring(3)}`;\n  }\n\n  return attributeName;\n}\n\nexport function getTypeScriptElementName(tagName: string): string {\n  switch (tagName) {\n    case \"p\":\n    case \"h1\":\n    case \"h2\":\n    case \"h3\":\n    case \"h4\":\n    case \"h5\":\n    case \"h6\":\n      return \"\";\n    case \"a\": {\n      return \"Anchor\";\n    }\n    case \"img\": {\n      return \"Image\";\n    }\n    case \"textarea\": {\n      return \"TextArea\";\n    }\n    default: {\n      return capitalize(tagName);\n    }\n  }\n}\n","import prettier from \"prettier/standalone\";\nimport parserTypeScript from \"prettier/parser-typescript\";\nimport { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\nimport { attributeNameTransform, getTypeScriptElementName } from \"./React.util\";\nimport {\n  MetaAttributeValues,\n  MetaAttributeValue,\n} from \"../../metaComponent/parseMetaHTMLAttribute\";\nimport { validJavaScriptIdentifer } from \"../utils\";\n\nexport class ReactTemplate extends Template {\n  imports: string;\n  renderPrefix: string;\n  render: string;\n  renderSuffix: string;\n  typeScript: string;\n  constants: string;\n  fileData: string;\n  fragmentStrings: Required<ReactExtensions>[\"fragmentStrings\"];\n  reactNameReplacement: Required<ReactExtensions>[\"reactNameReplacement\"];\n\n  constructor(args: OnConstructor & ReactExtensions) {\n    super({ ...args, dirname: args.dirname || \"react\" });\n    this.imports = \"\";\n    this.renderPrefix = \"\";\n    this.render = \"\";\n    this.renderSuffix = \"\";\n    this.typeScript = \"\";\n    this.fileData = \"\";\n    this.constants = \"\";\n    this.fragmentStrings = args.fragmentStrings || {\n      start: \"<React.Fragment>\",\n      end: \"</React.Fragment>\",\n    };\n    this.reactNameReplacement =\n      args.reactNameReplacement !== undefined\n        ? args.reactNameReplacement\n        : attributeNameTransform;\n\n    this.setTypeScript = this.setTypeScript.bind(this);\n    this.renderPropType = this.renderPropType.bind(this);\n\n    this.setImports();\n    this.setTypeScript();\n    this.renderRenderFunction();\n  }\n\n  setImports() {\n    this.imports += `import React from 'react';\\n`;\n  }\n\n  setTypeScript() {\n    const props = Object.keys(this.props).map(this.renderPropType).join(\"\\n  \");\n    this.typeScript = `type Props = {\\n  ${props}\\n};`;\n  }\n\n  renderPropType(propId: string): string {\n    const prop = this.props[propId];\n    let propString = \"\";\n\n    propString += validJavaScriptIdentifer.test(propId)\n      ? propId\n      : `\"${propId}\"`;\n\n    if (!prop.required) {\n      propString += \"?\";\n    }\n\n    propString += \": \";\n\n    switch (prop.type) {\n      case \"PropTypeVariable\": {\n        propString += \"React.ReactNode;\";\n        break;\n      }\n      case \"PropTypeAttributeValue\": {\n        if (prop.attributeName.startsWith(\"data-\")) {\n          propString += \"string\";\n        } else {\n          propString += `React.${getTypeScriptElementName(\n            prop.nodeName\n          )}HTMLAttributes<HTML${getTypeScriptElementName(\n            prop.nodeName\n          )}Element>[\"${attributeNameTransform(prop.attributeName)}\"];`;\n        }\n        break;\n      }\n      case \"PropTypeAttributeValueOptions\": {\n        propString += `${Object.keys(prop.options)\n          .map((key) => {\n            return validJavaScriptIdentifer.test(key) ? `\"${key}\"` : `\"${key}\"`;\n          })\n          .join(\" | \")};`;\n      }\n    }\n\n    return propString;\n  }\n\n  renderRenderFunction() {\n    const propIds = Object.keys(this.props);\n    const containsInvalidIdentifiers = propIds.some(\n      (propId) => !validJavaScriptIdentifer.test(propId)\n    );\n    // ensure a named export (not just a default export)\n    this.renderPrefix = `export function `;\n    if (containsInvalidIdentifiers) {\n      this.renderPrefix += `${this.templateId}(props: Props){\\n`;\n      const destructure = propIds\n        .filter((key) => validJavaScriptIdentifer.test(key))\n        .join(\", \");\n      if (destructure) {\n        this.renderPrefix += `  const { ${destructure} } = props;\\n`;\n      }\n    } else {\n      this.renderPrefix += `${this.templateId}({ ${propIds.join(\n        \", \"\n      )} }: Props){\\n`;\n    }\n    this.renderPrefix += `  return (\\n`;\n    if (this.hasMultipleRootNodes) {\n      this.renderPrefix += this.fragmentStrings.start;\n    }\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    const { nodeName, attributes } = onElement;\n    this.render += `<${nodeName}`;\n    Object.keys(attributes).forEach((attributeName) => {\n      this.renderAttribute(attributeName, attributes[attributeName]);\n    });\n    if (onElement.children.length === 0) {\n      this.render += \"/\";\n    }\n    this.render += \">\";\n    return nodeName;\n  }\n\n  renderAttribute(\n    attributeName: string,\n    attributeValues: MetaAttributeValues\n  ): void {\n    // TODO: escape attribute values and keys\n    const reactAttributeName = this.reactNameReplacement(attributeName);\n    this.render += ` ${reactAttributeName}=`;\n    const containsExpression = attributeValues.some(\n      (attributeValue) => attributeValue.type !== \"MetaAttributeConstant\"\n    );\n    const containsConstant = attributeValues.some(\n      (attributeValue) => attributeValue.type === \"MetaAttributeConstant\"\n    );\n\n    if (containsExpression) {\n      this.render += \"{\";\n    } else {\n      this.render += '\"';\n    }\n\n    const isTemplateString = containsExpression && containsConstant;\n\n    if (isTemplateString) {\n      this.render += \"`\";\n    }\n\n    attributeValues.forEach((attributeValue) => {\n      if (containsConstant && attributeValue.type !== \"MetaAttributeConstant\") {\n        this.render += \"${\";\n      }\n      this.renderAttributeValue(attributeValue, isTemplateString);\n      if (containsConstant && attributeValue.type !== \"MetaAttributeConstant\") {\n        this.render += \"}\";\n      }\n    });\n\n    if (isTemplateString) {\n      this.render += \"`\";\n    }\n\n    if (containsExpression) {\n      this.render += \"}\";\n    } else {\n      this.render += '\"';\n    }\n  }\n\n  renderAttributeValue(attributeValue: MetaAttributeValue, inString: boolean) {\n    switch (attributeValue.type) {\n      case \"MetaAttributeConstant\": {\n        this.render += attributeValue.value.replace(/`/g, \"`\");\n        break;\n      }\n      case \"MetaAttributeVariable\": {\n        const isOptional = !this.props[attributeValue.id].required;\n        const identifier = validJavaScriptIdentifer.test(attributeValue.id)\n          ? attributeValue.id\n          : `props[${JSON.stringify(attributeValue.id)}]`;\n        if (isOptional) {\n          this.render += `${identifier}${inString ? ` || \"\"` : \"\"}`;\n        } else {\n          this.render += identifier;\n        }\n        break;\n      }\n      case \"MetaAttributeVariableOptions\": {\n        const isOptional = !this.props[attributeValue.id].required;\n        const identifier = validJavaScriptIdentifer.test(attributeValue.id)\n          ? attributeValue.id\n          : `props[${JSON.stringify(attributeValue.id)}]`;\n\n        if (isOptional) {\n          this.render += `${identifier} ? `;\n        }\n\n        this.render += JSON.stringify(attributeValue.options);\n        this.render += `[${identifier}]`;\n\n        if (isOptional) {\n          this.render += `: ${inString ? \"''\" : \"undefined\"}`;\n        }\n      }\n    }\n  }\n\n  onCloseElement(\n    onCloseElement: Parameters<TemplateFormat[\"onCloseElement\"]>[0]\n  ): void {\n    const { openingElement, children } = onCloseElement;\n    if (children.length > 0) {\n      // because it was already rendered as a self-closing if it had no children\n      this.render += `\\n</${openingElement}>\\n`;\n    }\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    const { value } = onText;\n    this.render += value;\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    const { value } = onComment;\n    this.render += `{/*${value}*/}`;\n  }\n\n  onVariable(\n    variable: Parameters<TemplateFormat[\"onVariable\"]>[0]\n  ): ReturnType<TemplateFormat[\"onVariable\"]> {\n    const prop = this.props[variable.id];\n\n    const identifier = validJavaScriptIdentifer.test(variable.id)\n      ? variable.id\n      : `props[${JSON.stringify(variable.id)}]`;\n\n    if (prop) {\n      if (prop.required) {\n        this.render += `{${identifier}}`;\n        return true;\n      } else {\n        this.render += `{${identifier} !== undefined ? ${identifier} : `;\n        if (variable.children.length === 0) {\n          this.render += `null`;\n        } else if (\n          variable.children.length === 1 &&\n          variable.children[0].type === \"Text\"\n        ) {\n          this.render += `\\`${variable.children[0].value.replace(/`/g, \"\\\\`\")}`;\n          return true;\n        } else {\n          this.render += `(${this.fragmentStrings.start}`;\n        }\n      }\n    }\n  }\n\n  onCloseVariable(variable: Parameters<TemplateFormat[\"onCloseVariable\"]>[0]) {\n    const prop = this.props[variable.id];\n\n    if (prop && prop.required) {\n      // If this is genuinely required then there's no need to render anything\n      return;\n    }\n\n    if (\n      prop &&\n      variable.children.length === 1 &&\n      variable.children[0].type === \"Text\"\n    ) {\n      this.render += `\\``;\n    } else if (variable.children.length > 0) {\n      this.render += `${this.fragmentStrings.end})`;\n    }\n    this.render += `}`;\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    if (onIf.parseError === false) {\n      this.render += `{${onIf.testAsJavaScriptExpression} && (${this.fragmentStrings.start}`;\n    } else {\n      this.render += `{false && (${this.fragmentStrings.start}`;\n    }\n  }\n\n  onCloseIf(onCloseIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]) {\n    this.render += `${this.fragmentStrings.end})}`;\n  }\n\n  onFinalise(\n    onSerialize: Parameters<TemplateFormat[\"onFinalise\"]>[0]\n  ): TemplateFiles | undefined {\n    if (this.hasMultipleRootNodes) {\n      this.renderSuffix = this.fragmentStrings.end;\n    }\n\n    const renderFunction = `${this.renderPrefix}${this.render}${this.renderSuffix})\\n}; export default ${this.templateId}`;\n\n    this.fileData = `${this.imports}\\n${this.typeScript}\\n\\n${this.constants}\\n\\n${renderFunction}\\n`;\n\n    try {\n      this.fileData = prettier.format(this.fileData, {\n        parser: \"typescript\",\n        printWidth: 80,\n        plugins: [parserTypeScript],\n      });\n    } catch (e) {\n      // pass\n    }\n\n    return {\n      renderFunction,\n      render: this.render,\n      typeScript: this.typeScript,\n      constants: this.constants,\n    };\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.tsx`]: this.fileData,\n    };\n  }\n}\n\nexport type FragmentStrings = {\n  start: string;\n  end: string;\n};\n\nexport type ReactExtensions = {\n  fragmentStrings?: FragmentStrings;\n  reactNameReplacement?: (name: string) => string;\n};\n","import uniq from \"lodash/uniq\";\nimport { ReactTemplate } from \"../React/React\";\nimport { TemplateFormat, OnConstructor } from \"../Template\";\nimport { MetaCSSPropertiesNode } from \"../../metaComponent/metaComponent\";\nimport { validJavaScriptIdentifer } from \"../utils\";\nimport { MetaAttributeValue } from \"../../metaComponent/parseMetaHTMLAttribute\";\n\nexport class ReactStyledComponentsTemplate extends ReactTemplate {\n  styledConstants: string[];\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: \"react-styled-components\" });\n\n    this.imports += `import styled from 'styled-components';\\n`;\n\n    this.styledConstants = [];\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    let counter = 1;\n    let styledName = onElement.nodeName;\n    if (onElement.cssProperties.length) {\n      do {\n        styledName = `Styled${onElement.nodeName\n          .substring(0, 1)\n          .toUpperCase()}${onElement.nodeName.substring(1)}${\n          counter === 1 ? \"\" : `_${counter}`\n        }`;\n        counter++;\n      } while (this.styledConstants.includes(styledName));\n      this.styledConstants.push(styledName);\n\n      const pickedProps = this.renderCSSPropertyProps(onElement.cssProperties);\n      const styledProps = `${styledName}Props`;\n\n      if (pickedProps) {\n        this.constants += `type ${styledProps} = ${pickedProps};\\n`;\n      }\n      this.constants += `const ${styledName} = styled.${onElement.nodeName}${\n        pickedProps ? `<${styledProps}>` : \"\"\n      }\\`\\n  ${onElement.cssProperties\n        .map((cssProperty) => this.renderCSSProperty(cssProperty, styledProps))\n        .join(\"\\n  \")}\\n\\`;\\n\\n`;\n    }\n    const styledAttributes = {\n      ...onElement.attributes,\n    };\n\n    // DEV Note. We delete the 'class' because it's assumed that we know about\n    // all the CSS used, however it's possible that they want a class that\n    // refers to an external stylesheet, so we support styledclass=\"stuff\"\n    // which will overwrite the class, if they want that.\n    if (styledAttributes[\"styledclass\"]) {\n      styledAttributes[\"class\"] = styledAttributes[\"styledclass\"];\n\n      delete styledAttributes[\"styledclass\"];\n    } else if (styledAttributes[\"class\"]) {\n      styledAttributes[\"class\"] = styledAttributes[\"class\"].filter(\n        (attributeValue: MetaAttributeValue) => {\n          // if the attributeValue is either\n          //   \"MetaAttributeConstant\"\n          //   \"MetaAttributeVariableOptions\n          // then it could be associated with CSS classes that we've already generated\n          // 'styled-components' components for.\n          // so the only scenario where we retain the className attribute is for arbitrary classNames\n          return attributeValue.type === \"MetaAttributeVariable\";\n        }\n      );\n      if (styledAttributes[\"class\"].length === 0) {\n        delete styledAttributes[\"class\"];\n      }\n    }\n\n    onElement.cssProperties.forEach((cssProperty) => {\n      if (cssProperty.type === \"MetaCSSPropertiesConstantNode\") return;\n      styledAttributes[cssProperty.id] = [\n        {\n          type: \"MetaAttributeVariable\",\n          id: cssProperty.id,\n        },\n      ];\n    });\n\n    super.onElement({\n      ...onElement,\n      nodeName: styledName,\n      attributes: styledAttributes,\n    });\n\n    return styledName;\n  }\n\n  renderCSSProperty(\n    cssPropertiesNode: MetaCSSPropertiesNode,\n    styledProps: string\n  ): string {\n    switch (cssPropertiesNode.type) {\n      case \"MetaCSSPropertiesConstantNode\": {\n        return cssPropertiesNode.cssPropertiesString;\n      }\n      case \"MetaCSSPropertiesConditionalNode\": {\n        const isValidIdentifier = validJavaScriptIdentifer.test(\n          cssPropertiesNode.id\n        );\n        let conditional = \"${\";\n        const identifier = isValidIdentifier\n          ? cssPropertiesNode.id\n          : `props[\"${cssPropertiesNode.id}\"]`;\n\n        if (isValidIdentifier) {\n          conditional += `({${cssPropertiesNode.id}}: ${styledProps}) => (`;\n        } else {\n          conditional += `(props: ${styledProps}) => (`;\n        }\n\n        conditional += JSON.stringify(cssPropertiesNode.condition);\n        conditional += `[`;\n        conditional += identifier;\n        conditional += `])}`;\n\n        return conditional;\n      }\n    }\n  }\n\n  renderCSSPropertyProps(\n    cssProperties: MetaCSSPropertiesNode[]\n  ): string | undefined {\n    const propUnion = uniq(\n      cssProperties\n        .map((cssProperty): string => {\n          if (cssProperty.type === \"MetaCSSPropertiesConditionalNode\") {\n            return `\"${cssProperty.id}\"`;\n          }\n          return \"\";\n        })\n        .filter((val: string): boolean => !!val)\n    ).join(\" | \");\n\n    if (propUnion.length === 0) return undefined;\n    return `Pick<Props, ${propUnion}>`;\n  }\n}\n","import { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\nimport { MetaAttributeValues } from \"../../metaComponent/parseMetaHTMLAttribute\";\nimport { assertUnreachable } from \"../utils\";\n\nexport class MustacheTemplate extends Template {\n  data: string;\n  unescapedVariables: string[];\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: \"mustache\" });\n    this.data = \"\";\n    this.unescapedVariables = [];\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    const { nodeName, attributes } = onElement;\n\n    this.data += `<${nodeName}`;\n    Object.keys(attributes).forEach((name) => {\n      const attributeValues = attributes[name];\n      this.data += this.renderAttribute(name, attributeValues);\n    });\n    this.data += \">\";\n    return nodeName;\n  }\n\n  renderAttribute(name: string, attributeValues: MetaAttributeValues): string {\n    let attr = \" \";\n\n    const isOmittedIfEmpty =\n      attributeValues.length === 1 &&\n      [\"MetaAttributeVariable\"].includes(attributeValues[0].type);\n\n    if (isOmittedIfEmpty) {\n      const attributeVariable = attributeValues[0];\n      if (attributeVariable.type !== \"MetaAttributeVariable\") {\n        throw Error(`Internal error`);\n      }\n      attr += `{{#${attributeVariable.id}}}`;\n    }\n\n    attr += name;\n\n    if (attributeValues) {\n      attr += '=\"';\n      attr += attributeValues\n        .map((attributeValue): string => {\n          switch (attributeValue.type) {\n            case \"MetaAttributeConstant\": {\n              return attributeValue.value;\n            }\n            case \"MetaAttributeVariable\": {\n              return `{{${attributeValue.id}}}`;\n            }\n            case \"MetaAttributeVariableOptions\": {\n              // Because Mustache is \"logic-less\" we can't have\n              // if (x === 1) { result1 } else if (x === 2) { result2 } endif;\n              // we can only have truthy results, so we instead we use the fact\n              // that the \"=\" character is a valid part of a variable name and\n              // we make variables for each possible enumeration. So when\n              // comparing a variable of \"x\" for a value of \"1\" we instead check\n              // for a variable named \"x=1\" literally. So now the code looks like,\n              // if (x=1) { result1 } endif; if(x=2) { result2 } endif;\n              return Object.entries(attributeValue.options)\n                .map(([optionName, optionValue]) => {\n                  return `{{${attributeValue.id}=${optionName}}}${optionValue}{{/${attributeValue.id}=${optionName}}}`;\n                })\n                .join(\"\");\n            }\n          }\n          return assertUnreachable();\n        })\n        .join(\"\")\n        .trim();\n\n      attr += '\"';\n    }\n\n    if (isOmittedIfEmpty) {\n      const attributeVariable = attributeValues[0];\n      if (attributeVariable.type !== \"MetaAttributeVariable\") {\n        throw Error(`Internal error`);\n      }\n      attr += `{{/${attributeVariable.id}}}`;\n    }\n\n    return attr;\n  }\n\n  onCloseElement(args: Parameters<TemplateFormat[\"onCloseElement\"]>[0]): void {\n    this.data += `</${args.openingElement}>`;\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    this.data += onText.value;\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    this.data += `{{! ${onComment.value} }}`;\n  }\n\n  onVariable(\n    variable: Parameters<TemplateFormat[\"onVariable\"]>[0]\n  ): ReturnType<TemplateFormat[\"onVariable\"]> {\n    const prop = this.props[variable.id];\n    this.unescapedVariables.push(variable.id);\n    this.data += `{{{ ${variable.id} }}}`;\n    if (prop && !prop.required && variable.children.length > 0) {\n      this.data += `{{^${variable.id}}}`;\n    }\n    if (prop && prop.required) return true;\n  }\n\n  onCloseVariable(variable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    const prop = this.props[variable.id];\n\n    if (prop && !prop.required && variable.children.length > 0) {\n      this.data += `{{/${variable.id}}}`;\n    }\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    if (onIf.parseError === false) {\n      this.data += `{{#${this.renderIf(onIf.testAsJavaScriptExpression)}}}`;\n    }\n  }\n\n  renderIf(expression: string): string {\n    return expression.replace(/[\\s\"']/gi, \"\").replace(/[=]+/g, \"=\");\n  }\n\n  onCloseIf(onCloseIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]) {\n    if (onCloseIf.parseError === false) {\n      this.data += `{{/${this.renderIf(\n        onCloseIf.testAsJavaScriptExpression\n      )}}}`;\n    }\n  }\n\n  onFinalise(onSerialize: Parameters<TemplateFormat[\"onFinalise\"]>[0]) {\n    let unescaped = \"\";\n    if (this.unescapedVariables.length) {\n      unescaped = `{{!\\nDEVELOPER NOTE: This template uses triple-bracket \"{{{\" which disables HTML escaping.\\nPlease ensure these variables are properly escaped:\\n\\n  * ${this.unescapedVariables.join(\n        \",\\n  * \"\n      )}.\\n\\nThe reason for this is to allow raw HTML, for values such as (eg) <span lang=\"mi\">Mori</span>.\\n}}\\n`;\n    }\n    this.data = `${unescaped}${this.data}`;\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.html`]: this.data,\n    };\n  }\n}\n","import startCase from \"lodash/startCase\";\nimport prettier from \"prettier/standalone\";\nimport parserAngular from \"prettier/parser-angular\";\nimport { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\nimport {\n  MetaAttributeValues,\n  MetaAttributeValue,\n} from \"../../metaComponent/parseMetaHTMLAttribute\";\nimport { validJavaScriptIdentifer } from \"../utils\";\n\ntype ComputedProp = {\n  identifiers: string[];\n  expression: string;\n  responseType: \"string\" | \"boolean\";\n};\n\nexport class VueTemplate extends Template {\n  template: string;\n  script: string;\n  style: string;\n\n  imports: string;\n  extendPropsString: string;\n  propsString: string;\n  computed: Record<string, ComputedProp>;\n\n  finalData: string;\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: args.dirname || \"vue\" });\n\n    this.template = \"\";\n    this.script = \"\";\n    this.style = \"\";\n\n    this.imports = \"\";\n    this.propsString = \"\";\n    this.extendPropsString = \"\";\n    this.computed = {};\n\n    this.finalData = \"\";\n\n    this.setPropsString = this.setPropsString.bind(this);\n    this.renderPropType = this.renderPropType.bind(this);\n    this.setImports = this.setImports.bind(this);\n    this.renderAttribute = this.renderAttribute.bind(this);\n    this.getNewComputedName = this.getNewComputedName.bind(this);\n\n    this.setPropsString();\n    this.setImports();\n  }\n\n  setPropsString() {\n    this.propsString = Object.keys(this.props)\n      .map((propId) => {\n        return this.renderPropType(propId) + \";\";\n      })\n      .join(\"\\n  \");\n\n    this.extendPropsString = Object.keys(this.props)\n      .map((propId) => {\n        return `${\n          validJavaScriptIdentifer.test(propId)\n            ? propId\n            : JSON.stringify(propId)\n        }: Object as () => Props[${JSON.stringify(propId)}],`;\n      })\n      .join(\"\\n    \");\n  }\n\n  setImports() {\n    this.imports += `import Vue from \"vue\";'\\n`;\n  }\n\n  renderPropType(propId: string): string {\n    const prop = this.props[propId];\n    let propString = \"\";\n\n    propString += validJavaScriptIdentifer.test(propId)\n      ? propId\n      : JSON.stringify(propId);\n\n    if (!prop.required) {\n      propString += \"?\";\n    }\n\n    propString += \": \";\n\n    switch (prop.type) {\n      case \"PropTypeVariable\": {\n        propString += \"Vue.VNode\";\n        break;\n      }\n      case \"PropTypeAttributeValue\": {\n        propString += `string`;\n        break;\n      }\n      case \"PropTypeAttributeValueOptions\": {\n        propString += `${Object.keys(prop.options)\n          .map((key) => {\n            return validJavaScriptIdentifer.test(key) ? `\"${key}\"` : `\"${key}\"`;\n          })\n          .join(\" | \")}`;\n      }\n    }\n\n    return propString;\n  }\n\n  renderRenderFunction() {\n    const propIds = Object.keys(this.props);\n    const containsInvalidIdentifiers = propIds.some(\n      (propId) => !validJavaScriptIdentifer.test(propId)\n    );\n    if (containsInvalidIdentifiers) {\n      this.template += `export default function ${this.templateId}(props: Props){\\n`;\n      const destructure = propIds\n        .filter((key) => validJavaScriptIdentifer.test(key))\n        .join(\", \");\n      if (destructure) {\n        this.template += `  const { ${destructure} } = props;\\n`;\n      }\n    } else {\n      this.template += `export default function ${\n        this.templateId\n      }({ ${propIds.join(\", \")} }: Props){\\n`;\n    }\n    this.template += `  return (\\n`;\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    const { nodeName, attributes } = onElement;\n    this.template += `<${nodeName}`;\n    this.template += Object.keys(attributes)\n      .map((attributeName): string =>\n        this.renderAttribute(attributeName, attributes[attributeName])\n      )\n      .join(\" \");\n    if (onElement.children.length === 0) {\n      this.template += \"/\";\n    }\n    this.template += \">\";\n    return nodeName;\n  }\n\n  renderAttribute(\n    attributeName: string,\n    attributeValues: MetaAttributeValues\n  ): string {\n    // TODO: escape attribute values and keys\n\n    const containsOnlyConstants = attributeValues.every(\n      (attributeValue) => attributeValue.type === \"MetaAttributeConstant\"\n    );\n\n    let response = \"\";\n\n    response += ` ${!containsOnlyConstants ? \":\" : \"\"}${attributeName}=\"`;\n\n    if (containsOnlyConstants) {\n      response += attributeValues\n        .map((attributeValue) => {\n          if (attributeValue.type === \"MetaAttributeConstant\") {\n            return attributeValue.value;\n          }\n          throw new Error(\n            \"Internal error. Didn't expect type \" + attributeValue.type\n          );\n        })\n        .join(\"\");\n    } else {\n      const computedName = this.getNewComputedName(attributeName);\n\n      const containsExpression = attributeValues.some(\n        (attributeValue) => attributeValue.type !== \"MetaAttributeConstant\"\n      );\n      const containsConstant = attributeValues.some(\n        (attributeValue) => attributeValue.type === \"MetaAttributeConstant\"\n      );\n\n      const computedProp: ComputedProp = this.computed[computedName] || {\n        identifiers: [],\n        expression: containsExpression && containsConstant ? \"`\" : \"\",\n        responseType: \"string\",\n      };\n\n      this.computed[computedName] = computedProp;\n\n      attributeValues.forEach((attributeValue) => {\n        if (\n          containsConstant &&\n          attributeValue.type !== \"MetaAttributeConstant\"\n        ) {\n          computedProp.expression += \"${ \";\n        }\n        const [propExpression, propId] = this.renderAttributeValue(\n          attributeValue\n        );\n        if (propId) {\n          computedProp.identifiers.push(propId);\n        }\n        computedProp.expression += propExpression;\n        if (\n          containsConstant &&\n          attributeValue.type !== \"MetaAttributeConstant\"\n        ) {\n          computedProp.expression += \" || '' }\";\n        }\n      });\n\n      if (containsExpression && containsConstant) {\n        computedProp.expression += \"`\";\n      }\n\n      this.computed[computedName] = computedProp;\n      response += computedName;\n    }\n\n    response += '\"';\n\n    return response;\n  }\n\n  getNewComputedName(name: string): string {\n    let counter = 1;\n    let computedName = \"\";\n    do {\n      computedName = `computed${startCase(name)\n        .replace(/\\s/gi, \"\")\n        .substring(0, 1)\n        .toUpperCase()}${name.substring(1)}${\n        counter === 1 ? \"\" : `${counter}`\n      }`;\n      counter++;\n    } while (this.computed[computedName] !== undefined);\n    return computedName;\n  }\n\n  renderAttributeValue(attributeValue: MetaAttributeValue): [string, string?] {\n    switch (attributeValue.type) {\n      case \"MetaAttributeConstant\": {\n        return [attributeValue.value, undefined];\n      }\n      case \"MetaAttributeVariable\": {\n        return [\n          validJavaScriptIdentifer.test(attributeValue.id)\n            ? attributeValue.id\n            : `props[\"${attributeValue.id}\"]`,\n          attributeValue.id,\n        ];\n      }\n      case \"MetaAttributeVariableOptions\": {\n        const identifier = validJavaScriptIdentifer.test(attributeValue.id)\n          ? attributeValue.id\n          : `props[\"${attributeValue.id}\"]`;\n\n        if (!this.props[attributeValue.id].required) {\n          this.template += `${identifier} && `;\n        }\n        return [\n          `${JSON.stringify(attributeValue.options)}[${identifier}]`,\n          attributeValue.id,\n        ];\n      }\n    }\n  }\n\n  onCloseElement(\n    onCloseElement: Parameters<TemplateFormat[\"onCloseElement\"]>[0]\n  ): void {\n    const { openingElement } = onCloseElement;\n    this.template += `</${openingElement}>`;\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    const { value } = onText;\n    this.template += value;\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    const { value } = onComment;\n    this.template += `<!--${value}-->`;\n  }\n\n  onVariable(\n    variable: Parameters<TemplateFormat[\"onVariable\"]>[0]\n  ): ReturnType<TemplateFormat[\"onVariable\"]> {\n    const prop = this.props[variable.id];\n\n    if (variable.id === \"children\") {\n      this.template += `<slot>`; // treat 'children' as default slot\n    } else {\n      this.template += `<slot name=${JSON.stringify(variable.id)}>`;\n    }\n    if (prop && prop.required) return true;\n  }\n\n  onCloseVariable(variable: Parameters<TemplateFormat[\"onCloseVariable\"]>[0]) {\n    this.template += `</slot>`;\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    if (onIf.parseError === false) {\n      const computedName = this.getNewComputedName(onIf.ids.join(\" \"));\n      this.computed[computedName] = {\n        identifiers: onIf.ids,\n        expression: onIf.testAsJavaScriptExpression,\n        responseType: \"boolean\",\n      };\n      this.template += `<span v-if=\"${computedName}\">`;\n    } else {\n      this.template += `<!-- parse error: ${onIf.error} -->`;\n    }\n  }\n\n  onCloseIf(onCloseIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]) {\n    this.template += `</span>`;\n  }\n\n  onFinalise(onFinalise: Parameters<TemplateFormat[\"onFinalise\"]>[0]) {\n    const { css } = onFinalise;\n\n    const computedString = Object.keys(this.computed)\n      .map((propName) => {\n        const computedProp = this.computed[propName];\n        const containsInvalidIdentifiers = computedProp.identifiers.some(\n          (identifier) => !validJavaScriptIdentifer.test(identifier)\n        );\n        const spreadProps = computedProp.identifiers\n          .filter((identifier) => validJavaScriptIdentifer.test(identifier))\n          .join(\", \");\n\n        let computeFunction = \"(\";\n        if (containsInvalidIdentifiers) {\n          computeFunction += `props: Props): ${computedProp.responseType} => `;\n          if (spreadProps) {\n            computeFunction += \"{\";\n            computeFunction += `      const { ${spreadProps} } = props;\\n`;\n            computeFunction += `      return `;\n          } else {\n            computeFunction += \"(\";\n          }\n        } else {\n          computeFunction += `{${spreadProps}}: Props): ${computedProp.responseType} => (`;\n        }\n\n        computeFunction += computedProp.expression;\n\n        if (containsInvalidIdentifiers && spreadProps) {\n          computeFunction += \"}\";\n        } else {\n          computeFunction += \")\";\n        }\n\n        return `${propName}: ${computeFunction}`;\n      })\n      .join(\",\\n    \");\n\n    const componentVarName = startCase(this.templateId).replace(/\\s/gi, \"\");\n\n    this.script = \"\";\n\n    if (this.propsString) {\n      this.script += `type Props = {\\n  ${this.propsString}\\n};\\n\\n`;\n    }\n\n    this.script += `const ${componentVarName} = Vue.extend({\\n`;\n    if (this.extendPropsString) {\n      this.script += \"  props: {\\n    \";\n      this.script += this.extendPropsString;\n      this.script += \"\\n  },\\n\";\n    }\n    if (computedString) {\n      this.script += `  computed: {\\n`;\n      this.script += `    ${computedString}\\n`;\n      this.script += `  }\\n`;\n    }\n    this.script += `});\\n`;\n    this.script += `export default ${componentVarName};`;\n\n    this.finalData = `<template>\\n${this.template}\\n</template>\\n`;\n    if (css) {\n      this.finalData += `<style scoped>\\n${css}\\n</style>\\n`;\n    }\n    this.finalData += `<script lang=\"ts\">\\n${this.imports}\\n\\n${this.script}\\n</script>\\n`;\n\n    try {\n      this.finalData = prettier.format(this.finalData, {\n        parser: \"vue\",\n        printWidth: 80,\n        plugins: [parserAngular], // Vue uses Angular's parser https://prettier.io/blog/2018/11/07/1.15.0.html\n      });\n    } catch (e) {\n      // pass\n    }\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.vue`]: this.finalData,\n    };\n  }\n}\n","import prettier from \"prettier/standalone\";\nimport parserTypeScript from \"prettier/parser-typescript\";\nimport { TemplateFormat, OnConstructor } from \"../Template\";\nimport { ReactTemplate, FragmentStrings } from \"../React/React\";\nimport { TemplateFiles } from \"../../types\";\nimport { validJavaScriptIdentifer } from \"../utils\";\n\nconst fragmentStrings: FragmentStrings = {\n  start: \"<Fragment>\",\n  end: \"</Fragment>\",\n};\n\nexport class VueJSXTemplate extends ReactTemplate {\n  render: string;\n  vue: string;\n  fragmentStrings: FragmentStrings;\n\n  constructor(args: OnConstructor) {\n    super({\n      ...args,\n      fragmentStrings,\n      reactNameReplacement: vueJSXNameReplacement,\n      dirname: args.dirname || \"vue-jsx\",\n    });\n\n    this.render = \"\";\n    this.vue = \"\";\n    this.fragmentStrings = fragmentStrings;\n    this.renderPropType = this.renderPropType.bind(this);\n  }\n\n  renderPropType(propId: string): string {\n    const prop = this.props[propId];\n    let propString = \"\";\n\n    propString += validJavaScriptIdentifer.test(propId)\n      ? propId\n      : `\"${propId}\"`;\n\n    if (!prop.required) {\n      propString += \"?\";\n    }\n\n    propString += \": \";\n\n    switch (prop.type) {\n      case \"PropTypeVariable\": {\n        propString += \"Object as () => Vue.VNode\";\n        if (!prop.required) {\n          propString += \" | undefined\";\n        }\n        break;\n      }\n      case \"PropTypeAttributeValue\": {\n        if (isFunctionReference(prop.attributeName)) {\n          propString += `Function as (e: Event) => Function`;\n        } else {\n          propString += `String as () => string`;\n        }\n        if (!prop.required) {\n          propString += \" | undefined\";\n        }\n        break;\n      }\n      case \"PropTypeAttributeValueOptions\": {\n        propString += `Object as () => ${Object.keys(prop.options)\n          .map((key) => {\n            return validJavaScriptIdentifer.test(key) ? `\"${key}\"` : `\"${key}\"`;\n          })\n          .join(\" | \")}`;\n        if (!prop.required) {\n          propString += \" | undefined\";\n        }\n      }\n    }\n\n    return propString;\n  }\n\n  onFinalise(\n    onFinalise: Parameters<TemplateFormat[\"onFinalise\"]>[0]\n  ): undefined {\n    const result = super.onFinalise(onFinalise);\n    if (!result) {\n      throw Error(\"expected onFinalise result from React template.\");\n    }\n\n    const propsString = `props: {\\n    ${Object.keys(this.props)\n      .map(this.renderPropType)\n      .join(\",\\n    \")}\\n  },`;\n\n    const spreadConstProps = `const { ${Object.keys(this.props)\n      .filter((propId) => validJavaScriptIdentifer.test(propId))\n      .join(\", \")} } = props;`;\n\n    const renderString = `${this.hasMultipleRootNodes ? \"<Fragment>\" : \"\"}${\n      result.render\n    }${this.hasMultipleRootNodes ? \"</Fragment>\" : \"\"}`;\n\n    if (renderString.includes(this.fragmentStrings.start)) {\n      this.vue = `// Vue3 Fragment component\\nimport Vue, { Fragment } from 'vue';`;\n    } else {\n      this.vue = `import Vue from 'vue';`;\n    }\n\n    this.vue += `\\n\\nexport default Vue.component(${JSON.stringify(\n      this.templateId\n    )}, {\\n  functional: true,\\n  ${propsString}\\n  render: function(h, context) {\\n    const { props } = context;\\n    ${spreadConstProps}\\n    return (${renderString})\\n }})`;\n\n    try {\n      this.vue = prettier.format(this.vue, {\n        parser: \"typescript\",\n        printWidth: 80,\n        plugins: [parserTypeScript],\n      });\n    } catch (e) {\n      // pass\n    }\n\n    return;\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.ts`]: this.vue,\n    };\n  }\n}\n\nfunction isFunctionReference(str: string): boolean {\n  return str.startsWith(\"on\");\n}\n\nfunction vueJSXNameReplacement(str: string): string {\n  if (isFunctionReference(str) && str.startsWith(\"on\")) {\n    return `on${str.substring(2, 3).toUpperCase()}${str.substring(3)}`;\n  }\n  return str;\n}\n","import startCase from \"lodash/startCase\";\nimport prettier from \"prettier/standalone\";\nimport parserTypeScript from \"prettier/parser-typescript\";\nimport { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\nimport {\n  MetaAttributeValues,\n  MetaAttributeValue,\n} from \"../../metaComponent/parseMetaHTMLAttribute\";\nimport { validJavaScriptIdentifer } from \"../utils\";\n\nexport class AngularTemplate extends Template {\n  template: string;\n  script: string;\n  style: string;\n\n  imports: string;\n  typeScript: string;\n\n  finalData: string;\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: args.dirname || \"angular\" });\n\n    this.template = \"\";\n    this.script = \"\";\n    this.style = \"\";\n\n    this.imports = \"\";\n    this.typeScript = \"\";\n\n    this.finalData = \"\";\n\n    this.setTypeScript = this.setTypeScript.bind(this);\n    this.renderPropType = this.renderPropType.bind(this);\n    this.setImports = this.setImports.bind(this);\n    this.renderAttribute = this.renderAttribute.bind(this);\n\n    this.setTypeScript();\n    this.setImports();\n  }\n\n  setTypeScript() {\n    const props = Object.keys(this.props).map(this.renderPropType).join(\"\\n  \");\n    this.typeScript = `type Props = {\\n  ${props}\\n};`;\n  }\n\n  setImports() {\n    this.imports += `import { Component } from \"@angular/core\";'\\n`;\n  }\n\n  renderPropType(propId: string): string {\n    const prop = this.props[propId];\n    let propString = \"\";\n\n    propString += validJavaScriptIdentifer.test(propId)\n      ? propId\n      : `\"${propId}\"`;\n\n    if (!prop.required) {\n      propString += \"?\";\n    }\n\n    propString += \": \";\n\n    switch (prop.type) {\n      case \"PropTypeVariable\": {\n        propString += \"any;\";\n        break;\n      }\n      case \"PropTypeAttributeValue\": {\n        propString += `any;`;\n        break;\n      }\n      case \"PropTypeAttributeValueOptions\": {\n        propString += `${Object.keys(prop.options)\n          .map((key) => {\n            return validJavaScriptIdentifer.test(key) ? `\"${key}\"` : `\"${key}\"`;\n          })\n          .join(\" | \")};`;\n      }\n    }\n\n    return propString;\n  }\n\n  renderRenderFunction() {\n    const propIds = Object.keys(this.props);\n    const containsInvalidIdentifiers = propIds.some(\n      (propId) => !validJavaScriptIdentifer.test(propId)\n    );\n    if (containsInvalidIdentifiers) {\n      this.template += `export default function ${this.templateId}(props: Props){\\n`;\n      const destructure = propIds\n        .filter((key) => validJavaScriptIdentifer.test(key))\n        .join(\", \");\n      if (destructure) {\n        this.template += `  const { ${destructure} } = props;\\n`;\n      }\n    } else {\n      this.template += `export default function ${\n        this.templateId\n      }({ ${propIds.join(\", \")} }: Props){\\n`;\n    }\n    this.template += `  return (\\n`;\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    const { nodeName, attributes } = onElement;\n    this.template += `<${nodeName}`;\n    this.template += Object.keys(attributes)\n      .map((attributeName): string =>\n        this.renderAttribute(attributeName, attributes[attributeName])\n      )\n      .join(\" \");\n\n    this.template += \">\";\n    return nodeName;\n  }\n\n  renderAttribute(\n    attributeName: string,\n    attributeValues: MetaAttributeValues\n  ): string {\n    if (\n      isFunctionReference(attributeName) &&\n      attributeValues.length === 1 &&\n      attributeValues[0].type === \"MetaAttributeVariable\"\n    ) {\n      const firstValue = attributeValues[0];\n      if (firstValue.type !== \"MetaAttributeVariable\") {\n        // TS narrowing\n        throw Error(\"Internal error\");\n      }\n\n      const valueAsString = JSON.stringify(firstValue.id);\n      return ` (${attributeName.substring(2)})=${valueAsString.substring(\n        0,\n        valueAsString.length - 1\n      )}($event)\"`;\n    }\n\n    const containsOnlyConstants = attributeValues.every(\n      (attributeValue) => attributeValue.type === \"MetaAttributeConstant\"\n    );\n\n    let response = \"\";\n\n    response += \" \";\n    if (!containsOnlyConstants) {\n      response += \"[\";\n    }\n    response += attributeName;\n    if (!containsOnlyConstants) {\n      response += \"]\";\n    }\n    response += `=\"`;\n\n    attributeValues.forEach((attributeValue) => {\n      if (attributeValue.type !== \"MetaAttributeConstant\") {\n        response += \"{{ \";\n      }\n      const [propExpression] = this.renderAttributeValue(attributeValue);\n\n      response += propExpression;\n      if (attributeValue.type !== \"MetaAttributeConstant\") {\n        response += \" || '' }}\";\n      }\n    });\n\n    response += '\"';\n\n    return response;\n  }\n\n  renderAttributeValue(attributeValue: MetaAttributeValue): [string, string?] {\n    switch (attributeValue.type) {\n      case \"MetaAttributeConstant\": {\n        return [attributeValue.value, undefined];\n      }\n      case \"MetaAttributeVariable\": {\n        return [\n          validJavaScriptIdentifer.test(attributeValue.id)\n            ? attributeValue.id\n            : `props[\"${attributeValue.id}\"]`,\n          attributeValue.id,\n        ];\n      }\n      case \"MetaAttributeVariableOptions\": {\n        const identifier = validJavaScriptIdentifer.test(attributeValue.id)\n          ? attributeValue.id\n          : `props[\"${attributeValue.id}\"]`;\n\n        if (!this.props[attributeValue.id].required) {\n          this.template += `${identifier} && `;\n        }\n        return [\n          `${JSON.stringify(attributeValue.options)}[${identifier}]`,\n          attributeValue.id,\n        ];\n      }\n    }\n  }\n\n  onCloseElement(\n    onCloseElement: Parameters<TemplateFormat[\"onCloseElement\"]>[0]\n  ): void {\n    const { openingElement } = onCloseElement;\n    this.template += `</${openingElement}>`;\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    const { value } = onText;\n    this.template += value;\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    const { value } = onComment;\n    this.template += `<!--${value}-->`;\n  }\n\n  onVariable(\n    variable: Parameters<TemplateFormat[\"onVariable\"]>[0]\n  ): ReturnType<TemplateFormat[\"onVariable\"]> {\n    const prop = this.props[variable.id];\n\n    this.template += `{{${variable.id}}}`;\n    if (prop && !prop.required && variable.children.length > 0) {\n      this.template += `<ng-template *ngIf=\"${variable.id} == undefined\">`;\n    }\n    if (prop && prop.required) return true;\n  }\n\n  onCloseVariable(variable: Parameters<TemplateFormat[\"onCloseVariable\"]>[0]) {\n    const prop = this.props[variable.id];\n\n    if (prop && !prop.required && variable.children.length > 0) {\n      this.template += \"</ng-template>\";\n    }\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    if (onIf.parseError === false) {\n      this.template += `<span *ngIf=\"${JSON.stringify(\n        onIf.testAsJavaScriptExpression\n      )}\">`;\n    } else {\n      this.template += `<!-- parse error: ${onIf.error} -->`;\n    }\n  }\n\n  onCloseIf(onCloseIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]) {\n    this.template += `</span>`;\n  }\n\n  onFinalise(onFinalise: Parameters<TemplateFormat[\"onFinalise\"]>[0]) {\n    const componentVarName = startCase(this.templateId).replace(/\\s/gi, \"\");\n\n    this.finalData = `/* DEV NOTE: this template is under development */\\n${\n      this.imports\n    }\\n\\n${this.typeScript}\\n\\n@Component({\\n  selector: '${\n      this.templateId\n    }',\\n  template: \\`${this.template.replace(\n      /`/g,\n      \"\\\\`\"\n    )}\\n\\`\\n})\\nexport default class ${componentVarName} {}`;\n\n    try {\n      this.finalData = prettier.format(this.finalData, {\n        parser: \"typescript\",\n        printWidth: 80,\n        plugins: [parserTypeScript],\n      });\n    } catch (e) {\n      // pass\n    }\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.ts`]: this.finalData,\n    };\n  }\n}\n\nfunction isFunctionReference(str: string): boolean {\n  return str.startsWith(\"on\") && str.length >= 3;\n}\n","import { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\nimport { MetaAttributeValues } from \"../../metaComponent/parseMetaHTMLAttribute\";\nimport { stringToDjangoVar } from \"../../metaComponent/parseMetaHTMLIf\";\nimport { assertUnreachable } from \"../utils\";\n\nexport class DjangoTemplate extends Template {\n  data: string;\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: \"django\" });\n    this.data = \"\";\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    const { nodeName, attributes } = onElement;\n\n    this.data += `<${nodeName}`;\n    Object.keys(attributes).forEach((name) => {\n      const attributeValues = attributes[name];\n      this.data += this.renderAttribute(name, attributeValues);\n    });\n    this.data += \">\";\n    return nodeName;\n  }\n\n  renderAttribute(name: string, attributeValues: MetaAttributeValues): string {\n    let attr = \" \";\n\n    const isOmittedIfEmpty =\n      attributeValues.length === 1 &&\n      [\"MetaAttributeVariable\"].includes(attributeValues[0].type);\n\n    if (isOmittedIfEmpty) {\n      const attributeVariable = attributeValues[0];\n      if (attributeVariable.type !== \"MetaAttributeVariable\") {\n        throw Error(`Internal error`);\n      }\n      attr += `{% if ${stringToDjangoVar(attributeVariable.id)} %}`;\n    }\n\n    attr += name;\n\n    if (attributeValues) {\n      attr += '=\"';\n      attr += attributeValues\n        .map((attributeValue): string => {\n          switch (attributeValue.type) {\n            case \"MetaAttributeConstant\": {\n              return attributeValue.value;\n            }\n            case \"MetaAttributeVariable\": {\n              return `{{ ${stringToDjangoVar(attributeValue.id)} }}`;\n            }\n            case \"MetaAttributeVariableOptions\": {\n              return Object.entries(attributeValue.options)\n                .map(([optionName, optionValue], index, arr) => {\n                  let exp = \"\";\n                  if (index === 0) {\n                    exp += `{% if `;\n                  } else {\n                    exp += `{% elif `;\n                  }\n                  exp += stringToDjangoVar(attributeValue.id);\n                  exp += \" == \";\n                  exp += JSON.stringify(optionName);\n                  exp += ` %}`;\n                  exp += optionValue;\n                  if (index === arr.length - 1) {\n                    exp += `{% endif %}`;\n                  }\n                  return exp;\n                })\n                .join(\"\");\n            }\n          }\n          return assertUnreachable();\n        })\n        .join(\"\")\n        .trim();\n\n      attr += '\"';\n    }\n\n    if (isOmittedIfEmpty) {\n      const attributeVariable = attributeValues[0];\n      if (attributeVariable.type !== \"MetaAttributeVariable\") {\n        throw Error(`Internal error`);\n      }\n      attr += `{% endif %}`;\n    }\n\n    return attr;\n  }\n\n  onCloseElement(args: Parameters<TemplateFormat[\"onCloseElement\"]>[0]): void {\n    this.data += `</${args.openingElement}>`;\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    this.data += onText.value;\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    this.data += `{% ${onComment.value} %}`;\n  }\n\n  onVariable(\n    variable: Parameters<TemplateFormat[\"onVariable\"]>[0]\n  ): ReturnType<TemplateFormat[\"onVariable\"]> {\n    const prop = this.props[variable.id];\n\n    if (prop && !prop.required && variable.children.length > 0) {\n      this.data += `{% if ${stringToDjangoVar(variable.id)} %}`;\n    }\n    this.data += `{{ ${stringToDjangoVar(variable.id)} }}`;\n    if (prop && !prop.required && variable.children.length > 0) {\n      this.data += `{% else %}`;\n    }\n    if (prop && prop.required) return true;\n  }\n\n  onCloseVariable(variable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    const prop = this.props[variable.id];\n\n    if (prop && !prop.required && variable.children.length > 0) {\n      this.data += `{% endif %}`;\n    }\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    if (onIf.parseError === false) {\n      this.data += `{% ${onIf.testAsPythonExpression} %}`;\n    }\n  }\n\n  onCloseIf(onCloseIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]) {\n    if (onCloseIf.parseError === false) {\n      this.data += `{% endif %}`;\n    }\n  }\n\n  onFinalise(onSerialize: Parameters<TemplateFormat[\"onFinalise\"]>[0]) {\n    // pass\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.html`]: this.data,\n    };\n  }\n}\n","import { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\nimport { MetaAttributeValues } from \"../../metaComponent/parseMetaHTMLAttribute\";\nimport { assertUnreachable } from \"../utils\";\n\nexport class EmberTemplate extends Template {\n  data: string;\n  unescapedVariables: string[];\n  usesTruthHelpers: boolean;\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: \"ember\" });\n    this.data = \"\";\n    this.usesTruthHelpers = false;\n    this.unescapedVariables = [];\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    const { nodeName, attributes } = onElement;\n\n    this.data += `<${nodeName}`;\n    Object.keys(attributes).forEach((name) => {\n      const attributeValues = attributes[name];\n      this.data += this.renderAttribute(name, attributeValues);\n    });\n    this.data += \">\";\n    return nodeName;\n  }\n\n  renderAttribute(name: string, attributeValues: MetaAttributeValues): string {\n    let attr = \" \";\n\n    const containsSingleVariable =\n      attributeValues.length === 1 &&\n      attributeValues[0].type === \"MetaAttributeVariable\";\n\n    attr += name;\n\n    if (attributeValues) {\n      attr += \"=\";\n      if (!containsSingleVariable) {\n        attr += '\"';\n      }\n      attr += attributeValues\n        .map((attributeValue): string => {\n          switch (attributeValue.type) {\n            case \"MetaAttributeConstant\": {\n              return attributeValue.value;\n            }\n            case \"MetaAttributeVariable\": {\n              return `{{@${attributeValue.id}}}`;\n            }\n            case \"MetaAttributeVariableOptions\": {\n              this.usesTruthHelpers = true;\n              return Object.entries(attributeValue.options)\n                .map(([optionName, optionValue]) => {\n                  return `{{if (eq ${attributeValue.id} ${JSON.stringify(\n                    optionName\n                  )})}}${optionValue}{{/if}}`;\n                })\n                .join(\"\");\n            }\n          }\n          return assertUnreachable();\n        })\n        .join(\"\")\n        .trim();\n\n      if (!containsSingleVariable) {\n        attr += '\"';\n      }\n    }\n\n    return attr;\n  }\n\n  onCloseElement(args: Parameters<TemplateFormat[\"onCloseElement\"]>[0]): void {\n    this.data += `</${args.openingElement}>`;\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    this.data += onText.value;\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    this.data += `<!-- ${onComment.value} -->`;\n  }\n\n  onVariable(\n    variable: Parameters<TemplateFormat[\"onVariable\"]>[0]\n  ): ReturnType<TemplateFormat[\"onVariable\"]> {\n    const prop = this.props[variable.id];\n\n    this.unescapedVariables.push(variable.id);\n\n    if (prop) {\n      if (prop.required) {\n        this.data += `{{@${variable.id}}}`;\n      } else {\n        this.data += `{{#if ${variable.id}}}`;\n        this.data += `{{@${variable.id}}}`;\n        if (variable.children.length > 0) {\n          this.data += `{{else}}`;\n        }\n      }\n      if (prop.required) return true;\n    }\n  }\n\n  onCloseVariable(variable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    const prop = this.props[variable.id];\n\n    if (prop && !prop.required && variable.children.length > 0) {\n      this.data += `{{/${variable.id}}}`;\n    }\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    if (onIf.parseError === false) {\n      this.data += `{{#if @${this.renderIf(onIf.testAsJavaScriptExpression)}}}`;\n    }\n  }\n\n  renderIf(expression: string): string {\n    return expression.replace(/[\\s\"']/gi, \"\").replace(/[=]+/g, \"=\");\n  }\n\n  onCloseIf(onCloseIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]) {\n    if (onCloseIf.parseError === false) {\n      this.data += `{{/if}}`;\n    }\n  }\n\n  onFinalise(onSerialize: Parameters<TemplateFormat[\"onFinalise\"]>[0]) {\n    let unescaped = \"\";\n\n    this.data = `${\n      this.usesTruthHelpers\n        ? \"<!-- This uses Ember Truth Helpers https://www.npmjs.com/package/ember-truth-helpers -->\\n\"\n        : \"\"\n    }${unescaped}${this.data}`;\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.hbs`]: this.data,\n    };\n  }\n}\n","import { MetaComponent } from \"../metaComponent/metaComponent\";\nimport { TemplateFiles } from \"../types\";\nimport { Template, OnConstructor } from \"./Template\";\n\nimport { CSSTemplate } from \"./CSS/CSS\";\nimport { HTMLTemplate } from \"./HTML/HTML\";\nimport { ReactTemplate } from \"./React/React\";\nimport { ReactStyledComponentsTemplate } from \"./ReactStyledComponents/ReactStyledComponents\";\nimport { MustacheTemplate } from \"./Mustache/Mustache\";\nimport { VueTemplate } from \"./Vue/Vue\";\nimport { VueJSXTemplate } from \"./Vue-JSX/Vue-JSX\";\nimport { AngularTemplate } from \"./Angular/Angular\";\nimport { DjangoTemplate } from \"./Django/Django\";\nimport { EmberTemplate } from \"./Ember/Ember\";\n\ntype MakeTemplatesProps = {\n  templateId: string;\n  metaComponent: MetaComponent;\n};\n\nexport function makeTemplates({\n  templateId,\n  metaComponent,\n}: MakeTemplatesProps): TemplateFiles {\n  const args: OnConstructor = {\n    props: metaComponent.props,\n    templateId,\n    hasMultipleRootNodes: metaComponent.nodes.length > 1,\n  };\n  return mergeTemplateFiles(\n    makeTemplate(templateId, metaComponent, new HTMLTemplate(args)),\n    makeTemplate(templateId, metaComponent, new CSSTemplate(args)),\n    makeTemplate(templateId, metaComponent, new MustacheTemplate(args)),\n    makeTemplate(templateId, metaComponent, new DjangoTemplate(args)),\n    makeTemplate(templateId, metaComponent, new ReactTemplate(args)),\n    makeTemplate(\n      templateId,\n      metaComponent,\n      new ReactStyledComponentsTemplate(args)\n    ),\n    makeTemplate(templateId, metaComponent, new VueTemplate(args)),\n    makeTemplate(templateId, metaComponent, new VueJSXTemplate(args)),\n    makeTemplate(templateId, metaComponent, new AngularTemplate(args)),\n    makeTemplate(templateId, metaComponent, new EmberTemplate(args))\n  );\n}\n\nfunction mergeTemplateFiles(...obj: TemplateFiles[]): TemplateFiles {\n  return Object.assign({}, ...obj);\n}\n\nfunction makeTemplate(\n  templateId: string,\n  metaComponent: MetaComponent,\n  instance: Template\n) {\n  function walk(node: MetaComponent[\"nodes\"][number]) {\n    switch (node.type) {\n      case \"Element\": {\n        const openingElement = instance.onElement(node);\n        node.children.forEach(walk);\n        instance.onCloseElement({ openingElement, children: node.children });\n        break;\n      }\n      case \"Text\": {\n        instance.onText(node);\n        break;\n      }\n      case \"Comment\": {\n        instance.onComment(node);\n        break;\n      }\n      case \"Variable\": {\n        const shouldNotRenderChildren = instance.onVariable(node);\n        if (!shouldNotRenderChildren) {\n          node.children.forEach(walk);\n        }\n        instance.onCloseVariable(node);\n        break;\n      }\n      case \"If\": {\n        instance.onIf(node);\n        node.children.forEach(walk);\n        instance.onCloseIf(node);\n        break;\n      }\n    }\n  }\n\n  metaComponent.nodes.forEach(walk);\n\n  instance.onFinalise({ css: metaComponent.cssString });\n\n  return instance.serialize();\n}\n","export type Log = (...args: any[]) => void;\n\nexport function logFactory(haltOnErrors: boolean): Log {\n  return (...args) => {\n    if (haltOnErrors) {\n      throw Array.from(args)\n        .map((arg) => arg.toString())\n        .join(\"\\n\");\n    }\n    console.log(...args, \"\");\n  };\n}\n","import { useState, useRef, useCallback, useEffect } from \"react\";\n\nimport { localStorageWrapper } from \"./storage\";\nimport { generateTemplates, MetaComponents } from \"../lib\";\n\nconst STORAGE_RESULT_INDEX = \"STORAGE_RESULT_INDEX2\";\nconst STORAGE_METAHTML = \"STORAGE_METAHTML2\";\nconst STORAGE_CSS = \"STORAGE_CSS2\";\n\nconst oneFrameMs = 15;\n\nconst showEverything = window.document.location?.search.includes(\"?everything\");\n\nlet hashState: any = window.location.hash\n  ? parseInt(window.location.hash.replace(/#/, \"\"), 10)\n  : undefined;\n\nif (Number.isNaN(hashState)) {\n  hashState = undefined;\n}\n\nconst resultIndexString = localStorageWrapper.getItem(STORAGE_RESULT_INDEX);\n\nconst resultIndexNumber = resultIndexString\n  ? parseInt(resultIndexString, 10)\n  : NaN;\n\nconst resultIndex =\n  hashState !== undefined\n    ? hashState\n    : !Number.isNaN(resultIndexNumber)\n    ? resultIndexNumber\n    : showEverything\n    ? 0\n    : 5;\n\nconst defaultValues = {\n  metaHTML:\n    localStorageWrapper.getItem(STORAGE_METAHTML) ||\n    `<h1\\n  class=\"my-style {{ colour: my-style--blue as blue | my-style--red as red }}\"\\n>\\n  <m-variable id=\"children\" optional>fallback content...</m-variable>\\n</h1>`,\n  css:\n    localStorageWrapper.getItem(STORAGE_CSS) ||\n    `\n.my-style {\n  padding: 5px;\n}\n.my-style--blue {\n  color: blue;\n}\n.my-style--red {\n  color: red;\n}\n/* the following CSS isn't used and will be tree shaken! */\n.treeShake {\n  color: green;\n}`.trim(),\n  resultIndex,\n};\n\nconst templateId = \"MyComponent\";\n\nexport type Mode = \"Component\" | \"Usage\";\n\nexport function useReplState() {\n  const [mode, setMode] = useState<Mode>(\"Component\");\n  const [metaHTML, setMetaHTML] = useState<string>(defaultValues.metaHTML);\n  const [css, setCSS] = useState<string>(defaultValues.css);\n  const [resultIndex, setResultIndex] = useState<number>(\n    defaultValues.resultIndex\n  );\n  const [metaComponents, setMetaComponents] = useState<MetaComponents>();\n  const iframeRef = useRef(null);\n  const debounceTime = useRef<number>(250);\n\n  const reprocessTimer = useRef<NodeJS.Timeout | undefined>(undefined);\n\n  const reprocessMetaComponent = () => {\n    const iframeEl: HTMLIFrameElement | null = iframeRef.current;\n    if (!iframeEl) {\n      console.log(\"No iframe ref available. Retrying soon...\", iframeEl);\n      reprocessMetaComponentSoon();\n      return;\n    }\n    // @ts-ignore\n    const domDocument = iframeEl.contentWindow?.document;\n    if (!domDocument) {\n      console.log(\n        \"No iframe contentWindow document available. Retrying soon...\",\n        domDocument\n      );\n      reprocessMetaComponentSoon();\n      return;\n    }\n    const documentElement = domDocument.documentElement;\n    if (!documentElement) {\n      console.log(\n        \"No iframe documentElement available. Retrying soon...\",\n        documentElement\n      );\n      reprocessMetaComponentSoon();\n      return;\n    }\n    const startTime = Date.now();\n    const result = generateTemplates({\n      domDocument,\n      templateId,\n      metaHTMLString: metaHTML,\n      cssString: css,\n      haltOnErrors: false,\n    });\n    const endTime = Date.now();\n    let newDebounceTime = endTime - startTime;\n    newDebounceTime =\n      newDebounceTime < oneFrameMs ? oneFrameMs : newDebounceTime;\n    console.info(`Debouncing calling MetaComponent at ${newDebounceTime}ms`);\n    debounceTime.current = newDebounceTime;\n    setMetaComponents(result);\n  };\n\n  const reprocessMetaComponentSoon = () => {\n    if (reprocessTimer.current) {\n      clearTimeout(reprocessTimer.current);\n    }\n    reprocessTimer.current = setTimeout(\n      reprocessMetaComponent,\n      debounceTime.current\n    );\n  };\n\n  const iframeRefCallback = useCallback((node) => {\n    /* eslint-disable */\n    console.log(\"Setting iframe \", node);\n    iframeRef.current = node; // for some reason setting ref={iframeRef} wasn't working in Chrome\n    reprocessMetaComponentSoon();\n  }, []); /* eslint-disable */\n\n  useEffect(() => {\n    reprocessMetaComponentSoon();\n  }, [metaHTML, css]);\n\n  const filePaths = metaComponents ? Object.keys(metaComponents.files) : [];\n\n  const outputValue = metaComponents\n    ? resultIndex === 0\n      ? JSON.stringify(metaComponents, null, 2)\n      : filePaths[resultIndex - 1]\n      ? metaComponents.files[filePaths[resultIndex - 1]]\n      : \"\"\n    : \"\";\n\n  const outputMode =\n    resultIndex === 0\n      ? \"json\"\n      : filePaths[resultIndex - 1]\n      ? aceMode(filePaths[resultIndex - 1])\n      : \"json\";\n\n  const htmlTimer = useRef<NodeJS.Timeout | undefined>(undefined);\n\n  const publicSetMetaHTML = (val: string) => {\n    let html = val;\n    // DEVELOPER NOTE\n    // This just seems to crash and I don't know why\n    //\n    // try {\n    //   console.log({ html });\n    //   html = prettier.format(html, {\n    //     parser: \"html\",\n    //     printWidth: 80,\n    //     plugins: [parserHTML],\n    //   });\n    // } catch (e) {\n    //   console.error(e);\n    // }\n    html = html || val;\n    setMetaHTML(html);\n    if (htmlTimer.current) {\n      clearTimeout(htmlTimer.current);\n    }\n    htmlTimer.current = setTimeout(\n      (_) => localStorageWrapper.setItem(STORAGE_METAHTML, html),\n      oneFrameMs\n    );\n  };\n\n  const cssTimer = useRef<NodeJS.Timeout | undefined>(undefined);\n\n  const publicSetCSS = (css: string) => {\n    setCSS(css);\n\n    if (cssTimer.current) {\n      clearTimeout(cssTimer.current);\n    }\n    cssTimer.current = setTimeout(\n      (_) => localStorageWrapper.setItem(STORAGE_CSS, css),\n      oneFrameMs\n    );\n  };\n\n  const resultIndexTimer = useRef<NodeJS.Timeout | undefined>(undefined);\n\n  const publicSetResultIndex = (index: number) => {\n    setResultIndex(index);\n\n    window.location.hash = index.toString();\n    const tabButton = document.getElementById(`tab-${index}`);\n    if (tabButton) {\n      tabButton.focus();\n    }\n    if (resultIndexTimer.current) {\n      clearTimeout(resultIndexTimer.current);\n    }\n    resultIndexTimer.current = setTimeout(\n      (_) =>\n        localStorageWrapper.setItem(STORAGE_RESULT_INDEX, index.toString()),\n      oneFrameMs\n    );\n  };\n\n  const moveResultIndex = (\n    e: React.KeyboardEvent<HTMLButtonElement>,\n    resultIndex: number\n  ) => {\n    const keyCode = e.which || e.keyCode;\n    switch (keyCode) {\n      case 37: // left\n      case 38: // up\n        const lowestIndex = showEverything ? 0 : 1;\n        if (resultIndex > lowestIndex) {\n          publicSetResultIndex(resultIndex - 1);\n        }\n        break;\n      case 39: // right\n      case 40: // down\n        const numberOfResults =\n          (metaComponents && metaComponents.files\n            ? Object.keys(metaComponents.files).length\n            : 0) + 1;\n        if (resultIndex < numberOfResults - 1) {\n          publicSetResultIndex(resultIndex + 1);\n        }\n        break;\n    }\n  };\n\n  return {\n    mode,\n    setMode,\n    metaHTML,\n    setMetaHTML: publicSetMetaHTML,\n    css,\n    setCSS: publicSetCSS,\n    resultIndex,\n    setResultIndex: publicSetResultIndex,\n    templateId,\n    iframeRef,\n    iframeRefCallback,\n    metaComponents,\n    outputValue,\n    outputMode,\n    showEverything,\n    moveResultIndex,\n  };\n}\n\nfunction aceMode(file: string) {\n  const dirname = file.substring(0, file.indexOf(\"/\"));\n  if (dirname === \"react\") {\n    return \"javascript\";\n  }\n  return dirname;\n}\n","// MetaComponent WebTemplateTranslator\nimport {\n  parseMetaComponentString,\n  MetaComponent,\n} from \"./metaComponent/metaComponent\";\nimport { makeTemplates } from \"./makeTemplates/makeTemplates\";\nimport { TemplateFiles } from \"./types\";\nimport { logFactory } from \"./log\";\n\ntype Props = {\n  domDocument: Document;\n  templateId: string;\n  metaHTMLString: string;\n  cssString: string;\n  haltOnErrors: boolean;\n};\n\nexport type MetaComponents = {\n  metaComponent: MetaComponent;\n  files: TemplateFiles;\n};\n\nexport function generateTemplates({\n  domDocument,\n  templateId,\n  metaHTMLString,\n  cssString,\n  haltOnErrors,\n}: Props): MetaComponents {\n  const metaComponent = parseMetaComponentString({\n    domDocument,\n    metaHTMLString,\n    cssString,\n    log: logFactory(haltOnErrors),\n  });\n\n  return {\n    metaComponent,\n    files: makeTemplates({ templateId, metaComponent }),\n  };\n}\n","import React, { Fragment } from \"react\";\nimport { ComponentMode } from \"./Repl/ComponentMode\";\nimport { UsageMode } from \"./Repl/UsageMode\";\n\nimport { WhyModal } from \"./Repl/Modals/WhyModal\";\nimport { WhatModal } from \"./Repl/Modals/WhatModal\";\nimport { Header } from \"./Repl/Header\";\n\nimport { useReplState } from \"./Repl/useReplState\";\nimport { useModalState } from \"./Repl/Modals/useModalState\";\n\nimport \"./App.css\";\n\nconst theme = \"monokai\";\n\nfunction App() {\n  const {\n    mode,\n    setMode,\n    metaHTML,\n    setMetaHTML,\n    css,\n    setCSS,\n    showEverything,\n    iframeRefCallback,\n    metaComponents,\n    resultIndex,\n    outputValue,\n    outputMode,\n    setResultIndex,\n    moveResultIndex,\n  } = useReplState();\n  const {\n    isWhatOpen,\n    isWhyOpen,\n    openWhyModal,\n    openWhatModal,\n    closeWhyModal,\n    closeWhatModal,\n  } = useModalState();\n\n  return (\n    <Fragment>\n      <WhyModal isOpen={isWhyOpen} closeModal={closeWhyModal} />\n      <WhatModal\n        isOpen={isWhatOpen}\n        closeModal={closeWhatModal}\n        openWhyModal={openWhyModal}\n      />\n      <div className={`MetaComponentDemo MetaComponentDemo--mode-${mode}`}>\n        <Header\n          isWhyOpen={isWhyOpen}\n          openWhyModal={openWhyModal}\n          mode={mode}\n          setMode={setMode}\n        />\n\n        <iframe\n          id=\"iframe\"\n          src=\"./iframe.html\"\n          className=\"iframe_container\"\n          title=\"MetaComponent iframe\"\n          ref={iframeRefCallback}\n        ></iframe>\n\n        {mode === \"Component\" && (\n          <ComponentMode\n            {...{\n              metaComponents,\n              resultIndex,\n              outputValue,\n              outputMode,\n              setResultIndex,\n              moveResultIndex,\n              metaHTML,\n              setMetaHTML,\n              css,\n              setCSS,\n              showEverything,\n              isWhatOpen,\n              isWhyOpen,\n              openWhyModal,\n              openWhatModal,\n              closeWhyModal,\n              closeWhatModal,\n              theme,\n            }}\n          />\n        )}\n        {mode === \"Usage\" && <UsageMode />}\n      </div>\n    </Fragment>\n  );\n}\n\nexport default App;\n","import { useState, useEffect } from \"react\";\n\nexport function useModalState() {\n  const [isWhatOpen, setIsWhatOpen] = useState<boolean>(false);\n  const [isWhyOpen, setIsWhyOpen] = useState<boolean>(true);\n\n  const openWhatModal = () => {\n    setIsWhyOpen(false);\n    setIsWhatOpen(true);\n  };\n  const closeWhatModal = () => setIsWhatOpen(false);\n\n  const openWhyModal = () => {\n    setIsWhatOpen(false);\n    setIsWhyOpen(true);\n  };\n  const closeWhyModal = () => setIsWhyOpen(false);\n\n  useEffect(() => {\n    const root: HTMLElement | null = document.querySelector(\"#root\");\n    if (!root) return;\n    if (isWhatOpen || isWhyOpen) {\n      root.classList.add(\"blur\");\n    } else {\n      root.classList.remove(\"blur\");\n    }\n  }, [isWhatOpen, isWhyOpen]);\n\n  return {\n    isWhatOpen,\n    setIsWhatOpen,\n    openWhatModal,\n    closeWhatModal,\n    isWhyOpen,\n    setIsWhyOpen,\n    openWhyModal,\n    closeWhyModal,\n  };\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}