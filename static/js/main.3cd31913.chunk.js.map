{"version":3,"sources":["peacock.png","lib/metaComponent/parseMetaHTML.ts","lib/metaComponent/parseMetaHTMLAttribute.ts","lib/cssSniff/cssSniff.ts","lib/metaComponent/parseMetaHTMLIf.ts","lib/metaComponent/getProps.ts","lib/makeTemplates/utils.ts","lib/metaComponent/metaComponent.ts","lib/metaComponent/parseMetaVariable.ts","lib/makeTemplates/Template.ts","lib/makeTemplates/CSS/CSS.ts","lib/makeTemplates/HTML/HTML.ts","lib/makeTemplates/React/React.util.ts","lib/makeTemplates/React/React.ts","lib/makeTemplates/ReactStyledComponents/ReactStyledComponents.ts","lib/makeTemplates/Mustache/Mustache.ts","lib/makeTemplates/Vue/Vue.ts","lib/makeTemplates/makeTemplates.ts","lib/log.ts","storage.tsx","App.tsx","lib/index.ts","index.tsx"],"names":["module","exports","parseHTMLWithoutInsertionMode","domDocument","metaHTMLString","cssString","log","documentString","html","parsingModeTags","replace","match","closingTag","tagName","isClosingTag","response","includes","MT_ALIAS_ATTR","aliasParsingModeElements","wrapBodyHtml","documentElement","innerHTML","doc","Array","from","querySelectorAll","forEach","alias","getAttribute","childNodes","unaliased","createElement","parentNode","insertBefore","childNode","appendChild","getAttributeNames","filter","name","toLowerCase","attr","previousAttributeValue","setAttribute","removeChild","restoreParsingModeElements","childlessElementName","childlessElement","lastChild","nextElementSibling","moveChildlessElements","parseMetaAttributeVariable","dk","optionalRegexp","RegExp","separatorIndex","indexOf","keySegment","substring","isOptional","trim","endsWith","type","id","required","options","length","split","reduce","option","parts","cssSniff","children","matchedCSS","matched","child","nodeType","Node","ELEMENT_NODE","el","sniffRoot","sheets","ownerDocument","styleSheets","Error","sheetsArray","i","sheet","cssRulesArray","cssRules","sheetIsAllowed","cssSniffStyleSheet","_filterCSSRulesByElement","getCSSMatchesByElement","ignoreChildren","rules","rule","selectorText","cssStyleRule","sanitisedSelector","ruleString","whitelisted","blacklisted","whitelistRules","whitelist","ruleMatches","isArray","some","ruleMatch","blacklistRules","blacklist","ruleIsAllowed","selectors","selector","splitted","parens","angulars","soFar","len","char","push","splitSelectors","normalizedSelector","unique","matches","existingCSSSniffStyleRule","cssSniffStyleRule","properties","cssText","lastIndexOf","e","console","error","trimmedSelector","media","cssMediaRule","conditionText","mediaString","whitelistMedia","mediaMatches","mediaMatch","blacklistMedia","mediaIsAllowed","existingMediaRule","childrenRules","Object","keys","before","ownerNode","checkStylesheet","sheetMatch","nodeName","nodeAttrs","attributes","attrs","value","JSON","stringify","whitelistStylesheets","stylesheet","blacklistStylesheets","serializeCSSMatchesAsProperties","values","map","childRule","join","parseMetaHTMLIf","htmlElement","optional","hasAttribute","test","testAsJavaScriptExpression","ids","AST","parseExpression","node","identifierName","findIdentifiers","generate","code","parseError","toString","getProps","nodes","props","walk","attributeName","attributeValuePart","validJavaScriptIdentifer","assertUnreachable","x","parseMetaComponentString","body","nodeToMetaNode","TEXT_NODE","textContent","COMMENT_NODE","names","parseMetaVariable","attributeValue","metaHTMLAttributeValueString","remaining","startIndex","endIndex","dkString","metaVariable","parseAttributeValue","cssProperties","element","attributesThatCanBeSet","attribute","metaAttribute","resetElementAttributes","resetMatchedCSS","cssPropertiesStringConstants","cssPropertiesString","resetValue","conditionalNode","condition","entries","optionName","optionValue","a","b","diff","bSheetIndex","bSheet","bRuleIndex","bRule","diffStyleSheet","diffRule","aRule","diffChildren","bRuleChildIndex","cssRootDiff","getAllMatchingCSSProperties","getAllMatchingCSSRulesRecursively","internalToPublic","walkAttributes","internalAttributes","key","newAttributeValues","newValue","getAllMatchingCSSRules","css","sheetIndex","ruleIndex","childRuleIndex","serializeCSSMatches","Template","args","dirname","templateId","hasMultipleRootNodes","this","onElement","onText","onComment","onVariable","onCloseVariable","onIf","onCloseIf","onFinalise","CSSTemplate","variable","closeVariable","prettier","format","parser","printWidth","plugins","parserPostCSS","HTMLTemplate","attributeValues","optionKeys","firstKey","onCloseElement","openingElement","parserHTML","transform","class","for","autocomplete","readonly","autofocus","srcset","crossorigin","spellcheck","tabindex","maxlength","attributeNameTransform","getTypeScriptElementName","capitalize","ReactTemplate","imports","render","typeScript","constants","fileData","setTypeScript","bind","renderPropType","setImports","renderRenderFunction","propId","prop","propString","propIds","destructure","renderAttribute","reactAttributeName","containsExpression","containsConstant","renderAttributeValue","identifier","onSerialize","parserTypeScript","ReactStyledComponentsTemplate","styledConstants","counter","styledName","toUpperCase","pickedProps","renderCSSPropertyProps","styledProps","cssProperty","renderCSSProperty","styledAttributes","cssPropertiesNode","isValidIdentifier","conditional","propUnion","uniq","val","MustacheTemplate","data","isOmittedIfEmpty","attributeVariable","renderIf","expression","VueTemplate","template","script","style","computed","finalData","getNewComputedName","containsOnlyConstants","every","computedName","computedProp","identifiers","responseType","propExpression","startCase","undefined","computedString","propName","containsInvalidIdentifiers","spreadProps","computeFunction","componentVarName","parserAngular","makeTemplates","metaComponent","obj","assign","mergeTemplateFiles","makeTemplate","instance","serialize","logFactory","haltOnErrors","arg","STORAGE_TYPE","localStorageWrapper","setItem","window","localStorage","sessionStorage","getItem","removeItem","showEverything","document","location","search","resultIndexString","resultIndex","parseInt","defaultValues","metaHTML","modalStyles","overlay","backgroundColor","zIndex","border","content","background","inset","top","bottom","right","left","Flash","text","timer","useRef","useState","animate","setAnimate","onKeyPress","current","setTimeout","clearTimeout","className","pathType","file","Modal","setAppElement","App","setMetaHTML","setCSS","metaComponents","setMetaComponents","setResultIndex","isWhatOpen","setIsWhatOpen","isWhyOpen","setIsWhyOpen","debounceTime","iframeRef","closeWhatModal","openWhyModal","closeWhyModal","useEffect","root","querySelector","classList","add","remove","iframeRefCallback","useCallback","handler","iframeEl","contentWindow","startTime","Date","now","result","files","generateTemplates","newDebounceTime","info","filePaths","outputValue","outputMode","aceMode","markers","templateIdIndex","outputValueBefore","rowIndex","startCol","startRow","endRow","endCol","inFront","isOpen","onRequestClose","contentLabel","shouldCloseOnOverlayClick","onClick","stopPropagation","aria-hidden","aria-label","aria-expanded","aria-controls","dangerouslySetInnerHTML","__html","whatIsMetaHTML","whyIsMetaComponent","href","target","rel","src","peacock","alt","mode","theme","onChange","width","height","showGutter","showPrintMargin","title","ref","role","aria-selected","fileIndex","formatName","readOnly","marked","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.3cd31913.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/peacock.03b69fcf.png\";","import { Log } from \"../log\";\n// Combine metaHTML and CSS in an HTML document string, and restore parsing mode\n// problems.\n//\n// Some tags like <select> and <tbody> etc., invoke HTML5 parsing modes\n// that only allow certain tags within them, or they rearrange the tree\n// based on those tags, so we need to alias them. See\n// https://www.w3.org/TR/2011/WD-html5-20110113/parsing.html#the-insertion-mode\n// So that would mean we couldn't have tags like,\n//\n// <select>\n//   <mt-variable key=\"children\">placeholder</mt-variable>\n// </select>\n//\n// So instead we'll turn that into,\n//\n// <mt-alias-select>\n//   <mt-variable key=\"children\">placeholder</mt-variable>\n// </mt-alias-select>\n//\n// and then rename the element after parsing\n\ntype Props = {\n  domDocument: Document;\n  metaHTMLString: string;\n  cssString: string;\n  log: Log;\n};\n\nexport function parseHTMLWithoutInsertionMode({\n  domDocument,\n  metaHTMLString,\n  cssString,\n  log,\n}: Props): void {\n  const documentString = wrapBodyHtml(metaHTMLString, cssString);\n  domDocument.documentElement.innerHTML = documentString;\n\n  restoreParsingModeElements(domDocument, log);\n  moveChildlessElements(domDocument);\n}\n\nfunction wrapBodyHtml(metaHTMLString: string, cssString: string): string {\n  return `<head><style>${cssString}</style></head><body>${aliasParsingModeElements(\n    metaHTMLString\n  )}</body>`;\n}\n\nconst MT_ALIAS_TAG = \"mt-\";\nconst MT_ALIAS_ATTR = \"data-mt-original-element-name\";\n\nfunction aliasParsingModeElements(html: string): string {\n  const parsingModeTags = [\n    \"table\",\n    \"thead\",\n    \"tbody\",\n    \"tfoot\",\n    \"tr\",\n    \"caption\",\n    \"select\",\n    \"option\",\n  ];\n\n  return html.replace(/<([/]?)([^ >]+)/gi, (match, closingTag, tagName) => {\n    const isClosingTag = !!closingTag;\n    let response = `<${isClosingTag ? \"/\" : \"\"}`;\n    if (parsingModeTags.includes(tagName)) {\n      response += MT_ALIAS_TAG;\n      if (!isClosingTag) {\n        response += ` ${MT_ALIAS_ATTR}=\"${tagName}\" `;\n      }\n    } else {\n      response += tagName;\n    }\n    return response;\n  });\n}\n\nfunction restoreParsingModeElements(domDocument: Document, log: Log): void {\n  const doc = domDocument;\n  const aliases = Array.from(doc.querySelectorAll(MT_ALIAS_TAG));\n  aliases.forEach((alias: Element) => {\n    if (!alias) return;\n    const tagName = alias.getAttribute(MT_ALIAS_ATTR);\n    if (!tagName) {\n      log(`MetaComponent: ${MT_ALIAS_TAG} missing ${MT_ALIAS_ATTR} attribute.`);\n      return;\n    }\n    const childNodes = Array.from(alias.childNodes);\n    const unaliased = doc.createElement(tagName);\n    if (!alias.parentNode) {\n      log(\"MetaComponent parsing mode element must not be top-level.\");\n      return;\n    }\n    alias.parentNode.insertBefore(unaliased, alias);\n    childNodes.forEach((childNode) => {\n      unaliased.appendChild(childNode);\n    });\n    const attrs = alias.getAttributeNames().filter(\n      (name) => name.toLowerCase() !== MT_ALIAS_ATTR.toLowerCase() // because DOMs can lowercase attributes so we need a case-insensitive string comparison\n    );\n    attrs.forEach((attr) => {\n      const previousAttributeValue = alias.getAttribute(attr);\n      if (!previousAttributeValue) {\n        log(\"MetaComponent: must have a previous attribute value\");\n        return;\n      }\n      unaliased.setAttribute(attr, previousAttributeValue);\n    });\n    alias.parentNode.removeChild(alias);\n  });\n}\n\nfunction moveChildlessElements(domDocument: Document) {\n  const childlessElementNames: string[] = [];\n  childlessElementNames.forEach((childlessElementName: string): void => {\n    Array.from(domDocument.querySelectorAll(childlessElementName)).forEach(\n      (childlessElement: Element) => {\n        while (childlessElement.lastChild) {\n          childlessElement.parentNode?.insertBefore(\n            childlessElement.lastChild,\n            childlessElement.nextElementSibling\n          );\n        }\n      }\n    );\n  });\n}\n","import { Log } from \"../log\";\n\nexport const parseAttributeValue = (\n  metaHTMLAttributeValueString: string,\n  log: Log\n): MetaAttributeValuesInternal => {\n  const response: MetaAttributeValuesInternal = [];\n  let remaining: string = metaHTMLAttributeValueString;\n  const start = \"{{\" as const;\n  const end = \"}}\" as const;\n\n  while (remaining.length) {\n    const startIndex = remaining.indexOf(start);\n\n    if (startIndex === -1) {\n      // no MetaAttributeVariable, just string remainings\n      response.push({\n        type: \"MetaAttributeConstant\",\n        value: remaining,\n      });\n      remaining = \"\";\n    } else if (startIndex === 0) {\n      // a MetaAttributeVariable\n      const endIndex = remaining.indexOf(end, startIndex);\n      if (endIndex === -1) {\n        log(`Attribute with ${start} but no ${end}.`);\n        return response;\n      }\n      const dkString = remaining.substring(start.length, endIndex);\n      const metaVariable = parseMetaAttributeVariable(dkString);\n      response.push(metaVariable);\n      remaining = remaining.substring(endIndex + end.length);\n    } else {\n      // string before another MetaVariable\n      response.push({\n        type: \"MetaAttributeConstant\",\n        value: remaining.substring(0, startIndex),\n      });\n      remaining = remaining.substring(startIndex);\n    }\n  }\n  return response;\n};\n\nexport const parseMetaAttributeVariable = (\n  dk: string\n): MetaAttributeVariableInternal | MetaAttributeVariableOptionsInternal => {\n  const SEPARATOR = \":\";\n  const ENUM_SEPARATOR = \"|\";\n  const OPTIONAL = \"?\";\n\n  const escapeTextForRegex = (text: string) => {\n    return text.replace(/([()[{*+.$^\\\\|?])/g, \"\\\\$1\");\n  };\n\n  const optionalRegexp = new RegExp(`${escapeTextForRegex(OPTIONAL)}$`); // regex anchored to end of string\n\n  const separatorIndex = dk.indexOf(SEPARATOR);\n  let keySegment = separatorIndex === -1 ? dk : dk.substring(0, separatorIndex);\n  keySegment = keySegment.trim();\n  const isOptional = keySegment.endsWith(OPTIONAL);\n  if (isOptional) {\n    keySegment = keySegment.replace(optionalRegexp, \"\");\n  }\n\n  if (separatorIndex === -1) {\n    // chance to exit early\n    return {\n      type: \"MetaAttributeVariable\",\n      id: keySegment,\n      required: !isOptional,\n    };\n  }\n\n  const options: Record<string, string> = dk\n    .substring(separatorIndex + SEPARATOR.length)\n    .split(ENUM_SEPARATOR)\n    .reduce((options: Record<string, string>, option: string): Record<\n      string,\n      string\n    > => {\n      // An option is a string that looks like either,\n      //    \" valueThatIsAlsoName \"\n      //    \" value as friendlyName \"\n      // so when split by \" as \" it will have either\n      // 1 or 2 array items.\n      const parts: string[] = option.split(\" as \");\n      const name = parts.length === 2 ? parts[1].trim() : parts[0].trim();\n      if (name.length > 0) {\n        options[name] = parts[0].trim();\n      }\n      return options;\n    }, {});\n\n  return {\n    type: \"MetaAttributeVariableOptions\",\n    id: keySegment,\n    required: !isOptional,\n    options,\n  };\n};\n\nexport type MetaAttributeVariable = {\n  type: \"MetaAttributeVariable\";\n  id: string;\n};\n\nexport type MetaAttributeVariableOptions = {\n  type: \"MetaAttributeVariableOptions\";\n  id: string;\n  options: Record<string, string>;\n};\n\nexport type MetaAttributeConstant = {\n  type: \"MetaAttributeConstant\";\n  value: string;\n};\n\ntype MetaAttributeVariableInternal = MetaAttributeVariable & {\n  required: boolean;\n};\ntype MetaAttributeVariableOptionsInternal = MetaAttributeVariableOptions & {\n  required: boolean;\n};\n\nexport type MetaAttributeValueInternal =\n  | MetaAttributeConstant\n  | MetaAttributeVariableInternal\n  | MetaAttributeVariableOptionsInternal;\n\nexport type MetaAttributeValuesInternal = MetaAttributeValueInternal[];\n\nexport type MetaAttributeValue =\n  | MetaAttributeConstant\n  | MetaAttributeVariable\n  | MetaAttributeVariableOptions;\n\nexport type MetaAttributeValues = MetaAttributeValue[];\n","type Options = {\n  ignoreChildren?: boolean;\n  whitelist?: { stylesheet?: string; media?: string; rule?: string };\n  blacklist?: { stylesheet?: string; media?: string; rule?: string };\n};\n\nexport type CSSSniffRoot = {\n  [sheetIndex: string]: CSSSniffStyleSheet;\n};\n\nexport type CSSSniffStyleSheet = {\n  [ruleIndex: string]: CSSSniffStyleRule | CSSSniffMediaRule;\n};\n\nexport type CSSSniffStyleRule = {\n  type: \"CSSSniffStyleRule\";\n  selectors: string[];\n  properties: string;\n};\n\nexport type CSSSniffMediaRule = {\n  type: \"CSSSniffMediaRule\";\n  before: string;\n  children: CSSSniffStyleSheet;\n};\n\nexport function cssSniff(\n  children: ChildNode[],\n  options: Options,\n  matchedCSS?: CSSSniffRoot\n): CSSSniffRoot {\n  const matched: CSSSniffRoot = matchedCSS || {};\n\n  children.forEach((child) => {\n    if (child.nodeType !== Node.ELEMENT_NODE) {\n      // only Elements can have CSS (ie, text nodes can't have CSS)\n      return;\n    }\n    // @ts-ignore\n    const el: HTMLElement = child;\n    getCSSMatchesByElement(el, options, matched);\n    if (!options.ignoreChildren && el.childNodes) {\n      cssSniff(Array.from(el.childNodes), options, matched);\n    }\n  });\n\n  return matched;\n}\n\nfunction getCSSMatchesByElement(\n  el: HTMLElement,\n  options: Options,\n  sniffRoot: CSSSniffRoot\n): void {\n  if (el.nodeType !== Node.ELEMENT_NODE) {\n    return;\n  }\n\n  const sheets = el.ownerDocument?.styleSheets;\n  if (!sheets) {\n    throw Error(`Expected to find stylesheets of Node.`);\n  }\n  // @ts-ignore\n  const sheetsArray: CSSStyleSheet[] = Array.from(sheets);\n\n  for (let i in sheetsArray) {\n    const sheet = sheetsArray[i];\n\n    const cssRulesArray = Array.from(sheet.cssRules);\n\n    if (sheetIsAllowed(sheet, options)) {\n      const cssSniffStyleSheet: CSSSniffStyleSheet = sniffRoot[i] || {};\n      sniffRoot[i] = cssSniffStyleSheet;\n      _filterCSSRulesByElement(el, cssRulesArray, options, cssSniffStyleSheet);\n    }\n  }\n}\n\nfunction _filterCSSRulesByElement(\n  el: HTMLElement,\n  rules: CSSRule[],\n  options: Options,\n  cssSniffStyleSheet: CSSSniffStyleSheet // is mutated\n): void {\n  for (let i in rules) {\n    const rule = rules[i];\n\n    // @ts-ignore\n    if (rule.selectorText) {\n      // @ts-ignore\n      const cssStyleRule: CSSStyleRule = rule;\n      const sanitisedSelector = cssStyleRule.selectorText.replace(\n        /@charset.*?;/g,\n        \"\"\n      );\n\n      if (ruleIsAllowed(sanitisedSelector, options)) {\n        const selectors = splitSelectors(sanitisedSelector);\n\n        selectors.forEach((selector) => {\n          let trimmedSelector;\n          let normalizedSelector;\n\n          try {\n            // Exceptions may be thrown about browser-specific\n            // selectors such as\n            //\n            //   input::-moz-something\n            //   input::-webkit-something\n            //   input::-ms-something\n            //   input:-moz-something\n            //   input:-webkit-something\n            //   input:-ms-something\n            //\n            // or potentially selectors without anything before\n            // the \":\",\n            //\n            //   ::-moz-something\n            //   :not(input)\n            //\n            // and there are also escaped selectors like,\n            //\n            //   .link.\\:link\n            //\n            //  (used like <input class=\"link :link\">)\n            //\n            // and pseudo-elements like,\n            //\n            //   span::before\n            //\n            // where the \"::before\" is irrelevant to whether the\n            // selector matches the element so we should remove it.\n            //\n            // and\n            //\n            //   input:first-child\n            //   p > :first-child\n            //\n            // where we should change to\n            //   input\n            //   p > *\n            // respectively because we can't know HTML structure.\n            //\n            // So given all those scenarios we have the following logic,\n            //\n            // 1) If it starts with \":\" without anything preceding we'll\n            //    consider it a match because it could be.\n            //    (maybe this should be configurable?)\n            //\n            // 2) If it has a \":\" in it that's not preceded by \"\\\" then\n            //    we remove to the end of the selector. ie,\n            //    input:-moz-something -> input\n            //    input\\:-moz-something -> input\\:-moz-something\n            //    input::before -> input::before\n            //    input\\:\\:moz-something -> input\\:\\:moz-something\n\n            // PRE-NORMALISATON\n            // Temporarily replace \"\\:\" (escaped colon) to simplify\n            // removing \":something\" (real colon) which we restore later.\n            normalizedSelector = selector.replace(/\\\\:/g, unique).trim();\n\n            // START OF NORMALIZATION\n            // The goal here is to anticipate any possible node states that\n            // might match this node (ie, \"\":checked\" or adjacent sibling/hierarchical\n            // selectors)\n\n            normalizedSelector = normalizedSelector\n              .replace(/^.*[\\s]/, \"\") // regex 'greedy' selector anchored to string start, searching for whitespace to convert (eg) \".a + .b + .c\" to \".c\". Delete any conditions on hierarchical (adjacent sibling / descendent etc.) selectors because they could match and that's close enough to warrant including it.\n              .replace(/:+.*$/gi, \"\") // regex 'greedy' selector anchored to string end, searching for \":\" and deleting everything after\n              .trim();\n\n            // END OF NORMALISATION\n\n            // Restore escaped colons back to \"\\:\".\n            // See above comment about escaped colons.\n            normalizedSelector = normalizedSelector.replace(\n              new RegExp(unique, \"g\"),\n              \"\\\\:\"\n            );\n\n            const isMatch = el.matches(normalizedSelector);\n\n            if (isMatch) {\n              const existingCSSSniffStyleRule = cssSniffStyleSheet[i];\n              if (\n                existingCSSSniffStyleRule &&\n                existingCSSSniffStyleRule.type !== \"CSSSniffStyleRule\"\n              ) {\n                throw Error(\"Rule can't change type\");\n              }\n              const cssSniffStyleRule: CSSSniffStyleRule = {\n                type: \"CSSSniffStyleRule\",\n                selectors: existingCSSSniffStyleRule\n                  ? existingCSSSniffStyleRule.selectors\n                  : [],\n                properties: cssStyleRule.cssText.substring(\n                  cssStyleRule.cssText.indexOf(\"{\") + 1,\n                  cssStyleRule.cssText.lastIndexOf(\"}\")\n                ),\n              };\n              if (!cssSniffStyleRule.selectors.includes(selector)) {\n                cssSniffStyleRule.selectors.push(selector);\n              }\n              cssSniffStyleSheet[i] = cssSniffStyleRule;\n            }\n          } catch (e) {\n            const isCharsetError =\n              \"@charset\".indexOf(cssStyleRule.selectorText) !== -1;\n            if (!isCharsetError) {\n              console.error(\n                \"ERROR\",\n                cssStyleRule.type,\n                `[${trimmedSelector}]`,\n                `[[${normalizedSelector}]]`,\n                `(((${cssStyleRule.selectorText})))`,\n                e\n              );\n            }\n          }\n        });\n      }\n    } else if (\n      // @ts-ignore\n      rule.media\n    ) {\n      // @ts-ignore\n      const cssMediaRule: CSSMediaRule = rule;\n      const conditionText = cssMediaRule.conditionText || cssMediaRule.media[0];\n      if (mediaIsAllowed(conditionText, options)) {\n        // a nested rule like @media { rule { ... } }\n        // so we filter the rules inside individually\n        const cssRulesArray = Array.from(cssMediaRule.cssRules);\n\n        const existingMediaRule = cssSniffStyleSheet[i];\n        if (\n          existingMediaRule &&\n          existingMediaRule.type !== \"CSSSniffMediaRule\"\n        ) {\n          throw Error(`Can't change type`);\n        }\n\n        const childrenRules: CSSSniffStyleSheet = existingMediaRule\n          ? existingMediaRule.children\n          : {};\n\n        _filterCSSRulesByElement(el, cssRulesArray, options, childrenRules);\n\n        if (Object.keys(childrenRules).length > 0) {\n          cssSniffStyleSheet[i] = {\n            type: \"CSSSniffMediaRule\",\n            before: \"@media \" + conditionText,\n            children: childrenRules,\n          };\n        }\n      }\n    }\n  }\n}\n\nfunction sheetIsAllowed(sheet: StyleSheet, options: Options) {\n  // Returns boolean of whether the sheet is allowed\n  // due to whitelist/blacklist\n  if (!sheet) return false;\n  if (!sheet.ownerNode) return true;\n\n  const checkStylesheet = (sheet: StyleSheet, sheetMatch: string) => {\n    switch (sheet.ownerNode.nodeName.toLowerCase()) {\n      case \"style\":\n      case \"link\":\n        // @ts-ignore\n        const el: HTMLElement = sheet.ownerNode;\n        // matching on JSON.stringify(node.attrs)\n        const nodeAttrs = el.attributes;\n        const attrs: Record<string, string> = {};\n        for (let i = 0; i < nodeAttrs.length; i++) {\n          const name = nodeAttrs[i].name;\n          attrs[name] = nodeAttrs[i].value;\n        }\n        const attributesJSON = JSON.stringify(attrs);\n        return attributesJSON.indexOf(sheetMatch) !== -1;\n    }\n    throw new Error(\n      `CSS Sniff: Unknown sheet nodeName of ${\n        sheet.ownerNode && sheet.ownerNode.nodeName\n      } `\n    );\n  };\n\n  let whitelisted = true;\n  let blacklisted = false;\n\n  const whitelistStylesheets =\n    options.whitelist && options.whitelist.stylesheet;\n  if (whitelistStylesheets) {\n    const sheetMatches = Array.isArray(whitelistStylesheets)\n      ? Array.from(whitelistStylesheets)\n      : [whitelistStylesheets];\n    whitelisted = sheetMatches.some((sheetMatch) =>\n      checkStylesheet(sheet, sheetMatch)\n    );\n  }\n\n  const blacklistStylesheets =\n    options.blacklist && options.blacklist.stylesheet;\n  if (blacklistStylesheets) {\n    const sheetMatches = Array.isArray(blacklistStylesheets)\n      ? blacklistStylesheets\n      : [blacklistStylesheets];\n    blacklisted = sheetMatches.some((sheetMatch) =>\n      checkStylesheet(sheet, sheetMatch)\n    );\n  }\n\n  return whitelisted !== false && blacklisted !== true;\n}\n\nfunction mediaIsAllowed(mediaString: string, options: Options) {\n  if (!options || !mediaString) return false;\n\n  let whitelisted = true;\n  let blacklisted = false;\n\n  const whitelistMedia = options.whitelist && options.whitelist.media;\n  if (whitelistMedia) {\n    const mediaMatches = Array.isArray(whitelistMedia)\n      ? whitelistMedia\n      : [whitelistMedia];\n    whitelisted = mediaMatches.some(\n      (mediaMatch) => mediaString.indexOf(mediaMatch) !== -1\n    );\n  }\n\n  const blacklistMedia = options.blacklist && options.blacklist.media;\n  if (blacklistMedia) {\n    const mediaMatches = Array.isArray(blacklistMedia)\n      ? blacklistMedia\n      : [blacklistMedia];\n    blacklisted = mediaMatches.some(\n      (mediaMatch) => mediaString.indexOf(mediaMatch) !== -1\n    );\n  }\n\n  return whitelisted !== false && blacklisted !== true;\n}\n\nfunction ruleIsAllowed(ruleString: string, options: Options) {\n  if (!options || !ruleString) return false;\n\n  let whitelisted = true;\n  let blacklisted = false;\n\n  const whitelistRules = options.whitelist && options.whitelist?.rule;\n  if (whitelistRules) {\n    const ruleMatches = Array.isArray(whitelistRules)\n      ? whitelistRules\n      : [whitelistRules];\n    whitelisted = ruleMatches.some(\n      (ruleMatch) => ruleString.indexOf(ruleMatch) !== -1\n    );\n  }\n\n  const blacklistRules = options.blacklist && options.blacklist.rule;\n  if (blacklistRules) {\n    const ruleMatches = Array.isArray(blacklistRules)\n      ? blacklistRules\n      : [blacklistRules];\n    blacklisted = ruleMatches.some(\n      (ruleMatch) => ruleString.indexOf(ruleMatch) !== -1\n    );\n  }\n\n  return whitelisted !== false && blacklisted !== true;\n}\n\nexport function mergeMatches(matchedCSSArray: CSSSniffRoot[]): CSSSniffRoot {\n  // Via https://stackoverflow.com/a/34749873\n  const isObject = (item: any): boolean => {\n    return item && typeof item === \"object\" && !Array.isArray(item);\n  };\n\n  // @ts-ignore\n  type NestedObject = Record<string, NestedObject>;\n\n  const mergeDeep = (\n    target: NestedObject,\n    ...sources: NestedObject[]\n  ): NestedObject => {\n    if (!sources.length) return target;\n    const source = sources.shift();\n\n    if (isObject(target) && isObject(source)) {\n      for (const key in source) {\n        if (isObject(source[key])) {\n          if (!target[key]) {\n            target[key] = {};\n          }\n          const matchedCSS = target[key];\n          if (!matchedCSS) {\n            throw Error(\"Expected to be able to create key\");\n          }\n          mergeDeep(matchedCSS, source[key]);\n        } else {\n          Object.assign(target, { [key]: source[key] });\n        }\n      }\n    }\n    return mergeDeep(target, ...sources);\n  };\n  return mergeDeep({}, ...matchedCSSArray);\n}\n\nexport function serializeCSSMatches(matchedCSS: CSSSniffRoot): string {\n  let css = \"\";\n\n  Object.keys(matchedCSS).forEach((sheetIndex: string) => {\n    const sheet = matchedCSS[sheetIndex];\n\n    Object.keys(sheet).forEach((ruleIndex: string) => {\n      const rule = sheet[ruleIndex];\n      if (rule.type === \"CSSSniffStyleRule\") {\n        css += rule.selectors.join(\",\");\n        css += \"{\";\n        css += rule.properties;\n        css += \"}\";\n      } else if (rule.type === \"CSSSniffMediaRule\") {\n        css += rule.before;\n        css += \"{\";\n        Object.keys(rule.children).forEach((childRuleIndex: string) => {\n          const childRule = rule.children[childRuleIndex];\n          if (childRule.type === \"CSSSniffStyleRule\") {\n            css += childRule.selectors.join(\",\");\n            css += \"{\";\n            css += childRule.properties;\n            css += \"}\";\n          } else {\n            throw Error(\"Can't serialize invalid CSS structure\");\n          }\n        });\n        css += \"}\";\n      }\n    });\n  });\n\n  return css;\n}\n\nexport function serializeCSSMatchesAsProperties(\n  matchedCSS: CSSSniffRoot\n): string {\n  return Object.values(matchedCSS)\n    .map((sheet): string => {\n      return Object.values(sheet)\n        .map((rule): string => {\n          if (rule.type === \"CSSSniffStyleRule\") {\n            return rule.properties;\n          } else if (rule.type === \"CSSSniffMediaRule\") {\n            return `${rule.before}{${Object.values(rule.children)\n              .map((childRule): string => {\n                if (childRule.type === \"CSSSniffStyleRule\") {\n                  return childRule.properties;\n                }\n                throw Error(\"Invalid structure\");\n              })\n              .join(\"\")}}`;\n          }\n          throw Error(`Unknown type.`);\n        })\n        .join(\"\");\n    })\n    .join(\";\")\n    .trim();\n}\n\nexport function cssRootDiff(a: CSSSniffRoot, b: CSSSniffRoot): CSSSniffRoot {\n  const diff: CSSSniffRoot = {};\n\n  Object.keys(b).forEach((bSheetIndex) => {\n    const bSheet = b[bSheetIndex];\n    Object.keys(bSheet).forEach((bRuleIndex) => {\n      const bRule = bSheet[bRuleIndex];\n      let diffStyleSheet: CSSSniffStyleSheet = diff[bSheetIndex] || {};\n      if (bRule.type === \"CSSSniffStyleRule\") {\n        if (!a[bSheetIndex] || !a[bSheetIndex][bRuleIndex]) {\n          diffStyleSheet[bRuleIndex] = bRule;\n          diff[bSheetIndex] = diffStyleSheet;\n        }\n      } else if (bRule.type === \"CSSSniffMediaRule\") {\n        const diffRule = diff[bSheetIndex] && diff[bSheetIndex][bRuleIndex];\n        if (diffRule && diffRule.type !== \"CSSSniffMediaRule\") {\n          throw Error(`Cannot change type of diff`);\n        }\n        const aRule = a[bSheetIndex] && a[bSheetIndex][bRuleIndex];\n        if (aRule && aRule.type !== \"CSSSniffMediaRule\") {\n          throw Error(`Cannot change type of (a)`);\n        }\n        const diffChildren = diffRule.children || {};\n        Object.keys(bRule.children).forEach((bRuleChildIndex) => {\n          if (!aRule || !aRule.children[bRuleChildIndex]) {\n            diffChildren[bRuleChildIndex] = bRule.children[bRuleChildIndex];\n          }\n        });\n        if (Object.keys(diffChildren).length > 0) {\n          diffStyleSheet[bRuleIndex] = {\n            ...bRule,\n            children: diffChildren,\n          };\n          diff[bSheetIndex] = diffStyleSheet;\n        }\n      }\n    });\n  });\n\n  return diff;\n}\n\nexport function splitSelectors(selectors: string): string[] {\n  /*\n    split-css-selector by Joakim Carlstein (C) 2015 for\n    function 'splitSelectors'. Licenced under MIT\n  */\n  function isAtRule(selector: string): boolean {\n    return selector.indexOf(\"@\") === 0;\n  }\n\n  if (isAtRule(selectors)) {\n    return [selectors];\n  }\n\n  var splitted = [];\n  var parens = 0;\n  var angulars = 0;\n  var soFar = \"\";\n  for (var i = 0, len = selectors.length; i < len; i++) {\n    var char = selectors[i];\n    if (char === \"(\") {\n      parens += 1;\n    } else if (char === \")\") {\n      parens -= 1;\n    } else if (char === \"[\") {\n      angulars += 1;\n    } else if (char === \"]\") {\n      angulars -= 1;\n    } else if (char === \",\") {\n      if (!parens && !angulars) {\n        splitted.push(soFar.trim());\n        soFar = \"\";\n        continue;\n      }\n    }\n    soFar += char;\n  }\n  splitted.push(soFar.trim());\n  return splitted;\n}\n\nconst unique = `css-sniff-placeholder`;\n","import { Log } from \"../log\";\nimport {\n  MetaHTMLIfSuccessInternal,\n  MetaHTMLIfFailureInternal,\n} from \"./metaComponent\";\nimport { parseExpression } from \"@babel/parser\";\nimport generate from \"@babel/generator\";\n\ntype Props = {\n  htmlElement: HTMLElement;\n  log: Log;\n};\n\nexport const parseMetaHTMLIf = ({\n  htmlElement,\n  log,\n}: Props):\n  | Omit<MetaHTMLIfSuccessInternal, \"children\">\n  | Omit<MetaHTMLIfFailureInternal, \"children\"> => {\n  const optional = !!htmlElement.hasAttribute(\"optional\");\n  const test =\n    htmlElement.getAttribute(\"test\") || htmlElement.getAttribute(\"key\"); // 'key' is legacy from MetaComponent v1\n  if (!test) {\n    log(\n      `Expected to find 'test' (or 'key' for legacy support) attribute on mt-if`\n    );\n  }\n\n  try {\n    let testAsJavaScriptExpression = \"\";\n    let ids: string[] = [];\n    if (test) {\n      const AST = parseExpression(test);\n      ids = findIdentifiers(AST);\n      testAsJavaScriptExpression = generate(AST).code;\n    }\n    return {\n      type: \"If\",\n      ids,\n      testAsJavaScriptExpression,\n      optional,\n      parseError: false,\n    };\n  } catch (e) {\n    log(`JS Expression:\\n\\t${test}\\n`, e);\n    return { type: \"If\", optional, parseError: true, error: e.toString() };\n  }\n};\n\nfunction findIdentifiers(AST: ReturnType<typeof parseExpression>): string[] {\n  const ids: string[] = [];\n\n  const walk = (node: any) => {\n    if (node.type === \"Identifier\" && node.name) {\n      ids.push(node.name);\n    } else if (node.identifierName) {\n      ids.push(node.identifierName);\n    }\n    // Object.keys(node).forEach((name) => walk(node[name]));\n  };\n  // @ts-ignore\n  Object.keys(AST).forEach((name) => walk(AST[name]));\n\n  return ids;\n}\n","import { MetaNodeInternal } from \"./metaComponent\";\nimport { Log } from \"../log\";\nimport { MetaAttributeVariableOptions } from \"./parseMetaHTMLAttribute\";\n\ntype PropTypeAttributeValue = {\n  type: \"PropTypeAttributeValue\";\n  required: boolean;\n  nodeName: string;\n  attributeName: string;\n};\n\ntype PropTypeAttributeValueOptions = {\n  type: \"PropTypeAttributeValueOptions\";\n  required: boolean;\n  nodeName: string;\n  attributeName: string;\n  options: MetaAttributeVariableOptions[\"options\"];\n};\n\ntype PropTypeVariable = {\n  type: \"PropTypeVariable\";\n  required: boolean;\n};\n\n// These are return props not the props given to this function\nexport type Props = Record<\n  string,\n  PropTypeAttributeValue | PropTypeAttributeValueOptions | PropTypeVariable\n>;\n\nexport function getProps(nodes: MetaNodeInternal[], log: Log): Props {\n  const props: Props = {};\n\n  const walk = (node: MetaNodeInternal) => {\n    switch (node.type) {\n      case \"Element\":\n        {\n          const attributeNames = Object.keys(node.attributes);\n          attributeNames.forEach((attributeName) => {\n            const attributeValueParts = node.attributes[attributeName];\n            attributeValueParts.forEach((attributeValuePart) => {\n              if (attributeValuePart.type === \"MetaAttributeVariable\") {\n                if (!attributeValuePart.id) {\n                  log(\n                    `Ignoring empty prop id. ${JSON.stringify(\n                      attributeValuePart\n                    )} from ${JSON.stringify(node)}`\n                  );\n                  return;\n                }\n                if (\n                  props[attributeValuePart.id] &&\n                  props[attributeValuePart.id].type ===\n                    \"PropTypeAttributeValueOptions\"\n                ) {\n                  return; // don't clobber with a less-specific typing than options\n                }\n                props[attributeValuePart.id] = {\n                  type: \"PropTypeAttributeValue\",\n                  required: attributeValuePart.required,\n                  nodeName: node.nodeName,\n                  attributeName,\n                };\n              } else if (\n                attributeValuePart.type === \"MetaAttributeVariableOptions\"\n              ) {\n                if (!attributeValuePart.id) {\n                  log(\n                    `Ignoring empty prop id. ${JSON.stringify(\n                      attributeValuePart\n                    )} from ${JSON.stringify(node)}`\n                  );\n                  return;\n                }\n                props[attributeValuePart.id] = {\n                  type: \"PropTypeAttributeValueOptions\",\n                  required: attributeValuePart.required,\n                  nodeName: node.nodeName,\n                  attributeName,\n                  options: attributeValuePart.options,\n                };\n              }\n            });\n          });\n          node.children.forEach(walk);\n        }\n        break;\n      case \"If\":\n        if (node.parseError === false) {\n          node.ids.forEach((id) => {\n            if (!id) {\n              log(`Ignoring empty prop id from ${JSON.stringify(node)}`);\n              return;\n            }\n            if (props[id]) return; // don't clobber a more specific typing\n\n            props[id] = {\n              type: \"PropTypeVariable\",\n              required: !node.optional,\n            };\n          });\n        }\n        node.children.forEach(walk);\n        break;\n      case \"Variable\": {\n        if (!node.id) {\n          log(`Ignoring empty prop id from ${JSON.stringify(node)}`);\n          break;\n        }\n        if (props[node.id]) return; // don't clobber a more specific typing\n        props[node.id] = {\n          type: \"PropTypeVariable\",\n          required: !node.optional,\n        };\n        node.children.forEach(walk);\n        break;\n      }\n    }\n  };\n\n  nodes.forEach(walk);\n\n  return props;\n}\n","// All credit to https://stackoverflow.com/a/9337047\nexport const validJavaScriptIdentifer = /^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z_a-z\\xaa\\xb5\\xba\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\u02c1\\u02c6-\\u02d1\\u02e0-\\u02e4\\u02ec\\u02ee\\u0370-\\u0374\\u0376\\u0377\\u037a-\\u037d\\u0386\\u0388-\\u038a\\u038c\\u038e-\\u03a1\\u03a3-\\u03f5\\u03f7-\\u0481\\u048a-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05d0-\\u05ea\\u05f0-\\u05f2\\u0620-\\u064a\\u066e\\u066f\\u0671-\\u06d3\\u06d5\\u06e5\\u06e6\\u06ee\\u06ef\\u06fa-\\u06fc\\u06ff\\u0710\\u0712-\\u072f\\u074d-\\u07a5\\u07b1\\u07ca-\\u07ea\\u07f4\\u07f5\\u07fa\\u0800-\\u0815\\u081a\\u0824\\u0828\\u0840-\\u0858\\u08a0\\u08a2-\\u08ac\\u0904-\\u0939\\u093d\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097f\\u0985-\\u098c\\u098f\\u0990\\u0993-\\u09a8\\u09aa-\\u09b0\\u09b2\\u09b6-\\u09b9\\u09bd\\u09ce\\u09dc\\u09dd\\u09df-\\u09e1\\u09f0\\u09f1\\u0a05-\\u0a0a\\u0a0f\\u0a10\\u0a13-\\u0a28\\u0a2a-\\u0a30\\u0a32\\u0a33\\u0a35\\u0a36\\u0a38\\u0a39\\u0a59-\\u0a5c\\u0a5e\\u0a72-\\u0a74\\u0a85-\\u0a8d\\u0a8f-\\u0a91\\u0a93-\\u0aa8\\u0aaa-\\u0ab0\\u0ab2\\u0ab3\\u0ab5-\\u0ab9\\u0abd\\u0ad0\\u0ae0\\u0ae1\\u0b05-\\u0b0c\\u0b0f\\u0b10\\u0b13-\\u0b28\\u0b2a-\\u0b30\\u0b32\\u0b33\\u0b35-\\u0b39\\u0b3d\\u0b5c\\u0b5d\\u0b5f-\\u0b61\\u0b71\\u0b83\\u0b85-\\u0b8a\\u0b8e-\\u0b90\\u0b92-\\u0b95\\u0b99\\u0b9a\\u0b9c\\u0b9e\\u0b9f\\u0ba3\\u0ba4\\u0ba8-\\u0baa\\u0bae-\\u0bb9\\u0bd0\\u0c05-\\u0c0c\\u0c0e-\\u0c10\\u0c12-\\u0c28\\u0c2a-\\u0c33\\u0c35-\\u0c39\\u0c3d\\u0c58\\u0c59\\u0c60\\u0c61\\u0c85-\\u0c8c\\u0c8e-\\u0c90\\u0c92-\\u0ca8\\u0caa-\\u0cb3\\u0cb5-\\u0cb9\\u0cbd\\u0cde\\u0ce0\\u0ce1\\u0cf1\\u0cf2\\u0d05-\\u0d0c\\u0d0e-\\u0d10\\u0d12-\\u0d3a\\u0d3d\\u0d4e\\u0d60\\u0d61\\u0d7a-\\u0d7f\\u0d85-\\u0d96\\u0d9a-\\u0db1\\u0db3-\\u0dbb\\u0dbd\\u0dc0-\\u0dc6\\u0e01-\\u0e30\\u0e32\\u0e33\\u0e40-\\u0e46\\u0e81\\u0e82\\u0e84\\u0e87\\u0e88\\u0e8a\\u0e8d\\u0e94-\\u0e97\\u0e99-\\u0e9f\\u0ea1-\\u0ea3\\u0ea5\\u0ea7\\u0eaa\\u0eab\\u0ead-\\u0eb0\\u0eb2\\u0eb3\\u0ebd\\u0ec0-\\u0ec4\\u0ec6\\u0edc-\\u0edf\\u0f00\\u0f40-\\u0f47\\u0f49-\\u0f6c\\u0f88-\\u0f8c\\u1000-\\u102a\\u103f\\u1050-\\u1055\\u105a-\\u105d\\u1061\\u1065\\u1066\\u106e-\\u1070\\u1075-\\u1081\\u108e\\u10a0-\\u10c5\\u10c7\\u10cd\\u10d0-\\u10fa\\u10fc-\\u1248\\u124a-\\u124d\\u1250-\\u1256\\u1258\\u125a-\\u125d\\u1260-\\u1288\\u128a-\\u128d\\u1290-\\u12b0\\u12b2-\\u12b5\\u12b8-\\u12be\\u12c0\\u12c2-\\u12c5\\u12c8-\\u12d6\\u12d8-\\u1310\\u1312-\\u1315\\u1318-\\u135a\\u1380-\\u138f\\u13a0-\\u13f4\\u1401-\\u166c\\u166f-\\u167f\\u1681-\\u169a\\u16a0-\\u16ea\\u16ee-\\u16f0\\u1700-\\u170c\\u170e-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176c\\u176e-\\u1770\\u1780-\\u17b3\\u17d7\\u17dc\\u1820-\\u1877\\u1880-\\u18a8\\u18aa\\u18b0-\\u18f5\\u1900-\\u191c\\u1950-\\u196d\\u1970-\\u1974\\u1980-\\u19ab\\u19c1-\\u19c7\\u1a00-\\u1a16\\u1a20-\\u1a54\\u1aa7\\u1b05-\\u1b33\\u1b45-\\u1b4b\\u1b83-\\u1ba0\\u1bae\\u1baf\\u1bba-\\u1be5\\u1c00-\\u1c23\\u1c4d-\\u1c4f\\u1c5a-\\u1c7d\\u1ce9-\\u1cec\\u1cee-\\u1cf1\\u1cf5\\u1cf6\\u1d00-\\u1dbf\\u1e00-\\u1f15\\u1f18-\\u1f1d\\u1f20-\\u1f45\\u1f48-\\u1f4d\\u1f50-\\u1f57\\u1f59\\u1f5b\\u1f5d\\u1f5f-\\u1f7d\\u1f80-\\u1fb4\\u1fb6-\\u1fbc\\u1fbe\\u1fc2-\\u1fc4\\u1fc6-\\u1fcc\\u1fd0-\\u1fd3\\u1fd6-\\u1fdb\\u1fe0-\\u1fec\\u1ff2-\\u1ff4\\u1ff6-\\u1ffc\\u2071\\u207f\\u2090-\\u209c\\u2102\\u2107\\u210a-\\u2113\\u2115\\u2119-\\u211d\\u2124\\u2126\\u2128\\u212a-\\u212d\\u212f-\\u2139\\u213c-\\u213f\\u2145-\\u2149\\u214e\\u2160-\\u2188\\u2c00-\\u2c2e\\u2c30-\\u2c5e\\u2c60-\\u2ce4\\u2ceb-\\u2cee\\u2cf2\\u2cf3\\u2d00-\\u2d25\\u2d27\\u2d2d\\u2d30-\\u2d67\\u2d6f\\u2d80-\\u2d96\\u2da0-\\u2da6\\u2da8-\\u2dae\\u2db0-\\u2db6\\u2db8-\\u2dbe\\u2dc0-\\u2dc6\\u2dc8-\\u2dce\\u2dd0-\\u2dd6\\u2dd8-\\u2dde\\u2e2f\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303c\\u3041-\\u3096\\u309d-\\u309f\\u30a1-\\u30fa\\u30fc-\\u30ff\\u3105-\\u312d\\u3131-\\u318e\\u31a0-\\u31ba\\u31f0-\\u31ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\ua000-\\ua48c\\ua4d0-\\ua4fd\\ua500-\\ua60c\\ua610-\\ua61f\\ua62a\\ua62b\\ua640-\\ua66e\\ua67f-\\ua697\\ua6a0-\\ua6ef\\ua717-\\ua71f\\ua722-\\ua788\\ua78b-\\ua78e\\ua790-\\ua793\\ua7a0-\\ua7aa\\ua7f8-\\ua801\\ua803-\\ua805\\ua807-\\ua80a\\ua80c-\\ua822\\ua840-\\ua873\\ua882-\\ua8b3\\ua8f2-\\ua8f7\\ua8fb\\ua90a-\\ua925\\ua930-\\ua946\\ua960-\\ua97c\\ua984-\\ua9b2\\ua9cf\\uaa00-\\uaa28\\uaa40-\\uaa42\\uaa44-\\uaa4b\\uaa60-\\uaa76\\uaa7a\\uaa80-\\uaaaf\\uaab1\\uaab5\\uaab6\\uaab9-\\uaabd\\uaac0\\uaac2\\uaadb-\\uaadd\\uaae0-\\uaaea\\uaaf2-\\uaaf4\\uab01-\\uab06\\uab09-\\uab0e\\uab11-\\uab16\\uab20-\\uab26\\uab28-\\uab2e\\uabc0-\\uabe2\\uac00-\\ud7a3\\ud7b0-\\ud7c6\\ud7cb-\\ud7fb\\uf900-\\ufa6d\\ufa70-\\ufad9\\ufb00-\\ufb06\\ufb13-\\ufb17\\ufb1d\\ufb1f-\\ufb28\\ufb2a-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40\\ufb41\\ufb43\\ufb44\\ufb46-\\ufbb1\\ufbd3-\\ufd3d\\ufd50-\\ufd8f\\ufd92-\\ufdc7\\ufdf0-\\ufdfb\\ufe70-\\ufe74\\ufe76-\\ufefc\\uff21-\\uff3a\\uff41-\\uff5a\\uff66-\\uffbe\\uffc2-\\uffc7\\uffca-\\uffcf\\uffd2-\\uffd7\\uffda-\\uffdc][$A-Z_a-z\\xaa\\xb5\\xba\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\u02c1\\u02c6-\\u02d1\\u02e0-\\u02e4\\u02ec\\u02ee\\u0370-\\u0374\\u0376\\u0377\\u037a-\\u037d\\u0386\\u0388-\\u038a\\u038c\\u038e-\\u03a1\\u03a3-\\u03f5\\u03f7-\\u0481\\u048a-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05d0-\\u05ea\\u05f0-\\u05f2\\u0620-\\u064a\\u066e\\u066f\\u0671-\\u06d3\\u06d5\\u06e5\\u06e6\\u06ee\\u06ef\\u06fa-\\u06fc\\u06ff\\u0710\\u0712-\\u072f\\u074d-\\u07a5\\u07b1\\u07ca-\\u07ea\\u07f4\\u07f5\\u07fa\\u0800-\\u0815\\u081a\\u0824\\u0828\\u0840-\\u0858\\u08a0\\u08a2-\\u08ac\\u0904-\\u0939\\u093d\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097f\\u0985-\\u098c\\u098f\\u0990\\u0993-\\u09a8\\u09aa-\\u09b0\\u09b2\\u09b6-\\u09b9\\u09bd\\u09ce\\u09dc\\u09dd\\u09df-\\u09e1\\u09f0\\u09f1\\u0a05-\\u0a0a\\u0a0f\\u0a10\\u0a13-\\u0a28\\u0a2a-\\u0a30\\u0a32\\u0a33\\u0a35\\u0a36\\u0a38\\u0a39\\u0a59-\\u0a5c\\u0a5e\\u0a72-\\u0a74\\u0a85-\\u0a8d\\u0a8f-\\u0a91\\u0a93-\\u0aa8\\u0aaa-\\u0ab0\\u0ab2\\u0ab3\\u0ab5-\\u0ab9\\u0abd\\u0ad0\\u0ae0\\u0ae1\\u0b05-\\u0b0c\\u0b0f\\u0b10\\u0b13-\\u0b28\\u0b2a-\\u0b30\\u0b32\\u0b33\\u0b35-\\u0b39\\u0b3d\\u0b5c\\u0b5d\\u0b5f-\\u0b61\\u0b71\\u0b83\\u0b85-\\u0b8a\\u0b8e-\\u0b90\\u0b92-\\u0b95\\u0b99\\u0b9a\\u0b9c\\u0b9e\\u0b9f\\u0ba3\\u0ba4\\u0ba8-\\u0baa\\u0bae-\\u0bb9\\u0bd0\\u0c05-\\u0c0c\\u0c0e-\\u0c10\\u0c12-\\u0c28\\u0c2a-\\u0c33\\u0c35-\\u0c39\\u0c3d\\u0c58\\u0c59\\u0c60\\u0c61\\u0c85-\\u0c8c\\u0c8e-\\u0c90\\u0c92-\\u0ca8\\u0caa-\\u0cb3\\u0cb5-\\u0cb9\\u0cbd\\u0cde\\u0ce0\\u0ce1\\u0cf1\\u0cf2\\u0d05-\\u0d0c\\u0d0e-\\u0d10\\u0d12-\\u0d3a\\u0d3d\\u0d4e\\u0d60\\u0d61\\u0d7a-\\u0d7f\\u0d85-\\u0d96\\u0d9a-\\u0db1\\u0db3-\\u0dbb\\u0dbd\\u0dc0-\\u0dc6\\u0e01-\\u0e30\\u0e32\\u0e33\\u0e40-\\u0e46\\u0e81\\u0e82\\u0e84\\u0e87\\u0e88\\u0e8a\\u0e8d\\u0e94-\\u0e97\\u0e99-\\u0e9f\\u0ea1-\\u0ea3\\u0ea5\\u0ea7\\u0eaa\\u0eab\\u0ead-\\u0eb0\\u0eb2\\u0eb3\\u0ebd\\u0ec0-\\u0ec4\\u0ec6\\u0edc-\\u0edf\\u0f00\\u0f40-\\u0f47\\u0f49-\\u0f6c\\u0f88-\\u0f8c\\u1000-\\u102a\\u103f\\u1050-\\u1055\\u105a-\\u105d\\u1061\\u1065\\u1066\\u106e-\\u1070\\u1075-\\u1081\\u108e\\u10a0-\\u10c5\\u10c7\\u10cd\\u10d0-\\u10fa\\u10fc-\\u1248\\u124a-\\u124d\\u1250-\\u1256\\u1258\\u125a-\\u125d\\u1260-\\u1288\\u128a-\\u128d\\u1290-\\u12b0\\u12b2-\\u12b5\\u12b8-\\u12be\\u12c0\\u12c2-\\u12c5\\u12c8-\\u12d6\\u12d8-\\u1310\\u1312-\\u1315\\u1318-\\u135a\\u1380-\\u138f\\u13a0-\\u13f4\\u1401-\\u166c\\u166f-\\u167f\\u1681-\\u169a\\u16a0-\\u16ea\\u16ee-\\u16f0\\u1700-\\u170c\\u170e-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176c\\u176e-\\u1770\\u1780-\\u17b3\\u17d7\\u17dc\\u1820-\\u1877\\u1880-\\u18a8\\u18aa\\u18b0-\\u18f5\\u1900-\\u191c\\u1950-\\u196d\\u1970-\\u1974\\u1980-\\u19ab\\u19c1-\\u19c7\\u1a00-\\u1a16\\u1a20-\\u1a54\\u1aa7\\u1b05-\\u1b33\\u1b45-\\u1b4b\\u1b83-\\u1ba0\\u1bae\\u1baf\\u1bba-\\u1be5\\u1c00-\\u1c23\\u1c4d-\\u1c4f\\u1c5a-\\u1c7d\\u1ce9-\\u1cec\\u1cee-\\u1cf1\\u1cf5\\u1cf6\\u1d00-\\u1dbf\\u1e00-\\u1f15\\u1f18-\\u1f1d\\u1f20-\\u1f45\\u1f48-\\u1f4d\\u1f50-\\u1f57\\u1f59\\u1f5b\\u1f5d\\u1f5f-\\u1f7d\\u1f80-\\u1fb4\\u1fb6-\\u1fbc\\u1fbe\\u1fc2-\\u1fc4\\u1fc6-\\u1fcc\\u1fd0-\\u1fd3\\u1fd6-\\u1fdb\\u1fe0-\\u1fec\\u1ff2-\\u1ff4\\u1ff6-\\u1ffc\\u2071\\u207f\\u2090-\\u209c\\u2102\\u2107\\u210a-\\u2113\\u2115\\u2119-\\u211d\\u2124\\u2126\\u2128\\u212a-\\u212d\\u212f-\\u2139\\u213c-\\u213f\\u2145-\\u2149\\u214e\\u2160-\\u2188\\u2c00-\\u2c2e\\u2c30-\\u2c5e\\u2c60-\\u2ce4\\u2ceb-\\u2cee\\u2cf2\\u2cf3\\u2d00-\\u2d25\\u2d27\\u2d2d\\u2d30-\\u2d67\\u2d6f\\u2d80-\\u2d96\\u2da0-\\u2da6\\u2da8-\\u2dae\\u2db0-\\u2db6\\u2db8-\\u2dbe\\u2dc0-\\u2dc6\\u2dc8-\\u2dce\\u2dd0-\\u2dd6\\u2dd8-\\u2dde\\u2e2f\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303c\\u3041-\\u3096\\u309d-\\u309f\\u30a1-\\u30fa\\u30fc-\\u30ff\\u3105-\\u312d\\u3131-\\u318e\\u31a0-\\u31ba\\u31f0-\\u31ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\ua000-\\ua48c\\ua4d0-\\ua4fd\\ua500-\\ua60c\\ua610-\\ua61f\\ua62a\\ua62b\\ua640-\\ua66e\\ua67f-\\ua697\\ua6a0-\\ua6ef\\ua717-\\ua71f\\ua722-\\ua788\\ua78b-\\ua78e\\ua790-\\ua793\\ua7a0-\\ua7aa\\ua7f8-\\ua801\\ua803-\\ua805\\ua807-\\ua80a\\ua80c-\\ua822\\ua840-\\ua873\\ua882-\\ua8b3\\ua8f2-\\ua8f7\\ua8fb\\ua90a-\\ua925\\ua930-\\ua946\\ua960-\\ua97c\\ua984-\\ua9b2\\ua9cf\\uaa00-\\uaa28\\uaa40-\\uaa42\\uaa44-\\uaa4b\\uaa60-\\uaa76\\uaa7a\\uaa80-\\uaaaf\\uaab1\\uaab5\\uaab6\\uaab9-\\uaabd\\uaac0\\uaac2\\uaadb-\\uaadd\\uaae0-\\uaaea\\uaaf2-\\uaaf4\\uab01-\\uab06\\uab09-\\uab0e\\uab11-\\uab16\\uab20-\\uab26\\uab28-\\uab2e\\uabc0-\\uabe2\\uac00-\\ud7a3\\ud7b0-\\ud7c6\\ud7cb-\\ud7fb\\uf900-\\ufa6d\\ufa70-\\ufad9\\ufb00-\\ufb06\\ufb13-\\ufb17\\ufb1d\\ufb1f-\\ufb28\\ufb2a-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40\\ufb41\\ufb43\\ufb44\\ufb46-\\ufbb1\\ufbd3-\\ufd3d\\ufd50-\\ufd8f\\ufd92-\\ufdc7\\ufdf0-\\ufdfb\\ufe70-\\ufe74\\ufe76-\\ufefc\\uff21-\\uff3a\\uff41-\\uff5a\\uff66-\\uffbe\\uffc2-\\uffc7\\uffca-\\uffcf\\uffd2-\\uffd7\\uffda-\\uffdc0-9\\u0300-\\u036f\\u0483-\\u0487\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u064b-\\u0669\\u0670\\u06d6-\\u06dc\\u06df-\\u06e4\\u06e7\\u06e8\\u06ea-\\u06ed\\u06f0-\\u06f9\\u0711\\u0730-\\u074a\\u07a6-\\u07b0\\u07c0-\\u07c9\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0859-\\u085b\\u08e4-\\u08fe\\u0900-\\u0903\\u093a-\\u093c\\u093e-\\u094f\\u0951-\\u0957\\u0962\\u0963\\u0966-\\u096f\\u0981-\\u0983\\u09bc\\u09be-\\u09c4\\u09c7\\u09c8\\u09cb-\\u09cd\\u09d7\\u09e2\\u09e3\\u09e6-\\u09ef\\u0a01-\\u0a03\\u0a3c\\u0a3e-\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a66-\\u0a71\\u0a75\\u0a81-\\u0a83\\u0abc\\u0abe-\\u0ac5\\u0ac7-\\u0ac9\\u0acb-\\u0acd\\u0ae2\\u0ae3\\u0ae6-\\u0aef\\u0b01-\\u0b03\\u0b3c\\u0b3e-\\u0b44\\u0b47\\u0b48\\u0b4b-\\u0b4d\\u0b56\\u0b57\\u0b62\\u0b63\\u0b66-\\u0b6f\\u0b82\\u0bbe-\\u0bc2\\u0bc6-\\u0bc8\\u0bca-\\u0bcd\\u0bd7\\u0be6-\\u0bef\\u0c01-\\u0c03\\u0c3e-\\u0c44\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62\\u0c63\\u0c66-\\u0c6f\\u0c82\\u0c83\\u0cbc\\u0cbe-\\u0cc4\\u0cc6-\\u0cc8\\u0cca-\\u0ccd\\u0cd5\\u0cd6\\u0ce2\\u0ce3\\u0ce6-\\u0cef\\u0d02\\u0d03\\u0d3e-\\u0d44\\u0d46-\\u0d48\\u0d4a-\\u0d4d\\u0d57\\u0d62\\u0d63\\u0d66-\\u0d6f\\u0d82\\u0d83\\u0dca\\u0dcf-\\u0dd4\\u0dd6\\u0dd8-\\u0ddf\\u0df2\\u0df3\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0e50-\\u0e59\\u0eb1\\u0eb4-\\u0eb9\\u0ebb\\u0ebc\\u0ec8-\\u0ecd\\u0ed0-\\u0ed9\\u0f18\\u0f19\\u0f20-\\u0f29\\u0f35\\u0f37\\u0f39\\u0f3e\\u0f3f\\u0f71-\\u0f84\\u0f86\\u0f87\\u0f8d-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u102b-\\u103e\\u1040-\\u1049\\u1056-\\u1059\\u105e-\\u1060\\u1062-\\u1064\\u1067-\\u106d\\u1071-\\u1074\\u1082-\\u108d\\u108f-\\u109d\\u135d-\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17b4-\\u17d3\\u17dd\\u17e0-\\u17e9\\u180b-\\u180d\\u1810-\\u1819\\u18a9\\u1920-\\u192b\\u1930-\\u193b\\u1946-\\u194f\\u19b0-\\u19c0\\u19c8\\u19c9\\u19d0-\\u19d9\\u1a17-\\u1a1b\\u1a55-\\u1a5e\\u1a60-\\u1a7c\\u1a7f-\\u1a89\\u1a90-\\u1a99\\u1b00-\\u1b04\\u1b34-\\u1b44\\u1b50-\\u1b59\\u1b6b-\\u1b73\\u1b80-\\u1b82\\u1ba1-\\u1bad\\u1bb0-\\u1bb9\\u1be6-\\u1bf3\\u1c24-\\u1c37\\u1c40-\\u1c49\\u1c50-\\u1c59\\u1cd0-\\u1cd2\\u1cd4-\\u1ce8\\u1ced\\u1cf2-\\u1cf4\\u1dc0-\\u1de6\\u1dfc-\\u1dff\\u200c\\u200d\\u203f\\u2040\\u2054\\u20d0-\\u20dc\\u20e1\\u20e5-\\u20f0\\u2cef-\\u2cf1\\u2d7f\\u2de0-\\u2dff\\u302a-\\u302f\\u3099\\u309a\\ua620-\\ua629\\ua66f\\ua674-\\ua67d\\ua69f\\ua6f0\\ua6f1\\ua802\\ua806\\ua80b\\ua823-\\ua827\\ua880\\ua881\\ua8b4-\\ua8c4\\ua8d0-\\ua8d9\\ua8e0-\\ua8f1\\ua900-\\ua909\\ua926-\\ua92d\\ua947-\\ua953\\ua980-\\ua983\\ua9b3-\\ua9c0\\ua9d0-\\ua9d9\\uaa29-\\uaa36\\uaa43\\uaa4c\\uaa4d\\uaa50-\\uaa59\\uaa7b\\uaab0\\uaab2-\\uaab4\\uaab7\\uaab8\\uaabe\\uaabf\\uaac1\\uaaeb-\\uaaef\\uaaf5\\uaaf6\\uabe3-\\uabea\\uabec\\uabed\\uabf0-\\uabf9\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe26\\ufe33\\ufe34\\ufe4d-\\ufe4f\\uff10-\\uff19\\uff3f]*$/;\n\nexport function assertUnreachable(x?: never): never {\n  throw new Error(\"Didn't expect to get here\");\n}\n","import { parseHTMLWithoutInsertionMode } from \"./parseMetaHTML\";\nimport {\n  parseAttributeValue,\n  MetaAttributeValue,\n  MetaAttributeValues,\n  MetaAttributeValuesInternal,\n} from \"./parseMetaHTMLAttribute\";\nimport { parseMetaVariable } from \"./parseMetaVariable\";\nimport {\n  cssSniff,\n  serializeCSSMatches,\n  serializeCSSMatchesAsProperties,\n  cssRootDiff,\n  CSSSniffRoot,\n} from \"../cssSniff/cssSniff\";\nimport { parseMetaHTMLIf } from \"./parseMetaHTMLIf\";\nimport { getProps, Props } from \"./getProps\";\nimport { Log } from \"../log\";\nimport { assertUnreachable } from \"../makeTemplates/utils\";\n\ntype ParseMetaComponentStringProps = {\n  domDocument: Document;\n  metaHTMLString: string;\n  cssString: string;\n  log: Log;\n};\n\nexport function parseMetaComponentString({\n  domDocument,\n  metaHTMLString,\n  cssString,\n  log,\n}: ParseMetaComponentStringProps): MetaComponent {\n  parseHTMLWithoutInsertionMode({\n    domDocument,\n    metaHTMLString,\n    cssString,\n    log,\n  });\n  // now we have a DOM representing the original MetaHTMLString, so we need to build a MetaHTML\n  const bodyNodes = Array.from(domDocument.body.childNodes);\n  const nodes = bodyNodes.map((node) => nodeToMetaNode({ node, log }));\n  const metaComponent = {\n    cssString: getAllMatchingCSSRulesRecursively(nodes),\n    props: getProps(nodes, log),\n    nodes: internalToPublic(nodes),\n  };\n  return metaComponent;\n}\n\nexport type MetaComponent = {\n  cssString: string;\n  nodes: MetaNode[];\n  props: Props;\n};\n\nexport type MetaNode =\n  | MetaHTMLElement\n  | MetaHTMLText\n  | MetaHTMLComment\n  | MetaHTMLVariable\n  | MetaHTMLIf;\n\nexport type MetaNodeInternal =\n  | MetaHTMLElementInternal\n  | MetaHTMLText\n  | MetaHTMLComment\n  | MetaHTMLVariableInternal\n  | MetaHTMLIfInternal;\n\nexport type MetaHTMLElement = {\n  type: \"Element\";\n  nodeName: string;\n  attributes: Record<string, MetaAttributeValues>;\n  children: MetaNode[];\n  cssProperties: MetaCSSPropertiesNode[];\n};\n\nexport type MetaHTMLElementInternal = Omit<\n  MetaHTMLElement,\n  \"children\" | \"attributes\"\n> & {\n  children: MetaNodeInternal[];\n  attributes: Record<string, MetaAttributeValuesInternal>;\n  node: HTMLElement;\n};\n\nexport type MetaCSSPropertiesNode =\n  | MetaCSSPropertiesConditionalNode\n  | MetaCSSPropertiesConstantNode;\n\nexport type MetaCSSPropertiesConstantNode = {\n  type: \"MetaCSSPropertiesConstantNode\";\n  cssPropertiesString: string;\n};\n\nexport type MetaCSSPropertiesConditionalNode = {\n  type: \"MetaCSSPropertiesConditionalNode\";\n  id: string;\n  condition: {\n    [equalsString: string]: string; // cssProperties as string\n  };\n};\n\nexport type MetaHTMLText = { type: \"Text\"; value: string };\n\nexport type MetaHTMLComment = { type: \"Comment\"; value: string };\n\nexport type MetaHTMLVariable = {\n  type: \"Variable\";\n  id: string;\n  children: MetaNode[];\n};\n\nexport type MetaHTMLVariableInternal = {\n  type: \"Variable\";\n  id: string;\n  optional: boolean;\n  children: MetaNodeInternal[];\n};\n\ntype MetaHTMLIfBase = {\n  type: \"If\";\n  children: MetaNode[];\n};\n\nexport type MetaHTMLIfSuccess = MetaHTMLIfBase & {\n  parseError: false;\n  ids: string[];\n  testAsJavaScriptExpression: string; // a string of codegen'd JS that can be used directly.\n  // Other languages should be added. PRs welcome.\n};\n\nexport type MetaHTMLIfFailure = MetaHTMLIfBase & {\n  parseError: true;\n  error: string;\n};\n\nexport type MetaHTMLIf = MetaHTMLIfSuccess | MetaHTMLIfFailure;\n\nexport type MetaHTMLIfSuccessInternal = Omit<MetaHTMLIfSuccess, \"children\"> & {\n  children: MetaNodeInternal[];\n  optional: boolean;\n};\n\nexport type MetaHTMLIfFailureInternal = Omit<MetaHTMLIfFailure, \"children\"> & {\n  children: MetaNodeInternal[];\n  optional: boolean;\n};\n\nexport type MetaHTMLIfInternal =\n  | MetaHTMLIfSuccessInternal\n  | MetaHTMLIfFailureInternal;\n\ntype NodeToMetaNodeProps = {\n  node: ChildNode;\n  log: Log;\n};\n\nfunction nodeToMetaNode({ node, log }: NodeToMetaNodeProps): MetaNodeInternal {\n  if (node.nodeType === Node.TEXT_NODE) {\n    return { type: \"Text\", value: node.textContent || \"\" };\n  } else if (node.nodeType === Node.COMMENT_NODE) {\n    return { type: \"Comment\", value: node.textContent || \"\" };\n  } else if (node.nodeType !== Node.ELEMENT_NODE) {\n    throw Error(`Unhandled nodeType ${node.nodeType}`);\n  }\n\n  // @ts-ignore\n  const htmlElement: HTMLElement = node;\n  const names = Array.from(htmlElement.getAttributeNames());\n  const nodeName = htmlElement.nodeName.toLowerCase();\n\n  if (nodeName === \"mt-variable\") {\n    return {\n      ...parseMetaVariable({\n        htmlElement,\n        log,\n      }),\n      children: Array.from(node.childNodes).map((childNode) =>\n        nodeToMetaNode({ node: childNode, log })\n      ),\n    };\n  } else if (nodeName === \"mt-if\") {\n    return {\n      ...parseMetaHTMLIf({ htmlElement, log }),\n      children: Array.from(node.childNodes).map((childNode) =>\n        nodeToMetaNode({ node: childNode, log })\n      ),\n    };\n  }\n\n  const attributes = names.reduce(\n    (attributes: MetaHTMLElementInternal[\"attributes\"], name: string) => {\n      const attributeValue = htmlElement.getAttribute(name);\n      if (attributeValue === null) throw Error(`Expected attribute value.`);\n      attributes[name] = parseAttributeValue(attributeValue, log);\n      return attributes;\n    },\n    {} as MetaHTMLElementInternal[\"attributes\"]\n  );\n\n  const cssProperties = getAllMatchingCSSProperties(htmlElement, attributes);\n\n  return {\n    type: \"Element\",\n    nodeName,\n    attributes: attributes,\n    node: htmlElement,\n    children: Array.from(node.childNodes).map((node) =>\n      nodeToMetaNode({ node, log })\n    ),\n    cssProperties,\n  };\n}\n\nfunction getAllMatchingCSSProperties(\n  element: HTMLElement,\n  attributes: MetaHTMLElement[\"attributes\"]\n): MetaCSSPropertiesNode[] {\n  const cssProperties: MetaCSSPropertiesNode[] = [];\n\n  resetElementAttributes(element, attributes);\n\n  const resetMatchedCSS = cssSniff([element], { ignoreChildren: true });\n\n  const cssPropertiesStringConstants = serializeCSSMatchesAsProperties(\n    resetMatchedCSS\n  );\n\n  if (cssPropertiesStringConstants) {\n    cssProperties.push({\n      type: \"MetaCSSPropertiesConstantNode\",\n      cssPropertiesString: cssPropertiesStringConstants,\n    });\n  }\n\n  Object.keys(attributes)\n    .filter(attributesThatCanBeSet)\n    .forEach((attributeName: string) => {\n      const resetValue = element.getAttribute(attributeName);\n      const attributeValues = attributes[attributeName];\n      attributeValues.forEach((attributeValue) => {\n        if (attributeValue.type === \"MetaAttributeVariableOptions\") {\n          const conditionalNode: MetaCSSPropertiesConditionalNode = {\n            type: \"MetaCSSPropertiesConditionalNode\",\n            id: attributeValue.id,\n            condition: {},\n          };\n          Object.entries(attributeValue.options).forEach(\n            ([optionName, optionValue]) => {\n              element.setAttribute(\n                attributeName,\n                `${resetValue ? `${resetValue} ` : \"\"}${optionValue}`\n              );\n              const matchedCSS = cssSniff([element], { ignoreChildren: true });\n              const cssRoot = cssRootDiff(resetMatchedCSS, matchedCSS);\n              const cssPropertiesString = serializeCSSMatchesAsProperties(\n                cssRoot\n              );\n              if (cssPropertiesString) {\n                conditionalNode.condition[optionName] = cssPropertiesString;\n              }\n              if (resetValue) {\n                element.setAttribute(attributeName, resetValue);\n              }\n            }\n          );\n          if (Object.keys(conditionalNode.condition).length > 0) {\n            cssProperties.push(conditionalNode);\n          }\n        }\n      });\n    });\n\n  return cssProperties;\n}\n\nfunction resetElementAttributes(\n  element: HTMLElement,\n  attributes: MetaHTMLElement[\"attributes\"]\n): void {\n  Object.keys(attributes)\n    .filter(attributesThatCanBeSet)\n    .forEach((name: string) => {\n      const attribute = attributes[name];\n      element.setAttribute(\n        name,\n        attribute\n          .map((metaAttribute) => {\n            if (metaAttribute.type === \"MetaAttributeConstant\") {\n              return ` ${metaAttribute.value}`;\n            }\n            // We can't predict what MetaAttributeVariable might be\n            return \"\";\n          })\n          .join(\" \")\n      );\n    });\n}\n\nfunction internalToPublic(nodes: MetaNodeInternal[]): MetaNode[] {\n  // discards the Node variable which shouldn't be exposed to consumers\n  function walk(node: MetaNodeInternal): MetaNode {\n    switch (node.type) {\n      case \"Comment\":\n      case \"Text\":\n        return node;\n      case \"Variable\":\n        return {\n          type: node.type,\n          id: node.id,\n          children: node.children.map(walk),\n        };\n      case \"If\":\n        if (node.parseError) {\n          return {\n            type: node.type,\n            parseError: node.parseError,\n            children: node.children,\n            error: node.error,\n          };\n        } else {\n          return {\n            type: node.type,\n            parseError: node.parseError,\n            ids: node.ids,\n            children: node.children,\n            testAsJavaScriptExpression: node.testAsJavaScriptExpression,\n          };\n        }\n      case \"Element\":\n        return {\n          type: node.type,\n          nodeName: node.nodeName,\n          attributes: walkAttributes(node.attributes),\n          cssProperties: node.cssProperties,\n          children: node.children.map(walk),\n        };\n      default:\n        throw Error(`Unrecognised node ${node}. ${JSON.stringify(node)}`);\n    }\n  }\n\n  const walkAttributes = (\n    internalAttributes: MetaHTMLElementInternal[\"attributes\"]\n  ): MetaHTMLElement[\"attributes\"] => {\n    const keys = Object.keys(internalAttributes);\n    return keys.reduce(\n      (\n        attributes: MetaHTMLElement[\"attributes\"],\n        key: string\n      ): MetaHTMLElement[\"attributes\"] => {\n        const values = internalAttributes[key];\n        const newAttributeValues = values.map(\n          (value): MetaAttributeValue => {\n            switch (value.type) {\n              case \"MetaAttributeConstant\": {\n                return value;\n              }\n              case \"MetaAttributeVariable\": {\n                return {\n                  type: value.type,\n                  id: value.id,\n                };\n              }\n              case \"MetaAttributeVariableOptions\": {\n                return {\n                  type: value.type,\n                  id: value.id,\n                  options: value.options,\n                };\n              }\n            }\n            return assertUnreachable(value);\n          }\n        );\n        attributes[key] = newAttributeValues;\n        return attributes;\n      },\n      {} as MetaHTMLElement[\"attributes\"]\n    );\n  };\n\n  return nodes.map(walk);\n}\n\nfunction getAllMatchingCSSRulesRecursively(nodes: MetaNodeInternal[]): string {\n  const matchedCSS: CSSSniffRoot = {};\n\n  function getAllMatchingCSSRules(\n    element: HTMLElement,\n    attributes: MetaHTMLElement[\"attributes\"],\n    matchedCSS: CSSSniffRoot\n  ) {\n    // Set ALL classes on element so we can find matching CSS rules.\n    //\n    // The htmlElement.className value looks like a string of,\n    //   \"thing {{ someId: class1 | class2 }} {{ someId: class3 as name1 | class4 as name2 }} \"\n    // so we want to turn that into a string of,\n    //   \"thing class1 class2 class3 class4\"\n    //\n    // In CSS the :not() could mean that adding other classes invalidates rules but MetaComponent\n    // doesn't support that.\n\n    Object.keys(attributes)\n      .filter(attributesThatCanBeSet)\n      .forEach((name: string) => {\n        const newValue = attributes[name]\n          .map((metaAttribute) => {\n            if (metaAttribute.type === \"MetaAttributeConstant\") {\n              return ` ${metaAttribute.value}`;\n            } else if (metaAttribute.type === \"MetaAttributeVariableOptions\") {\n              return ` ${Object.values(metaAttribute.options).join(\" \")}`;\n            }\n            // Else, it's a MetaAttributeVariable.\n            // We can't predict what value MetaAttributeVariable would have so we can't\n            // support detecting CSS based on that\n            return \"\";\n          })\n          .join(\" \");\n\n        element.setAttribute(name, newValue);\n      });\n\n    cssSniff([element], { ignoreChildren: true }, matchedCSS);\n  }\n\n  function walk(node: MetaNodeInternal): void {\n    switch (node.type) {\n      case \"Element\":\n        getAllMatchingCSSRules(node.node, node.attributes, matchedCSS);\n        node.children.forEach(walk);\n        break;\n      case \"If\":\n      case \"Variable\":\n        node.children.forEach(walk);\n        break;\n    }\n  }\n\n  nodes.forEach(walk);\n\n  return serializeCSSMatches(matchedCSS);\n}\n\nfunction attributesThatCanBeSet(attr: string): boolean {\n  // used to filter setting attributes on the real DOM\n  // we don't really care about any other attributes\n  return [\"class\"].includes(attr);\n}\n","import { MetaHTMLVariableInternal } from \"./metaComponent\";\nimport { Log } from \"../log\";\n\ntype Props = {\n  htmlElement: HTMLElement;\n  log: Log;\n};\n\nexport const parseMetaVariable = ({\n  htmlElement,\n  log,\n}: Props): MetaHTMLVariableInternal => {\n  let id = htmlElement.getAttribute(\"id\") || htmlElement.getAttribute(\"key\"); // 'key' is legacy from MetaComponent v1\n  if (!id) {\n    log(\n      `Expected to find 'id' (or 'key' for legacy support) attribute on mt-variable`\n    );\n    return { type: \"Variable\", id: \"\", optional: false, children: [] };\n  }\n  const optional = htmlElement.hasAttribute(\"optional\") || id.includes(\"?\"); // inline '?' is legacy from MetaComponent v1;\n  id = id.replace(/\\?/, \"\");\n  return { type: \"Variable\", id, optional, children: [] };\n};\n","import {\n  MetaHTMLElement,\n  MetaHTMLText,\n  MetaHTMLComment,\n  MetaHTMLIf,\n  MetaHTMLVariable,\n} from \"../metaComponent/metaComponent\";\nimport { TemplateFiles } from \"../types\";\nimport { Props } from \"../metaComponent/getProps\";\n\nexport interface TemplateFormat {\n  dirname: string;\n  templateId: string;\n\n  onElement: (element: MetaHTMLElement) => string;\n  onText: (text: MetaHTMLText) => void;\n  onComment: (text: MetaHTMLComment) => void;\n  onCloseElement: (closeElement: OnCloseElement) => void;\n  onVariable: (onVariable: MetaHTMLVariable) => void;\n  onCloseVariable: (closeVariable: MetaHTMLVariable) => void;\n  onIf: (onIf: MetaHTMLIf) => void;\n  onCloseIf: (onCloseIf: MetaHTMLIf) => void;\n  onFinalise: (args: OnFinalise) => void;\n  serialize: () => TemplateFiles;\n}\n\nexport type OnConstructor = {\n  templateId: string;\n  dirname?: string;\n  props: Props;\n  hasMultipleRootNodes: boolean;\n};\n\ntype OnCloseElement = {\n  openingElement: string;\n};\n\ntype OnFinalise = {\n  css: string;\n};\n\nexport class Template {\n  dirname: string;\n  templateId: string;\n  props: Props;\n  hasMultipleRootNodes: boolean;\n\n  constructor(args: OnConstructor) {\n    const { templateId, dirname, props, hasMultipleRootNodes } = args;\n    this.dirname = dirname || \"\";\n    this.templateId = templateId;\n    this.props = props;\n    this.hasMultipleRootNodes = hasMultipleRootNodes;\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    throw Error(\"Not implemented\");\n  }\n\n  onCloseElement(args: Parameters<TemplateFormat[\"onCloseElement\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onVariable(onVariable: Parameters<TemplateFormat[\"onVariable\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onCloseVariable(\n    onCloseVariable: Parameters<TemplateFormat[\"onCloseVariable\"]>[0]\n  ): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onCloseIf(onCloseIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  onFinalise(onFinalise: Parameters<TemplateFormat[\"onFinalise\"]>[0]): void {\n    throw Error(\"Not implemented\");\n  }\n\n  serialize(): TemplateFiles {\n    throw Error(\"Not implemented\");\n  }\n}\n","import prettier from \"prettier/standalone\";\nimport parserPostCSS from \"prettier/parser-postcss\";\nimport { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\n\nexport class CSSTemplate extends Template {\n  css: string;\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: \"css\" });\n\n    this.css = \"\";\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    return onElement.nodeName;\n  }\n\n  onCloseElement(args: Parameters<TemplateFormat[\"onCloseElement\"]>[0]): void {\n    // pass\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    // pass\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    // pass\n  }\n\n  onVariable(variable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    // pass\n  }\n\n  onCloseVariable(closeVariable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    // pass\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    // pass\n  }\n\n  onCloseIf() {\n    // pass\n  }\n\n  onFinalise(onFinalise: Parameters<TemplateFormat[\"onFinalise\"]>[0]) {\n    const { css } = onFinalise;\n\n    this.css = css;\n    try {\n      this.css = prettier.format(this.css, {\n        parser: \"scss\",\n        printWidth: 80,\n        plugins: [parserPostCSS],\n      });\n    } catch (e) {\n      // pass\n    }\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.css`]: this.css,\n    };\n  }\n}\n","import prettier from \"prettier/standalone\";\nimport parserHTML from \"prettier/parser-html\";\nimport { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\n\nexport class HTMLTemplate extends Template {\n  html: string;\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: \"html\" });\n    this.html = \"\";\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    const { nodeName, attributes } = onElement;\n\n    this.html += `<${nodeName}`;\n    Object.keys(attributes).forEach((name) => {\n      const attributeValues = attributes[name];\n      this.html += ` ${name}=\"${attributeValues\n        .map((attributeValue) => {\n          if (attributeValue.type === \"MetaAttributeConstant\") {\n            return attributeValue.value;\n          } else if (attributeValue.type === \"MetaAttributeVariableOptions\") {\n            const optionKeys = Object.keys(attributeValue.options);\n            if (optionKeys.length > 0) {\n              const firstKey = optionKeys[0];\n              const firstValue = attributeValue.options[firstKey];\n              return firstValue;\n            }\n            return \"\";\n          }\n          return \"\";\n        })\n        .filter((value) => value.length > 0)\n        .join(\"\")}\"`;\n    });\n    this.html += \">\";\n    return nodeName;\n  }\n\n  onCloseElement(\n    onCloseElement: Parameters<TemplateFormat[\"onCloseElement\"]>[0]\n  ) {\n    const { openingElement } = onCloseElement;\n    this.html += `</${openingElement}>`;\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    const { value } = onText;\n    this.html += value;\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    const { value } = onComment;\n    this.html += `<!--${value}-->`;\n  }\n\n  onVariable(variable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    this.html += `<!-- '${variable.id}' goes here -->`;\n  }\n\n  onCloseVariable(closeVariable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    // pass\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    // pass\n  }\n\n  onCloseIf(onIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]) {\n    // pass\n  }\n\n  onFinalise(onFinalise: Parameters<TemplateFormat[\"onFinalise\"]>[0]) {\n    try {\n      this.html = prettier.format(this.html, {\n        parser: \"html\",\n        printWidth: 80,\n        plugins: [parserHTML],\n      });\n    } catch (e) {\n      // pass\n    }\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.html`]: this.html,\n    };\n  }\n}\n\n// Via http://xahlee.info/js/html5_non-closing_tag.html\nexport const SELF_CLOSING_HTML_ELEMENTS = [\n  \"area\",\n  \"base\",\n  \"br\",\n  \"col\",\n  \"embed\",\n  \"hr\",\n  \"img\",\n  \"input\",\n  \"link\",\n  \"meta\",\n  \"param\",\n  \"source\",\n  \"track\",\n  \"wbr\",\n];\n","import capitalize from \"lodash/capitalize\";\n\nconst transform: Record<string, string> = {\n  class: \"className\",\n  for: \"htmlFor\",\n  autocomplete: \"autoComplete\",\n  \"fill-rule\": \"fillRule\",\n  readonly: \"readOnly\",\n  autofocus: \"autoFocus\",\n  srcset: \"srcSet\",\n  crossorigin: \"crossOrigin\",\n  spellcheck: \"spellCheck\",\n  tabindex: \"tabIndex\",\n  maxlength: \"maxLength\",\n  // TODO: expand this list... presumably there's an NPM package with these mappings?\n};\n\nexport function attributeNameTransform(attributeName: string): string {\n  // React uses JavaScript names not HTML names which can be different\n  // such as className=\"\" vs class=\"\" and htmlFor=\"\" vs for=\"\" and so on\n  // so we need to convert them...\n  return transform[attributeName] ? transform[attributeName] : attributeName;\n}\n\nexport function getTypeScriptElementName(tagName: string): string {\n  switch (tagName) {\n    case \"p\":\n    case \"h1\":\n    case \"h2\":\n    case \"h3\":\n    case \"h4\":\n    case \"h5\":\n    case \"h6\":\n      return \"\";\n    case \"a\": {\n      return \"Anchor\";\n    }\n    case \"img\": {\n      return \"Image\";\n    }\n    case \"textarea\": {\n      return \"TextArea\";\n    }\n    default: {\n      return capitalize(tagName);\n    }\n  }\n}\n","import prettier from \"prettier/standalone\";\nimport parserTypeScript from \"prettier/parser-typescript\";\nimport { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\nimport { attributeNameTransform, getTypeScriptElementName } from \"./React.util\";\nimport {\n  MetaAttributeValues,\n  MetaAttributeValue,\n} from \"../../metaComponent/parseMetaHTMLAttribute\";\nimport { validJavaScriptIdentifer } from \"../utils\";\n\nexport class ReactTemplate extends Template {\n  imports: string;\n  render: string;\n  typeScript: string;\n  constants: string;\n  fileData: string;\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: args.dirname || \"react\" });\n\n    this.imports = \"\";\n    this.render = \"\";\n    this.typeScript = \"\";\n    this.fileData = \"\";\n    this.constants = \"\";\n\n    this.setTypeScript = this.setTypeScript.bind(this);\n    this.renderPropType = this.renderPropType.bind(this);\n\n    this.setImports();\n    this.setTypeScript();\n    this.renderRenderFunction();\n  }\n\n  setImports() {\n    this.imports += `import React from 'react';\\n`;\n  }\n\n  setTypeScript() {\n    const props = Object.keys(this.props).map(this.renderPropType).join(\"\\n  \");\n    this.typeScript = `type Props = {\\n  ${props}\\n};`;\n  }\n\n  renderPropType(propId: string): string {\n    const prop = this.props[propId];\n    let propString = \"\";\n\n    propString += validJavaScriptIdentifer.test(propId)\n      ? propId\n      : `\"${propId}\"`;\n\n    if (!prop.required) {\n      propString += \"?\";\n    }\n\n    propString += \": \";\n\n    switch (prop.type) {\n      case \"PropTypeVariable\": {\n        propString += \"React.ReactNode;\";\n        break;\n      }\n      case \"PropTypeAttributeValue\": {\n        propString += `React.${getTypeScriptElementName(\n          prop.nodeName\n        )}HTMLAttributes<HTML${getTypeScriptElementName(\n          prop.nodeName\n        )}Element>[\"${attributeNameTransform(prop.attributeName)}\"];`;\n        break;\n      }\n      case \"PropTypeAttributeValueOptions\": {\n        propString += `${Object.keys(prop.options)\n          .map((key) => {\n            return validJavaScriptIdentifer.test(key) ? `\"${key}\"` : `\"${key}\"`;\n          })\n          .join(\" | \")};`;\n      }\n    }\n\n    return propString;\n  }\n\n  renderRenderFunction() {\n    const propIds = Object.keys(this.props);\n    const containsInvalidIdentifiers = propIds.some(\n      (propId) => !validJavaScriptIdentifer.test(propId)\n    );\n    if (containsInvalidIdentifiers) {\n      this.render += `export default function ${this.templateId}(props: Props){\\n`;\n      const destructure = propIds\n        .filter((key) => validJavaScriptIdentifer.test(key))\n        .join(\", \");\n      if (destructure) {\n        this.render += `  const { ${destructure} } = props;\\n`;\n      }\n    } else {\n      this.render += `export default function ${\n        this.templateId\n      }({ ${propIds.join(\", \")} }: Props){\\n`;\n    }\n    this.render += `  return (\\n`;\n    if (this.hasMultipleRootNodes) {\n      this.render += `<React.Fragment>`;\n    }\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    const { nodeName, attributes } = onElement;\n    this.render += `<${nodeName}`;\n    Object.keys(attributes).forEach((attributeName) => {\n      this.renderAttribute(attributeName, attributes[attributeName]);\n    });\n    if (onElement.children.length === 0) {\n      this.render += \"/\";\n    }\n    this.render += \">\";\n    return nodeName;\n  }\n\n  renderAttribute(\n    attributeName: string,\n    attributeValues: MetaAttributeValues\n  ): void {\n    // TODO: escape attribute values and keys\n    const reactAttributeName = attributeNameTransform(attributeName);\n    this.render += ` ${reactAttributeName}=`;\n    const containsExpression = attributeValues.some(\n      (attributeValue) => attributeValue.type !== \"MetaAttributeConstant\"\n    );\n    const containsConstant = attributeValues.some(\n      (attributeValue) => attributeValue.type === \"MetaAttributeConstant\"\n    );\n\n    if (containsExpression) {\n      this.render += \"{\";\n    } else {\n      this.render += '\"';\n    }\n\n    if (containsExpression && containsConstant) {\n      this.render += \"`\";\n    }\n\n    attributeValues.forEach((attributeValue) => {\n      if (containsConstant && attributeValue.type !== \"MetaAttributeConstant\") {\n        this.render += \"${\";\n      }\n      this.renderAttributeValue(attributeValue);\n      if (containsConstant && attributeValue.type !== \"MetaAttributeConstant\") {\n        this.render += \" || ''}\";\n      }\n    });\n\n    if (containsExpression && containsConstant) {\n      this.render += \"`\";\n    }\n\n    if (containsExpression) {\n      this.render += \"}\";\n    } else {\n      this.render += '\"';\n    }\n  }\n\n  renderAttributeValue(attributeValue: MetaAttributeValue) {\n    switch (attributeValue.type) {\n      case \"MetaAttributeConstant\": {\n        this.render += attributeValue.value;\n        break;\n      }\n      case \"MetaAttributeVariable\": {\n        this.render += validJavaScriptIdentifer.test(attributeValue.id)\n          ? attributeValue.id\n          : `props[\"${attributeValue.id}\"]`;\n        break;\n      }\n      case \"MetaAttributeVariableOptions\": {\n        const identifier = validJavaScriptIdentifer.test(attributeValue.id)\n          ? attributeValue.id\n          : `props[\"${attributeValue.id}\"]`;\n\n        if (!this.props[attributeValue.id].required) {\n          this.render += `${identifier} && `;\n        }\n        this.render += JSON.stringify(attributeValue.options);\n        this.render += `[${identifier}]`;\n      }\n    }\n  }\n\n  onCloseElement(\n    onCloseElement: Parameters<TemplateFormat[\"onCloseElement\"]>[0]\n  ): void {\n    const { openingElement } = onCloseElement;\n    this.render += `\\n</${openingElement}>\\n`;\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    const { value } = onText;\n    this.render += value;\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    const { value } = onComment;\n    this.render += `{/*${value}*/}`;\n  }\n\n  onVariable(variable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    const identifier = validJavaScriptIdentifer.test(variable.id)\n      ? variable.id\n      : `props[\"${variable.id}\"]`;\n    this.render += `{${identifier} !== undefined ? ${identifier} : `;\n    if (variable.children.length === 0) {\n      this.render += `null`;\n    } else if (variable.children.length === 1) {\n      if (variable.children[0].type === \"Text\") {\n        this.render += `\\``;\n      } else {\n        this.render += `(<React.Fragment>`;\n      }\n    } else {\n      this.render += `(<React.Fragment>`;\n    }\n  }\n\n  onCloseVariable(variable: Parameters<TemplateFormat[\"onCloseVariable\"]>[0]) {\n    if (\n      variable.children.length === 1 &&\n      variable.children[0].type === \"Text\"\n    ) {\n      this.render += `\\``;\n    } else if (variable.children.length > 0) {\n      this.render += `</React.Fragment>)`;\n    }\n    this.render += `}`;\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    if (onIf.parseError === false) {\n      this.render += `{${onIf.testAsJavaScriptExpression} && (<React.Fragment>`;\n    } else {\n      this.render += `{false && (<React.Fragment>`;\n    }\n  }\n\n  onCloseIf(onCloseIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]) {\n    this.render += `</React.Fragment>)}`;\n  }\n\n  onFinalise(onSerialize: Parameters<TemplateFormat[\"onFinalise\"]>[0]) {\n    if (this.hasMultipleRootNodes) {\n      this.render += `</React.Fragment>`;\n    }\n\n    this.fileData = `${this.imports}\\n${this.typeScript}\\n\\n${this.constants}\\n\\n${this.render}\\n  )\\n};\\n`;\n\n    try {\n      this.fileData = prettier.format(this.fileData, {\n        parser: \"typescript\",\n        printWidth: 80,\n        plugins: [parserTypeScript],\n      });\n    } catch (e) {\n      // pass\n    }\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.tsx`]: this.fileData,\n    };\n  }\n}\n","import uniq from \"lodash/uniq\";\nimport { ReactTemplate } from \"../React/React\";\nimport { TemplateFormat, OnConstructor } from \"../Template\";\nimport { MetaCSSPropertiesNode } from \"../../metaComponent/metaComponent\";\nimport { validJavaScriptIdentifer } from \"../utils\";\n\nexport class ReactStyledComponentsTemplate extends ReactTemplate {\n  styledConstants: string[];\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: \"react-styled-components\" });\n\n    this.imports += `import styled from 'styled-components';\\n`;\n\n    this.styledConstants = [];\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    let counter = 1;\n    let styledName = onElement.nodeName;\n    if (onElement.cssProperties.length) {\n      do {\n        styledName = `Styled${onElement.nodeName\n          .substring(0, 1)\n          .toUpperCase()}${onElement.nodeName.substring(1)}${\n          counter === 1 ? \"\" : `_${counter}`\n        }`;\n        counter++;\n      } while (this.styledConstants.includes(styledName));\n      this.styledConstants.push(styledName);\n\n      const pickedProps = this.renderCSSPropertyProps(onElement.cssProperties);\n      const styledProps = `${styledName}Props`;\n\n      if (pickedProps) {\n        this.constants += `type ${styledProps} = ${pickedProps};\\n`;\n      }\n      this.constants += `const ${styledName} = styled.${onElement.nodeName}${\n        pickedProps ? `<${styledProps}>` : \"\"\n      }\\`\\n  ${onElement.cssProperties\n        .map((cssProperty) => this.renderCSSProperty(cssProperty, styledProps))\n        .join(\"\\n  \")}\\n\\`;\\n\\n`;\n    }\n    const styledAttributes = {\n      ...onElement.attributes,\n    };\n    delete styledAttributes[\"class\"];\n    onElement.cssProperties.forEach((cssProperty) => {\n      if (cssProperty.type === \"MetaCSSPropertiesConstantNode\") return;\n      styledAttributes[cssProperty.id] = [\n        {\n          type: \"MetaAttributeVariable\",\n          id: cssProperty.id,\n        },\n      ];\n    });\n\n    super.onElement({\n      ...onElement,\n      nodeName: styledName,\n      attributes: styledAttributes,\n    });\n\n    return styledName;\n  }\n\n  renderCSSProperty(\n    cssPropertiesNode: MetaCSSPropertiesNode,\n    styledProps: string\n  ): string {\n    switch (cssPropertiesNode.type) {\n      case \"MetaCSSPropertiesConstantNode\": {\n        return cssPropertiesNode.cssPropertiesString;\n      }\n      case \"MetaCSSPropertiesConditionalNode\": {\n        const isValidIdentifier = validJavaScriptIdentifer.test(\n          cssPropertiesNode.id\n        );\n        let conditional = \"${\";\n        const identifier = isValidIdentifier\n          ? cssPropertiesNode.id\n          : `props[\"${cssPropertiesNode.id}\"]`;\n\n        if (isValidIdentifier) {\n          conditional += `({${cssPropertiesNode.id}}: ${styledProps}) => (`;\n        } else {\n          conditional += `(props: ${styledProps}) => (`;\n        }\n\n        conditional += JSON.stringify(cssPropertiesNode.condition);\n        conditional += `[`;\n        conditional += identifier;\n        conditional += `])}`;\n\n        return conditional;\n      }\n    }\n  }\n\n  renderCSSPropertyProps(\n    cssProperties: MetaCSSPropertiesNode[]\n  ): string | undefined {\n    const propUnion = uniq(\n      cssProperties\n        .map((cssProperty): string => {\n          if (cssProperty.type === \"MetaCSSPropertiesConditionalNode\") {\n            return `\"${cssProperty.id}\"`;\n          }\n          return \"\";\n        })\n        .filter((val: string): boolean => !!val)\n    ).join(\" | \");\n\n    if (propUnion.length === 0) return undefined;\n    return `Pick<Props, ${propUnion}>`;\n  }\n}\n","import { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\nimport { MetaAttributeValues } from \"../../metaComponent/parseMetaHTMLAttribute\";\nimport { assertUnreachable } from \"../utils\";\n\nexport class MustacheTemplate extends Template {\n  data: string;\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: \"mustache\" });\n    this.data = \"\";\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    const { nodeName, attributes } = onElement;\n\n    this.data += `<${nodeName}`;\n    Object.keys(attributes).forEach((name) => {\n      const attributeValues = attributes[name];\n      this.data += this.renderAttribute(name, attributeValues);\n    });\n    this.data += \">\";\n    return nodeName;\n  }\n\n  renderAttribute(name: string, attributeValues: MetaAttributeValues): string {\n    let attr = \" \";\n\n    const isOmittedIfEmpty =\n      attributeValues.length === 1 &&\n      [\"MetaAttributeVariable\"].includes(attributeValues[0].type);\n\n    if (isOmittedIfEmpty) {\n      const attributeVariable = attributeValues[0];\n      if (attributeVariable.type !== \"MetaAttributeVariable\") {\n        throw Error(`Internal error`);\n      }\n      attr += `{{#${attributeVariable.id}}}`;\n    }\n\n    attr += name;\n\n    if (attributeValues) {\n      attr += '=\"';\n      attr += attributeValues\n        .map((attributeValue): string => {\n          switch (attributeValue.type) {\n            case \"MetaAttributeConstant\": {\n              return attributeValue.value;\n            }\n            case \"MetaAttributeVariable\": {\n              return `{{${attributeValue.id}}}`;\n            }\n            case \"MetaAttributeVariableOptions\": {\n              // Because Mustache is \"logic-less\" we can't have\n              // if (x === 1) { result1 } else if (x === 2) { result2 } endif;\n              // we can only have truthy results, so we instead we use the fact\n              // that the \"=\" character is a valid part of a variable name and\n              // we make variables for each possible enumeration. So when\n              // comparing a variable of \"x\" for a value of \"1\" we instead check\n              // for a variable named \"x=1\" literally. So now the code looks like,\n              // if (x=1) { result1 } endif; if(x=2) { result2 } endif;\n              return Object.entries(attributeValue.options)\n                .map(([optionName, optionValue]) => {\n                  return `{{${attributeValue.id}=${optionName}}}${optionValue}{{/${attributeValue.id}=${optionName}}}`;\n                })\n                .join(\"\");\n            }\n          }\n          return assertUnreachable();\n        })\n        .join(\"\")\n        .trim();\n\n      attr += '\"';\n    }\n\n    if (isOmittedIfEmpty) {\n      const attributeVariable = attributeValues[0];\n      if (attributeVariable.type !== \"MetaAttributeVariable\") {\n        throw Error(`Internal error`);\n      }\n      attr += `{{/${attributeVariable.id}}}`;\n    }\n\n    return attr;\n  }\n\n  onCloseElement(args: Parameters<TemplateFormat[\"onCloseElement\"]>[0]): void {\n    this.data += `</${args.openingElement}>`;\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    this.data += onText.value;\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    this.data += `{{! ${onComment.value} }}`;\n  }\n\n  onVariable(variable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    // pass\n    this.data += `{{${variable.id}}}`;\n    if (variable.children.length > 0) {\n      this.data += `{{^${variable.id}}}`;\n    }\n  }\n\n  onCloseVariable(closeVariable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    if (closeVariable.children.length > 0) {\n      this.data += `{{/${closeVariable.id}}}`;\n    }\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    if (onIf.parseError === false) {\n      this.data += `{{#${this.renderIf(onIf.testAsJavaScriptExpression)}}}`;\n    }\n  }\n\n  renderIf(expression: string): string {\n    return expression.replace(/[\\s\"']/gi, \"\").replace(/[=]+/g, \"=\");\n  }\n\n  onCloseIf(onCloseIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]) {\n    if (onCloseIf.parseError === false) {\n      this.data += `{{/${this.renderIf(\n        onCloseIf.testAsJavaScriptExpression\n      )}}}`;\n    }\n  }\n\n  onFinalise(onSerialize: Parameters<TemplateFormat[\"onFinalise\"]>[0]) {\n    // pass\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.mustache`]: this.data,\n    };\n  }\n}\n\n//   mustacheWarning(): string {\n//     return `{{! DEVELOPER NOTE: This Mustache template uses triple-bracket \"{{{\"\\n    which disables HTML escaping.\\n    Please ensure these variables are properly escaped BEFORE rendering the template:\\n     - ${this.unescapedKeys.join(\n//       \",\\n     - \"\n//     )}.\\n    The reason for this is to allow raw HTML, for values such as (eg) '<span lang=\"mi\">Mori</span>'. }}\\n\\n`;\n//   };\n","import startCase from \"lodash/startCase\";\nimport prettier from \"prettier/standalone\";\nimport parserAngular from \"prettier/parser-angular\";\nimport { Template, TemplateFormat, OnConstructor } from \"../Template\";\nimport { TemplateFiles } from \"../../types\";\nimport {\n  MetaAttributeValues,\n  MetaAttributeValue,\n} from \"../../metaComponent/parseMetaHTMLAttribute\";\nimport { validJavaScriptIdentifer } from \"../utils\";\n\ntype ComputedProp = {\n  identifiers: string[];\n  expression: string;\n  responseType: \"string\" | \"boolean\";\n};\n\nexport class VueTemplate extends Template {\n  template: string;\n  script: string;\n  style: string;\n\n  imports: string;\n  typeScript: string;\n  computed: Record<string, ComputedProp>;\n\n  finalData: string;\n\n  constructor(args: OnConstructor) {\n    super({ ...args, dirname: args.dirname || \"vue\" });\n\n    this.template = \"\";\n    this.script = \"\";\n    this.style = \"\";\n\n    this.imports = \"\";\n    this.typeScript = \"\";\n    this.computed = {};\n\n    this.finalData = \"\";\n\n    this.setTypeScript = this.setTypeScript.bind(this);\n    this.renderPropType = this.renderPropType.bind(this);\n    this.setImports = this.setImports.bind(this);\n    this.renderAttribute = this.renderAttribute.bind(this);\n    this.getNewComputedName = this.getNewComputedName.bind(this);\n\n    this.setTypeScript();\n    this.setImports();\n  }\n\n  setTypeScript() {\n    const props = Object.keys(this.props).map(this.renderPropType).join(\"\\n  \");\n    this.typeScript = `type Props = {\\n  ${props}\\n};`;\n  }\n\n  setImports() {\n    this.imports += `import Vue from \"vue\";'\\n`;\n  }\n\n  renderPropType(propId: string): string {\n    const prop = this.props[propId];\n    let propString = \"\";\n\n    propString += validJavaScriptIdentifer.test(propId)\n      ? propId\n      : `\"${propId}\"`;\n\n    if (!prop.required) {\n      propString += \"?\";\n    }\n\n    propString += \": \";\n\n    switch (prop.type) {\n      case \"PropTypeVariable\": {\n        propString += \"any;\";\n        break;\n      }\n      case \"PropTypeAttributeValue\": {\n        propString += `any;`;\n        break;\n      }\n      case \"PropTypeAttributeValueOptions\": {\n        propString += `${Object.keys(prop.options)\n          .map((key) => {\n            return validJavaScriptIdentifer.test(key) ? `\"${key}\"` : `\"${key}\"`;\n          })\n          .join(\" | \")};`;\n      }\n    }\n\n    return propString;\n  }\n\n  renderRenderFunction() {\n    const propIds = Object.keys(this.props);\n    const containsInvalidIdentifiers = propIds.some(\n      (propId) => !validJavaScriptIdentifer.test(propId)\n    );\n    if (containsInvalidIdentifiers) {\n      this.template += `export default function ${this.templateId}(props: Props){\\n`;\n      const destructure = propIds\n        .filter((key) => validJavaScriptIdentifer.test(key))\n        .join(\", \");\n      if (destructure) {\n        this.template += `  const { ${destructure} } = props;\\n`;\n      }\n    } else {\n      this.template += `export default function ${\n        this.templateId\n      }({ ${propIds.join(\", \")} }: Props){\\n`;\n    }\n    this.template += `  return (\\n`;\n  }\n\n  onElement(\n    onElement: Parameters<TemplateFormat[\"onElement\"]>[0]\n  ): ReturnType<TemplateFormat[\"onElement\"]>[0] {\n    const { nodeName, attributes } = onElement;\n    this.template += `<${nodeName}`;\n    this.template += Object.keys(attributes)\n      .map((attributeName): string =>\n        this.renderAttribute(attributeName, attributes[attributeName])\n      )\n      .join(\" \");\n    if (onElement.children.length === 0) {\n      this.template += \"/\";\n    }\n    this.template += \">\";\n    return nodeName;\n  }\n\n  renderAttribute(\n    attributeName: string,\n    attributeValues: MetaAttributeValues\n  ): string {\n    // TODO: escape attribute values and keys\n\n    const containsOnlyConstants = attributeValues.every(\n      (attributeValue) => attributeValue.type === \"MetaAttributeConstant\"\n    );\n\n    let response = \"\";\n\n    response += ` ${!containsOnlyConstants ? \":\" : \"\"}${attributeName}=\"`;\n\n    if (containsOnlyConstants) {\n      response += attributeValues\n        .map((attributeValue) => {\n          if (attributeValue.type === \"MetaAttributeConstant\") {\n            return attributeValue.value;\n          }\n          throw new Error(\n            \"Internal error. Didn't expect type \" + attributeValue.type\n          );\n        })\n        .join(\"\");\n    } else {\n      const computedName = this.getNewComputedName(attributeName);\n\n      const containsExpression = attributeValues.some(\n        (attributeValue) => attributeValue.type !== \"MetaAttributeConstant\"\n      );\n      const containsConstant = attributeValues.some(\n        (attributeValue) => attributeValue.type === \"MetaAttributeConstant\"\n      );\n\n      const computedProp: ComputedProp = this.computed[computedName] || {\n        identifiers: [],\n        expression: containsExpression && containsConstant ? \"`\" : \"\",\n        responseType: \"string\",\n      };\n\n      this.computed[computedName] = computedProp;\n\n      attributeValues.forEach((attributeValue) => {\n        if (\n          containsConstant &&\n          attributeValue.type !== \"MetaAttributeConstant\"\n        ) {\n          computedProp.expression += \"${\";\n        }\n        const [propExpression, propId] = this.renderAttributeValue(\n          attributeValue\n        );\n        if (propId) {\n          computedProp.identifiers.push(propId);\n        }\n        computedProp.expression += propExpression;\n        if (\n          containsConstant &&\n          attributeValue.type !== \"MetaAttributeConstant\"\n        ) {\n          computedProp.expression += \" || ''}\";\n        }\n      });\n\n      if (containsExpression && containsConstant) {\n        computedProp.expression += \"`\";\n      }\n\n      this.computed[computedName] = computedProp;\n      response += computedName;\n    }\n\n    response += '\"';\n\n    return response;\n  }\n\n  getNewComputedName(name: string): string {\n    let counter = 1;\n    let computedName = \"\";\n    do {\n      computedName = `computed${startCase(name)\n        .replace(/\\s/gi, \"\")\n        .substring(0, 1)\n        .toUpperCase()}${name.substring(1)}${\n        counter === 1 ? \"\" : `${counter}`\n      }`;\n      counter++;\n    } while (this.computed[computedName] !== undefined);\n    return computedName;\n  }\n\n  renderAttributeValue(attributeValue: MetaAttributeValue): [string, string?] {\n    switch (attributeValue.type) {\n      case \"MetaAttributeConstant\": {\n        return [attributeValue.value, undefined];\n      }\n      case \"MetaAttributeVariable\": {\n        return [\n          validJavaScriptIdentifer.test(attributeValue.id)\n            ? attributeValue.id\n            : `props[\"${attributeValue.id}\"]`,\n          attributeValue.id,\n        ];\n      }\n      case \"MetaAttributeVariableOptions\": {\n        const identifier = validJavaScriptIdentifer.test(attributeValue.id)\n          ? attributeValue.id\n          : `props[\"${attributeValue.id}\"]`;\n\n        if (!this.props[attributeValue.id].required) {\n          this.template += `${identifier} && `;\n        }\n        return [\n          `${JSON.stringify(attributeValue.options)}[${identifier}]`,\n          attributeValue.id,\n        ];\n      }\n    }\n  }\n\n  onCloseElement(\n    onCloseElement: Parameters<TemplateFormat[\"onCloseElement\"]>[0]\n  ): void {\n    const { openingElement } = onCloseElement;\n    this.template += `</${openingElement}>`;\n  }\n\n  onText(onText: Parameters<TemplateFormat[\"onText\"]>[0]): void {\n    const { value } = onText;\n    this.template += value;\n  }\n\n  onComment(onComment: Parameters<TemplateFormat[\"onComment\"]>[0]): void {\n    const { value } = onComment;\n    this.template += `<!--${value}-->`;\n  }\n\n  onVariable(variable: Parameters<TemplateFormat[\"onVariable\"]>[0]) {\n    this.template += `<slot name=\"${variable.id}\">`;\n  }\n\n  onCloseVariable(variable: Parameters<TemplateFormat[\"onCloseVariable\"]>[0]) {\n    this.template += `</slot>`;\n  }\n\n  onIf(onIf: Parameters<TemplateFormat[\"onIf\"]>[0]) {\n    if (onIf.parseError === false) {\n      const computedName = this.getNewComputedName(onIf.ids.join(\" \"));\n      this.computed[computedName] = {\n        identifiers: onIf.ids,\n        expression: onIf.testAsJavaScriptExpression,\n        responseType: \"boolean\",\n      };\n      this.template += `<span v-if=\"${computedName}\">`;\n    } else {\n      this.template += `<!-- parse error: ${onIf.error} -->`;\n    }\n  }\n\n  onCloseIf(onCloseIf: Parameters<TemplateFormat[\"onCloseIf\"]>[0]) {\n    this.template += `</span>`;\n  }\n\n  onFinalise(onFinalise: Parameters<TemplateFormat[\"onFinalise\"]>[0]) {\n    const { css } = onFinalise;\n\n    const computedString = Object.keys(this.computed)\n      .map((propName) => {\n        const computedProp = this.computed[propName];\n        const containsInvalidIdentifiers = computedProp.identifiers.some(\n          (identifier) => !validJavaScriptIdentifer.test(identifier)\n        );\n        const spreadProps = computedProp.identifiers\n          .filter((identifier) => validJavaScriptIdentifer.test(identifier))\n          .join(\", \");\n\n        let computeFunction = \"(\";\n        if (containsInvalidIdentifiers) {\n          computeFunction += `props: Props): ${computedProp.responseType} => `;\n          if (spreadProps) {\n            computeFunction += \"{\";\n            computeFunction += `      const { ${spreadProps} } = props;\\n`;\n            computeFunction += `      return `;\n          } else {\n            computeFunction += \"(\";\n          }\n        } else {\n          computeFunction += `{${spreadProps}}: Props): ${computedProp.responseType} => (`;\n        }\n\n        computeFunction += computedProp.expression;\n\n        if (containsInvalidIdentifiers && spreadProps) {\n          computeFunction += \"}\";\n        } else {\n          computeFunction += \")\";\n        }\n\n        return `${propName}: ${computeFunction}`;\n      })\n      .join(\",\\n    \");\n\n    const componentVarName = startCase(this.templateId).replace(/\\s/gi, \"\");\n\n    this.script = `const ${componentVarName} = Vue.extend({\\n`;\n    if (computedString) {\n      this.script += `  computed: {\\n`;\n      this.script += `    ${computedString}\\n`;\n      this.script += `  }\\n`;\n    }\n    this.script += `});\\n`;\n    this.script += `export default ${componentVarName};`;\n\n    this.finalData = `<template functional>\\n<!-- this is prototype code. Vue generation in development. -->\\n${this.template}\\n</template>\\n`;\n    if (css) {\n      this.finalData += `<style scoped>\\n${css}\\n</style>\\n`;\n    }\n    this.finalData += `<script lang=\"ts\">\\n${this.imports}\\n\\n${this.typeScript}\\n\\n${this.script}\\n</script>\\n`;\n\n    try {\n      this.finalData = prettier.format(this.finalData, {\n        parser: \"vue\",\n        printWidth: 80,\n        plugins: [parserAngular], // Vue uses Angular's parser https://prettier.io/blog/2018/11/07/1.15.0.html\n      });\n    } catch (e) {\n      // pass\n    }\n  }\n\n  serialize(): TemplateFiles {\n    return {\n      [`${this.dirname}/${this.templateId}.vue`]: this.finalData,\n    };\n  }\n}\n","import { MetaComponent } from \"../metaComponent/metaComponent\";\nimport { TemplateFiles } from \"../types\";\n\nimport { CSSTemplate } from \"./CSS/CSS\";\nimport { HTMLTemplate } from \"./HTML/HTML\";\nimport { ReactTemplate } from \"./React/React\";\nimport { ReactStyledComponentsTemplate } from \"./ReactStyledComponents/ReactStyledComponents\";\nimport { MustacheTemplate } from \"./Mustache/Mustache\";\nimport { VueTemplate } from \"./Vue/Vue\";\nimport { Template, OnConstructor } from \"./Template\";\n\ntype MakeTemplatesProps = {\n  templateId: string;\n  metaComponent: MetaComponent;\n};\n\nexport function makeTemplates({\n  templateId,\n  metaComponent,\n}: MakeTemplatesProps): TemplateFiles {\n  const args: OnConstructor = {\n    props: metaComponent.props,\n    templateId,\n    hasMultipleRootNodes: metaComponent.nodes.length > 1,\n  };\n  return mergeTemplateFiles(\n    makeTemplate(templateId, metaComponent, new HTMLTemplate(args)),\n    makeTemplate(templateId, metaComponent, new CSSTemplate(args)),\n    makeTemplate(templateId, metaComponent, new ReactTemplate(args)),\n    makeTemplate(\n      templateId,\n      metaComponent,\n      new ReactStyledComponentsTemplate(args)\n    ),\n    makeTemplate(templateId, metaComponent, new MustacheTemplate(args)),\n    makeTemplate(templateId, metaComponent, new VueTemplate(args))\n  );\n}\n\nfunction mergeTemplateFiles(...obj: TemplateFiles[]): TemplateFiles {\n  return Object.assign({}, ...obj);\n}\n\nfunction makeTemplate(\n  templateId: string,\n  metaComponent: MetaComponent,\n  instance: Template\n) {\n  function walk(node: MetaComponent[\"nodes\"][number]) {\n    switch (node.type) {\n      case \"Element\": {\n        const openingElement = instance.onElement(node);\n        if (node.children.length > 0) {\n          node.children.forEach(walk);\n          instance.onCloseElement({ openingElement });\n        }\n        break;\n      }\n      case \"Text\": {\n        instance.onText(node);\n        break;\n      }\n      case \"Comment\": {\n        instance.onComment(node);\n        break;\n      }\n      case \"Variable\": {\n        instance.onVariable(node);\n        node.children.forEach(walk);\n        instance.onCloseVariable(node);\n        break;\n      }\n      case \"If\": {\n        instance.onIf(node);\n        node.children.forEach(walk);\n        instance.onCloseIf(node);\n        break;\n      }\n    }\n  }\n\n  metaComponent.nodes.forEach(walk);\n\n  instance.onFinalise({ css: metaComponent.cssString });\n\n  return instance.serialize();\n}\n","export type Log = (...args: any[]) => void;\n\nexport function logFactory(haltOnErrors: boolean): Log {\n  return (...args) => {\n    if (haltOnErrors) {\n      throw Array.from(args)\n        .map((arg) => arg.toString())\n        .join(\"\\n\");\n    }\n    console.log(...args, \"\");\n  };\n}\n","const LOCAL_STORAGE = \"LOCAL_STORAGE\" as const;\ntype LOCAL_STORAGE_TYPE = typeof LOCAL_STORAGE;\n\n/*\n *  DEVELOPER NOTE\n *\n *  Some browsers can block storage (localStorage, sessionStorage)\n *  access for privacy reasons, and all browsers can have storage\n *  that's full, and so they'll throw exceptions.\n *\n *  These exceptions can happen even with `if (window.localStorage)`!\n *\n *  Also sometimes localStorage/sessionStorage are enabled\n *  AFTER page load on mobiles. This is a browser bug we need to\n *  handle it gracefully.\n *\n *  So,\n *\n *****************************************************************\n *           we need to wrap all usage in try/catch\n *****************************************************************\n *\n *  and,\n *\n ****************************************************************\n *     we need to defer actual usage of these until necessary,\n *    hence using CONSTANTS to indirectly refer to these storages\n *     rather than window.localStorage/window.sessionStorage\n *                         directly\n ****************************************************************\n */\n\nconst storage = (STORAGE_TYPE: LOCAL_STORAGE_TYPE) => ({\n  setItem: (key: string, value: string) => {\n    if (typeof window === \"undefined\") return; // exit early for SSR\n    try {\n      STORAGE_TYPE === LOCAL_STORAGE\n        ? window.localStorage.setItem(key, value)\n        : window.sessionStorage.setItem(key, value);\n    } catch (e) {\n      console.log(e);\n    }\n  },\n  getItem: (key: string) => {\n    if (typeof window === \"undefined\") return; // exit early for SSR\n    try {\n      return STORAGE_TYPE === LOCAL_STORAGE\n        ? window.localStorage.getItem(key)\n        : window.sessionStorage.getItem(key);\n    } catch (e) {\n      console.log(e);\n    }\n  },\n  removeItem: (key: string) => {\n    try {\n      STORAGE_TYPE === LOCAL_STORAGE\n        ? window.localStorage.removeItem(key)\n        : window.sessionStorage.removeItem(key);\n    } catch (e) {\n      console.log(e);\n    }\n  },\n});\n\nexport const localStorageWrapper = storage(LOCAL_STORAGE);\n","import React, {\n  Fragment,\n  useState,\n  useRef,\n  useEffect,\n  useCallback,\n} from \"react\";\nimport marked from \"marked\";\nimport Modal from \"react-modal\";\nimport { generateTemplates, MetaComponents } from \"./lib\";\nimport { localStorageWrapper } from \"./storage\";\nimport peacock from \"./peacock.png\";\nimport AceEditor from \"react-ace\";\n\nimport \"ace-builds/src-noconflict/mode-json\";\nimport \"ace-builds/src-noconflict/mode-html\";\nimport \"ace-builds/src-noconflict/mode-css\";\nimport \"ace-builds/src-noconflict/theme-monokai\";\nimport \"./App.css\";\nimport startCase from \"lodash/startCase\";\n\nconst STORAGE_METAHTML = \"STORAGE_METAHTML\";\nconst STORAGE_CSS = \"STORAGE_CSS\";\nconst STORAGE_RESULT_INDEX = \"STORAGE_RESULT_INDEX\";\n\nconst oneFrameMs = 15;\n\nconst theme = \"monokai\";\n\nconst showEverything = window.document.location?.search.includes(\"?everything\");\n\nconst resultIndexString = localStorageWrapper.getItem(STORAGE_RESULT_INDEX);\nconst resultIndex = resultIndexString\n  ? parseInt(resultIndexString, 10)\n  : showEverything\n  ? 0\n  : 3;\n\nconst defaultValues = {\n  metaHTML:\n    localStorageWrapper.getItem(STORAGE_METAHTML) ||\n    `<h1\\n  class=\"my-style {{ colour: my-style--blue as blue | my-style--red as red }}\"\\n>\\n  <mt-variable id=\"children\"></mt-variable>\\n</h1>`,\n  css:\n    localStorageWrapper.getItem(STORAGE_CSS) ||\n    `.my-style { padding: 5px }\\n.my-style--blue{ color: blue }\\n.my-style--red{ color: red }\\n/* this CSS isn't used and will be tree shaken */\\n.treeShake { color: green; }`,\n  resultIndex: resultIndex,\n};\n\nconst templateId = \"MyComponent\";\n\nconst modalStyles = {\n  overlay: {\n    backgroundColor: \"rgba(0,0,0,0.5)\",\n    zIndex: 10,\n    border: \"none\",\n  },\n  content: {\n    background: \"none\",\n    inset: \"0px\",\n    border: \"none\",\n    top: \"0px\",\n    bottom: \"0px\",\n    right: \"0px\",\n    left: \"0px\",\n  },\n} as const;\nModal.setAppElement(\"#root\");\n\nfunction App() {\n  const [metaHTML, setMetaHTML] = useState<string>(defaultValues.metaHTML);\n  const [css, setCSS] = useState<string>(defaultValues.css);\n  const [metaComponents, setMetaComponents] = useState<MetaComponents>();\n  const [resultIndex, setResultIndex] = useState<number>(\n    defaultValues.resultIndex\n  );\n  const [isWhatOpen, setIsWhatOpen] = useState<boolean>(false);\n  const [isWhyOpen, setIsWhyOpen] = useState<boolean>(false);\n  const debounceTime = useRef<number>(100);\n  const iframeRef = useRef(null);\n\n  const openWhatModal = () => {\n    setIsWhyOpen(false);\n    setIsWhatOpen(true);\n  };\n  const closeWhatModal = () => setIsWhatOpen(false);\n\n  const openWhyModal = () => {\n    setIsWhatOpen(false);\n    setIsWhyOpen(true);\n  };\n  const closeWhyModal = () => setIsWhyOpen(false);\n\n  useEffect(() => {\n    const root: HTMLElement | null = document.querySelector(\"#root\");\n    if (!root) return;\n    if (isWhatOpen || isWhyOpen) {\n      root.classList.add(\"blur\");\n    } else {\n      root.classList.remove(\"blur\");\n    }\n  }, [isWhatOpen, isWhyOpen]);\n\n  const iframeRefCallback = useCallback((node) => {\n    console.log(\"Setting iframe \", node);\n    iframeRef.current = node; // for some reason setting ref={iframeRef} wasn't working in Chrome\n  }, []);\n\n  useEffect(() => {\n    const fn = () => {\n      const iframeEl: HTMLIFrameElement | null = iframeRef.current;\n      if (!iframeEl) {\n        console.log(\"No iframe ref available.\", iframeEl);\n        return;\n      }\n      // @ts-ignore\n      const domDocument = iframeEl.contentWindow?.document;\n      if (!domDocument) {\n        console.log(\"No iframe contentWindow document available.\", domDocument);\n        return;\n      }\n      const documentElement = domDocument.documentElement;\n      if (!documentElement) {\n        console.log(\"No iframe documentElement available.\", documentElement);\n        return;\n      }\n      const startTime = Date.now();\n      const result = generateTemplates({\n        domDocument,\n        templateId,\n        metaHTMLString: metaHTML,\n        cssString: css,\n        haltOnErrors: false,\n      });\n      const endTime = Date.now();\n      let newDebounceTime = endTime - startTime;\n      newDebounceTime =\n        newDebounceTime < oneFrameMs ? oneFrameMs : newDebounceTime;\n      console.info(`Debouncing calling MetaComponent at ${newDebounceTime}ms`);\n      debounceTime.current = newDebounceTime;\n      setMetaComponents(result);\n    };\n    const handler = setTimeout(fn, debounceTime.current);\n    return () => clearTimeout(handler);\n  }, [metaHTML, css]);\n\n  const filePaths = metaComponents ? Object.keys(metaComponents.files) : [];\n\n  const outputValue = metaComponents\n    ? resultIndex === 0\n      ? JSON.stringify(metaComponents, null, 2)\n      : filePaths[resultIndex - 1]\n      ? metaComponents.files[filePaths[resultIndex - 1]]\n      : \"\"\n    : \"\";\n\n  const outputMode =\n    resultIndex === 0\n      ? \"json\"\n      : filePaths[resultIndex - 1]\n      ? aceMode(filePaths[resultIndex - 1])\n      : \"json\";\n\n  const markers = [];\n  if (\n    resultIndex > 0 &&\n    filePaths[resultIndex - 1] &&\n    pathType(filePaths[resultIndex - 1]).includes(\"react\")\n  ) {\n    const templateIdIndex = outputValue.indexOf(templateId);\n    const outputValueBefore = outputValue.substring(0, templateIdIndex);\n    const rowIndex =\n      outputValueBefore.length - outputValueBefore.replace(/\\n/g, \"\").length;\n\n    const startCol = outputValue.split(\"\\n\")[rowIndex].indexOf(templateId);\n\n    markers.push({\n      startRow: rowIndex,\n      startCol,\n      endRow: rowIndex,\n      endCol: startCol + templateId.length - 1,\n      className: \"mt-tooltip\",\n      type: \"text\" as const,\n      inFront: true,\n    });\n  }\n\n  return (\n    <Fragment>\n      <Modal\n        isOpen={isWhatOpen}\n        onRequestClose={closeWhatModal}\n        style={modalStyles}\n        contentLabel=\"What is MetaHTML?\"\n        shouldCloseOnOverlayClick={true}\n      >\n        <div className=\"modal-content\" onClick={closeWhatModal} id=\"what-modal\">\n          <div\n            className=\"modal-content__body\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <button onClick={closeWhatModal} className=\"close_button\">\n              close <span aria-hidden> </span>\n            </button>\n            <div>\n              <h2>MetaHTML?</h2>\n\n              <button\n                onClick={openWhyModal}\n                className=\"modal__link\"\n                aria-label=\"Open modal explaining MetaComponent\"\n                aria-expanded={isWhyOpen}\n                aria-controls=\"why-modal\"\n              >\n                <span className=\"modal__link--peripheral\">(see also:</span> Why\n                MetaComponent?<span className=\"modal__link--peripheral\">)</span>\n              </button>\n              <div dangerouslySetInnerHTML={{ __html: whatIsMetaHTML }}></div>\n            </div>\n\n            <button\n              onClick={openWhyModal}\n              className=\"modal__link\"\n              aria-label=\"Open modal explaining MetaComponent\"\n              aria-expanded={isWhyOpen}\n              aria-controls=\"why-modal\"\n            >\n              <span className=\"modal__link--peripheral\">(see also:</span> Why\n              MetaComponent?<span className=\"modal__link--peripheral\">)</span>\n            </button>\n\n            <button onClick={closeWhatModal} className=\"close_button\">\n              close <span aria-hidden> </span>\n            </button>\n          </div>\n        </div>\n      </Modal>\n      <Modal\n        isOpen={isWhyOpen}\n        onRequestClose={closeWhyModal}\n        style={modalStyles}\n        contentLabel=\"Why is MetaComponent?\"\n        shouldCloseOnOverlayClick={true}\n      >\n        <div className=\"modal-content\" onClick={closeWhatModal} id=\"why-modal\">\n          <div\n            className=\"modal-content__body\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <button onClick={closeWhyModal} className=\"close_button\">\n              close <span aria-hidden> </span>\n            </button>\n            <div dangerouslySetInnerHTML={{ __html: whyIsMetaComponent }}></div>\n\n            <button onClick={closeWhyModal} className=\"close_button\">\n              close <span aria-hidden> </span>\n            </button>\n          </div>\n        </div>\n      </Modal>\n      <div className=\"MetaComponentDemo\">\n        <div id=\"button_tray_container\" className=\"button-tray\">\n          <button\n            onClick={openWhyModal}\n            className=\"button-tray__link\"\n            aria-label=\"Open modal explaining MetaComponent\"\n            aria-expanded={isWhyOpen}\n            aria-controls=\"why-modal\"\n          >\n            Why MetaComponent?\n          </button>\n          <a\n            href=\"https://github.com/springload/metacomponent\"\n            target=\"_blank\"\n            rel=\"noreferrer noopener\"\n            className=\"button-tray__link\"\n            aria-label=\"GitHub Repo\"\n          >\n            Repo\n          </a>\n        </div>\n        <h1 className=\"title_container\">\n          MetaComponent REPL{\" \"}\n          <img src={peacock} alt=\"\" className=\"title_container__peacock\" />\n        </h1>\n\n        <fieldset className=\"html_container\">\n          <legend>\n            MetaHTML\n            <button\n              onClick={openWhatModal}\n              className=\"what-button\"\n              aria-label=\"Why MetaHTML?\"\n              aria-expanded={isWhatOpen}\n              aria-controls=\"what-modal\"\n            >\n              ?\n            </button>\n          </legend>\n          <AceEditor\n            mode=\"html\"\n            theme={theme}\n            onChange={(val) => {\n              setMetaHTML(val);\n              localStorageWrapper.setItem(STORAGE_METAHTML, val);\n            }}\n            name=\"html\"\n            value={metaHTML}\n            width=\"100%\"\n            height=\"100%\"\n            showGutter={false}\n            showPrintMargin={false}\n          />\n        </fieldset>\n\n        <fieldset className=\"css_container\">\n          <legend>Standard CSS</legend>\n          <AceEditor\n            mode=\"css\"\n            theme={theme}\n            onChange={(val) => {\n              setCSS(val);\n              localStorageWrapper.setItem(STORAGE_CSS, val);\n            }}\n            name=\"css\"\n            value={css}\n            width=\"100%\"\n            height=\"100%\"\n            showGutter={false}\n            showPrintMargin={false}\n          />\n        </fieldset>\n\n        <iframe\n          id=\"iframe\"\n          src=\"./iframe.html\"\n          className=\"iframe_container\"\n          title=\"MetaComponent iframe\"\n          ref={iframeRefCallback}\n        ></iframe>\n\n        <fieldset className=\"output_container\">\n          <legend>\n            <span className=\"output_container--label\">Outputs:</span>\n            {showEverything && (\n              <button\n                role=\"tab\"\n                aria-selected={resultIndex === 0}\n                className={`tab ${\n                  resultIndex === 0 ? \"tab--selected\" : undefined\n                }`}\n                aria-controls=\"output\"\n                id=\"tab-0\"\n                onClick={(e) => {\n                  const resultIndex = 0;\n                  setResultIndex(resultIndex);\n                  localStorageWrapper.setItem(\n                    STORAGE_RESULT_INDEX,\n                    resultIndex.toString()\n                  );\n                }}\n              >\n                Everything\n              </button>\n            )}\n            {metaComponents\n              ? Object.keys(metaComponents.files).map((file, fileIndex) => (\n                  <button\n                    key={file}\n                    role=\"tab\"\n                    aria-selected={resultIndex === fileIndex + 1}\n                    className={`tab ${\n                      resultIndex === fileIndex + 1\n                        ? \"tab--selected\"\n                        : undefined\n                    }`}\n                    aria-controls=\"output\"\n                    id={`tab-${fileIndex + 1}`}\n                    onClick={(e) => {\n                      const resultIndex = fileIndex + 1;\n                      setResultIndex(resultIndex);\n                      localStorageWrapper.setItem(\n                        STORAGE_RESULT_INDEX,\n                        resultIndex.toString()\n                      );\n                    }}\n                  >\n                    {formatName(file)}\n                  </button>\n                ))\n              : null}\n          </legend>\n          <Flash\n            text={\n              <>\n                this is uneditable. <br />\n                it's the output from MetaComponent <br />\n                click tabs above to see formats\n              </>\n            }\n          >\n            <AceEditor\n              mode={outputMode}\n              theme={theme}\n              name=\"output\"\n              value={outputValue}\n              readOnly\n              width=\"100%\"\n              height=\"100%\"\n              showPrintMargin={false}\n              showGutter={false}\n              markers={markers}\n            />\n          </Flash>\n        </fieldset>\n      </div>\n    </Fragment>\n  );\n}\n\ntype FlashProps = {\n  text: React.ReactNode;\n  children: React.ReactNode;\n};\n\nfunction Flash({ text, children }: FlashProps) {\n  const timer = useRef<NodeJS.Timeout>();\n  const [animate, setAnimate] = useState(\"off\");\n  const handleKey = (e: React.KeyboardEvent<HTMLDivElement>) => {\n    if (e.key.trim() === \"\") return;\n    setAnimate(\"on\");\n    timer.current = setTimeout(() => {\n      if (timer.current) clearTimeout(timer.current);\n      setAnimate(\"off\");\n    }, 1000);\n  };\n\n  return (\n    <div onKeyPress={handleKey} className=\"flash-container\">\n      <div className={`flash flash--${animate}`}>\n        <span className=\"flash__text\">{text}</span>\n      </div>\n      {children}\n    </div>\n  );\n}\n\nfunction aceMode(file: string) {\n  const dirname = file.substring(0, file.indexOf(\"/\"));\n  if (dirname === \"react\") {\n    return \"javascript\";\n  }\n  return dirname;\n}\n\nfunction pathType(file: string) {\n  return file.substring(0, file.indexOf(\"/\"));\n}\n\nfunction formatName(file: string): string {\n  const dirname = pathType(file).replace(/-/g, \" \");\n  switch (dirname) {\n    case \"html\":\n      return \"HTML\";\n    case \"css\":\n      return \"CSS\";\n    default:\n      return startCase(dirname);\n  }\n}\n\nexport default App;\n\nconst whatIsMetaHTML = marked(`\n\nMetaComponent uses **MetaHTML** and **standard CSS** as inputs to generate components in a variety of formats.\n\nMetaHTML is HTML with markers for the parts that should be configurable, as variables.\n\nThere are two types of variables, for attributes and elements:\n\n- attributes:\n  - \\`<span class=\"{{ someVariable }}\">\\`\n    - \\`?\\` makes it optional \\`{{ someVariable? }}\\`.\n    - multiple variables \\`<span class=\"{{ class }}{{ otherClass }}\">\\`\n  - enumerations like \\`{{ variableName: option1 | option2 }}\\` eg \\`<span class=\"{{ color: class-red | class-blue }}\">\\` and MetaComponent will generate typings to those valid choices. Enumerations may only be strings.\n  - label enumerations with friendly names with \\`as FriendlyName\\` eg  \\`class=\"{{ variableName: box--color-red as Red | box--color-blue as Blue }}\"\\`.\n- elements:\n  - \\`<mt-variable id=\"variableName\"></mt-variable>\\`\n    - The attribute \\`optional\\` makes it optional eg \\`<mt-variable id=\"variableName\" optional></mt-variable>\\`\n    - provide a default value with child nodes eg \\`<mt-variable id=\"variableName\">default value</mt-variable>\\`\n  - Conditional logic \\`<mt-if test=\"isShown\">thing to show if true</mt-if>\\`, or \\`test=\"someVariable === 'frogs' \"\\`, using JavaScript expressions. In the future these expressions will be converted to other languages, so please limit to single variable string comparisons for the greatest range of options.\n\nMetaHTML is for generating stateless components. Logic should be in a higher-order components (HOC).\n\nThere is no support for loops. Use composition instead.\n\n\n`);\n\nconst whyIsMetaComponent = marked(`\n## Why MetaComponent?\n\nMetaComponent can generate stateless components in a variety of languages.\n\nSome of its use-cases involve:\n* migrating to another template format as a one-off conversion;\n* providing templates in multiple formats as an ongoing feature.\n\n### Design Systems / Pattern Libraries\n\nIt's often the case that large organisations and governments, for a variety of reasons, have a large variety of web template technology.\n\nThey use React, Vue, Angular, Handlebars, Jinja2, Twig, and many, many more.\n\nAs a result, websites feel quite different.\n\nTo unify that behaviour and appearance (HTML and CSS) an obvious answer is Design Systems and Pattern Libraries where you'd publish UX advice, and components.\n\nIt would be a lot of manual work to support all of those web frameworks, and so typically HTML/CSS and only one additional component format is supported, and all of them are written by hand.\n\nDesign Systems often solves one problem (standardising HTML/CSS) while creating new technical barriers that may hinder adoption.\n\nIf you consider situations like governments or large organisations with many different technology stacks, it may not be practical to converge template formats, or there might be good reasons for divergence.\n\n**MetaComponent complements Design Systems/Pattern Libraries by generating components for many frameworks to make it easiser to adopt.**\n\n`);\n\n/*\n  <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              viewBox=\"-3 0 97 100\"\n              preserveAspectRatio=\"xMidYMid\"\n              className=\"modal-content__diagram\"\n            >\n              <defs>\n                <marker\n                  id=\"arrowhead\"\n                  markerWidth=\"5\"\n                  markerHeight=\"3\"\n                  refX=\"0\"\n                  refY=\"1.5\"\n                  orient=\"auto\"\n                >\n                  <polygon points=\"0 0, 5 1.5, 0 3\" />\n                </marker>\n              </defs>\n              <rect\n                x=\"0\"\n                y=\"10\"\n                width=\"35\"\n                height=\"9\"\n                stroke=\"#ccc\"\n                strokeWidth=\"0.4\"\n                strokeDasharray=\"1 1\"\n              ></rect>\n              <text x=\"5\" y=\"16\" fontSize=\"5\" fill=\"white\">\n                MetaHTML\n              </text>\n              <text x=\"17\" y=\"23\" fontSize=\"5\" fill=\"white\">\n                +\n              </text>\n              <rect\n                x=\"0\"\n                y=\"24\"\n                width=\"35\"\n                height=\"9\"\n                fill=\"transparent\"\n                strokeWidth=\"0.4\"\n                strokeDasharray=\"1 1\"\n              ></rect>\n              <text x=\"5\" y=\"30.5\" fontSize=\"5\">\n                CSS\n              </text>\n\n              <line\n                x1=\"38\"\n                y1=\"21.5\"\n                x2=\"42\"\n                y2=\"21.5\"\n                strokeWidth=\"1\"\n                markerEnd=\"url(#arrowhead)\"\n              />\n\n              <rect\n                x=\"50\"\n                y=\"10\"\n                width=\"35\"\n                height=\"23\"\n                fill=\"transparent\"\n                strokeWidth=\"0.4\"\n                strokeDasharray=\"1 1\"\n              ></rect>\n              <text x=\"53\" y=\"23\" fontSize=\"5\" fill=\"white\">\n                Components\n              </text>\n            </svg>\n*/\n","// MetaComponent WebTemplateTranslator\nimport {\n  parseMetaComponentString,\n  MetaComponent,\n} from \"./metaComponent/metaComponent\";\nimport { makeTemplates } from \"./makeTemplates/makeTemplates\";\nimport { TemplateFiles } from \"./types\";\nimport { logFactory } from \"./log\";\n\ntype Props = {\n  domDocument: Document;\n  templateId: string;\n  metaHTMLString: string;\n  cssString: string;\n  haltOnErrors: boolean;\n};\n\nexport type MetaComponents = {\n  metaComponent: MetaComponent;\n  files: TemplateFiles;\n};\n\nexport function generateTemplates({\n  domDocument,\n  templateId,\n  metaHTMLString,\n  cssString,\n  haltOnErrors,\n}: Props): MetaComponents {\n  const metaComponent = parseMetaComponentString({\n    domDocument,\n    metaHTMLString,\n    cssString,\n    log: logFactory(haltOnErrors),\n  });\n\n  return {\n    metaComponent,\n    files: makeTemplates({ templateId, metaComponent }),\n  };\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}